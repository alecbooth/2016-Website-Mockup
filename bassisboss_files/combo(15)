YUI.add("hermes-lang-errors",function(e,t){e.Intl.add("hermes/errors","en-US",{UNAUTHORIZED_ACCESS:["Unauthorized Access"],YOU_ARE_NOT_AUTHORIZED:["You have attempted to access a page for which you are not authorized."],AUTO_REDIRECT_IN_10_SECONDS:["This page will automatically redirect to the Flickr home page in 10 seconds,"],OR_CLICK_LINK_FOR_HOME:["or click the following link to go straight to the <a href='/'>home page</a>."],ERROR:["Error"],ERROR_HAS_OCCURRED:["An error has occurred. Please try again."],ERROR_REPLACING:["An error has occurred replacing the image. Please try again."],ERROR_SAVING:["An error has occurred saving the image. Please try again."],DOWNLOAD_EXPIRED:["Download expired"],DOWNLOAD_NO_LONGER_AVAILABLE:["Your download is no longer available."]})},"@VERSION@",{requires:["intl"]});
YUI.add("hermes-template-cameraroll-edit-dialog",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+="<div class='edit-selected-photos'>\n	<i class=\"edit-selected-photos-icon\"></i>\n	<span>",u={hash:{intlName:"cameraroll.EDIT"},data:i},s+=f((o=n.intlHTMLMessage||t.intlHTMLMessage,o?o.call(t,u):a.call(t,"intlHTMLMessage",u)))+"</span>\n</div>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/cameraroll-edit-dialog",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("cameraroll-edit-dialog-view",function(e,t){var n=require("lib/flog")(t),r=300;e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this.maxItemsToEdit=e.maxItemsToEdit,this},loadState:function(){return e.Promise.resolve()},buildContainer:function(){var e;return e=this.templates("cameraroll-edit-dialog")({}),this.setContainerHTML(e),this},editSelectedPhotos:function(t){t.preventDefault();var i=this,s,o,u=e.CameraRollSelectionManager.getSelection(),a,f,l,c=!1,h;if(this.get("dialogRequested"))return;if(u.length){f=u.length;if(f>this.maxItemsToEdit){this.fire("subviewViewEvent","cameraroll-too-many-items","edit",this.maxItemsToEdit);return}a=u.map(function(t){return e.CameraRollViewModel.getPhotoIDByGUID(t)}),e.Promise.all(a).then(function(t){var s;return l=e.Array.dedupe(t),s=i.appContext.callAPI("flickr.cameraroll.getPhotosMeta",{photo_ids:l.join(","),properties:["name","title","description","is_public","is_family","is_friend","perm_comment","perm_addmeta","adultness","license","tags","people","date_taken","date_create","date_taken_granularity"].join(",")}).then(null,function(t){var r=!1;n.error("getPhotosMeta failed",{err:t}),o&&o.close(),r=t&&t.code===99;var s=new e.Views.FluidModal({appContext:i.appContext,title:i.intlMessage({intlName:"common.OOPS"}),message:r?i.intlMessage({intlName:"cameraroll.ERROR_SIGNED_OUT"}):i.intlMessage({intlName:"cameraroll.ERROR_BEFORE_EDITING_OUT"}),actionButtonLabel:i.intlMessage({intlName:"common.OK"}),showCancelButton:!1});r&&s.on("actionClick",function(){e.SigninHelper._redirectToSignin()}),setTimeout(function(){s.show()},100)}),h=setTimeout(function(){o=(new e.Views.FluidModal({appContext:i.appContext,title:i.intlMessage({intlName:"cameraroll.EDIT_PHOTOS",selectedCount:l.length}),htmlMessage:i.templates("flickr-balls")({}),showButtons:!1,classList:"cameraroll-edit-dialog-loading"})).show(),o.on("close",function(){i.set("dialogRequested",!1),c=!0})},r),s}).then(function(t){var n;clearTimeout(h);if(c)return;t.name&&(t.title=t.name),n=new e.Views["cameraroll-edit-dialog-body-view"]({appContext:i.appContext,selectedPhotosIDs:l,commonData:t,isLoading:!1}),o&&o.close(),s=(new e.Views.FluidModal({appContext:i.appContext,title:i.intlMessage({intlName:"cameraroll.EDIT_PHOTOS",selectedCount:l.length}),subview:n,actionButtonLabel:i.intlMessage({intlName:"common.SAVE"}),cancelButtonLabel:i.intlMessage({intlName:"common.CANCEL"}),classList:"cameraroll-edit-dialog",dismissOnActionClick:!1})).show(),i.set("dialogRequested",!1),s.on("actionClick",function(){s.get("container").one(".close-x").hide(),n.fire("doSave",s),e.rapidTracker.beacon(this.name,"camerarollTrayEdit:saveClicked",{count:f})}),s.on("cancelClick",function(){this.get("subview").cancelClicked()})}),this.set("dialogRequested",!0),e.rapidTracker.beacon(this.name,"editSelectedCameraRollImages")}},activate:function(){return this.registerEventHandler(this.get("container").one(".edit-selected-photos").on("click",this.editSelectedPhotos,this)),this}},{ATTRS:{dialogRequested:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1}}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-modal-view","dropdown","cameraroll-edit-dialog-body-view","hermes-template-cameraroll-edit-dialog","hermes-template-flickr-balls","cameraroll-edit-dialog-css","cameraroll-selection-manager","cameraroll-view-model"],langBundles:["common","cameraroll"],optional:[]});
YUI.add("hermes-template-cameraroll-tray-privacy-button",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="edit-privacy">\n	<i class="edit-privacy-icon"></i>\n	<span>',u={hash:{intlName:"cameraroll.PRIVACY"},data:i},s+=f((o=n.intlHTMLMessage||t.intlHTMLMessage,o?o.call(t,u):a.call(t,"intlHTMLMessage",u)))+"</span>\n</div>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/cameraroll-tray-privacy-button",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-cameraroll-privacy-dialog",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function h(e,t){return'checked=""'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f=this,l=n.helperMissing,c=this.escapeExpression;s+='\n<ul>\n	<li>\n		<div class="radio">\n			<input type="radio" id="radio-small-1" name="radio-small" value="public" ',o=n["if"].call(t,t["public"],{hash:{},inverse:f.noop,fn:f.program(1,h,i),data:i});if(o||o===0)s+=o;s+='>\n			<label for="radio-small-1">\n			<div></div>\n			<span>',a={hash:{intlName:"settings.PUBLIC"},data:i},s+=c((o=n.intlMessage||t.intlMessage,o?o.call(t,a):l.call(t,"intlMessage",a)))+'</span>\n			</label>\n		</div>\n	</li>\n\n	<li>\n		<div class="radio">\n			<input type="radio" id="radio-small-2" name="radio-small" value="private" ',u=n["if"].call(t,t["private"],{hash:{},inverse:f.noop,fn:f.program(1,h,i),data:i});if(u||u===0)s+=u;s+='>\n			<label for="radio-small-2">\n			<div></div>\n			<span>',a={hash:{intlName:"settings.PRIVATE"},data:i},s+=c((o=n.intlMessage||t.intlMessage,o?o.call(t,a):l.call(t,"intlMessage",a)))+'</span>\n			</label>\n		</div>\n	</li>\n\n	<li>\n		<div class="radio">\n			<input type="radio" id="radio-small-3" name="radio-small" value="friends" ',u=n["if"].call(t,t.friends,{hash:{},inverse:f.noop,fn:f.program(1,h,i),data:i});if(u||u===0)s+=u;s+='>\n			<label for="radio-small-3">\n			<div></div>\n			<span>',a={hash:{intlName:"settings.FRIENDS"},data:i},s+=c((o=n.intlMessage||t.intlMessage,o?o.call(t,a):l.call(t,"intlMessage",a)))+'</span>\n			</label>\n		</div>\n	</li>\n\n	<li>\n		<div class="radio">\n			<input type="radio" id="radio-small-4" name="radio-small" value="family" ',u=n["if"].call(t,t.family,{hash:{},inverse:f.noop,fn:f.program(1,h,i),data:i});if(u||u===0)s+=u;s+='>\n			<label for="radio-small-4">\n			<div></div>\n			<span>',a={hash:{intlName:"settings.FAMILY"},data:i},s+=c((o=n.intlMessage||t.intlMessage,o?o.call(t,a):l.call(t,"intlMessage",a)))+'</span>\n			</label>\n		</div>\n	</li>\n\n	<li>\n		<div class="radio">\n			<input type="radio" id="radio-small-5" name="radio-small" value="friendsfamily" ',u=n["if"].call(t,t.friendsfamily,{hash:{},inverse:f.noop,fn:f.program(1,h,i),data:i});if(u||u===0)s+=u;return s+='>\n			<label for="radio-small-5">\n			<div></div>\n			<span>',a={hash:{intlName:"settings.FRIENDS_AND_FAMILY"},data:i},s+=c((o=n.intlMessage||t.intlMessage,o?o.call(t,a):l.call(t,"intlMessage",a)))+"</span>\n			</label>\n		</div>\n	</li>\n</ul>\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/cameraroll-privacy-dialog",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("cameraroll-tray-privacy-button-view",function(e,t){var n=require("lib/flog")(t),r=500;e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this.maxItemsToEdit=e.maxItemsToEdit,this},loadState:function(){return e.Promise.resolve()},buildContainer:function(){var e;return e=this.templates("cameraroll-tray-privacy-button")({}),this.setContainerHTML(e),this},activate:function(){return this.registerEventHandler(this.get("container").one(".edit-privacy").on("click",this.editPrivacy,this)),this},editPrivacy:function(i){var s=this,o,u=e.CameraRollSelectionManager.getSelection(),a,f,l=!1,c,h;i.preventDefault(),u.length>r?(c=(new e.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"common.ZOINKS"}),message:this.intlMessage({intlName:"cameraroll.TOO_MANY_EDITS",count:r}),cancelButtonLabel:this.intlMessage({intlName:"common.OK"}),showActionButton:!1})).show(),c.on("actionClick",function(){c.destroy()})):u.length&&(a=u.map(function(t){return e.CameraRollViewModel.getPhotoIDByGUID(t)}),e.Promise.all(a).then(function(r){return h=e.Array.dedupe(r),e.rapidTracker.beacon(t,"cameraRollChangePrivacyClick",{count:h.length}),s.appContext.callAPI("flickr.cameraroll.getPhotosMeta",{photo_ids:h.join(","),properties:["is_public","is_family","is_friend"].join(",")}).then(function(n){n.isPublic?l={"public":!0}:n.isFriend&&!n.isFamily?l={friends:!0}:!n.isFriend&&n.isFamily?l={family:!0}:n.isFriend&&n.isFamily?l={friendsfamily:!0}:n.isPublic===0&&n.isFriend===0&&n.isFamily===0&&(l={"private":!0}),o=new e.Views.FluidModal({appContext:s.appContext,title:s.intlMessage({intlName:"cameraroll.CHANGE_PRIVACY_PHOTOS",count:h.length}),message:s.templates("cameraroll-privacy-dialog")(l),actionButtonLabel:s.intlMessage({intlName:"common.CHANGE"}),cancelButtonLabel:s.intlMessage({intlName:"common.CANCEL"}),actionButtonDisabled:l?!1:!0,classList:"cameraroll-privacy-change-dialog",dismissOnActionClick:!1,width:400}),o.show(),o.registerEventHandler(o.on("activated",function(){o.reposition(),o.registerEventHandler(o.get("container").all("input").on("change",function(){o.enableActionButton()}))})),o.registerEventHandler(o.on("actionClick",function(n){var r=n&&n.target&&n.target.get?n.target.get("container"):null,i;r&&(i=r.one('[name="radio-small"]:checked'),i&&(f=i.get("value"))),o.close(),f&&(e.rapidTracker.beacon(t,"cameraRollChangePrivacyConfirmationClick",{count:h.length}),s.showPrivacyDialog(s.mapPrivacy(f)))}))},function(t){var r=!1;n.error("getPhotosMeta failed",{err:t}),r=t&&t.code===99;var i=new e.Views.FluidModal({appContext:s.appContext,title:s.intlMessage({intlName:"common.OOPS"}),message:r?s.intlMessage({intlName:"cameraroll.ERROR_SIGNED_OUT"}):s.intlMessage({intlName:"cameraroll.PRIVACY_ERROR"}),actionButtonLabel:s.intlMessage({intlName:"common.OK"}),showCancelButton:!1});r&&i.on("actionClick",function(){e.SigninHelper._redirectToSignin()}),i.show()})}))},savePrivacyForPhotoIds:function(t,n){var r=50,i=t.length,s,o=0,u,a=[],f=this;return i%r===0?s=i/r:s=Math.floor(i/r)+1,u=function(){var i=t.slice(o,r+o),l=i.join(",");return o+=r,s--,f.appContext.getModelRegistry("photo-privacy-models").then(function(t){return t.remoteBatchUpdate(l,{privacy:n}).then(function(t){t&&t.errors&&t.errors.forEach(function(e){i.splice(i.indexOf(e.photoId,1)),a.indexOf(e.photoId)===-1&&a.push(e.photoId)}),i.length>0&&e.fire("cameraRollEditDialog:selectionPrivacyChanged",{newPrivacyValues:n,privacyChangedIDs:i})},function(){i.forEach(function(e){i.forEach(function(e){a.indexOf(e)===-1&&a.push(e)})})}).then(function(){return s>0?u():{failedPhotoIds:a}})})},s>0?u():e.Promise.resolve({failedPhotoIds:[]})},savePrivacy:function(t,r){var i=this,s=t.map(function(t){return e.CameraRollViewModel.getPhotoIDByGUID(t)});return e.Promise.all(s).then(function(e){return i.savePrivacyForPhotoIds(e,r).then(function(e){if(e&&e.failedPhotoIds&&e.failedPhotoIds.length)return n.info("retry failed IDs",{ids:e.failedPhotoIds}),i.savePrivacyForPhotoIds(e.failedPhotoIds,r)}).then(function(e){if(e&&e.failedPhotoIds&&e.failedPhotoIds.length)return n.info("retry failed IDs",{ids:e.failedPhotoIds}),i.savePrivacyForPhotoIds(e.failedPhotoIds,r)})}).then(function(t){e.fire("cameraRollTray:selectionPrivacyChangeComplete",{newPrivacyValues:r,privacyChangedIDs:e.CameraRollSelectionManager.getSelection()}),n.info("savePrivacy resolved",{data:t})},function(e){n.warn("savePrivacy rejected",{err:e})})},onError:function(t){var n=this,r;r=new e.Views.FluidModal({appContext:this.appContext,title:n.intlMessage({intlName:"common.ERROR"}),message:t,actionButtonLabel:n.intlMessage({intlName:"common.OK"}),showCancelButton:!1}),r.show()},mapPrivacy:function(e){var t,n,r,i,s;t=[["public",["isPublic"]],["friendsfamily",["isVisibleByFriends","isVisibleByFamily"]],["friends",["isVisibleByFriends"]],["family",["isVisibleByFamily"]],["private",[]]];if(typeof e=="object"){for(n=0,r=t.length;n<r;n++){i=t[n];if(!i[1].length||i[1].every(function(t){return!!e[t]}))return i[0]}return null}s={};for(n=0,r=t.length;n<r;n++)i=t[n],i[1].forEach(function(t){s[t]=i[0]===e?!0:s[t]||!1});return s},showPrivacyDialog:function(n){var r,i=this,s=e.CameraRollSelectionManager.getSelection(),o=s.length,u,a;n.isPublic?(u=i.intlMessage({intlName:"cameraroll.CHANGE_PRIVACY_PHOTOS_PUBLIC",count:o}),a=i.intlMessage({intlName:"cameraroll.CHANGE_PRIVACY_MESSAGE_PUBLIC",count:o})):(u=i.intlMessage({intlName:"cameraroll.CHANGE_PRIVACY_PHOTOS",count:o}),a=i.intlMessage({intlName:"cameraroll.CHANGE_PRIVACY_MESSAGE",count:o})),r=new e.Views.FluidModal({appContext:this.appContext,title:u,message:a,actionButtonLabel:i.intlMessage({intlName:"common.OK"}),cancelButtonLabel:i.intlMessage({intlName:"common.CANCEL"}),classList:"cameraroll-privacy-dialog",dismissOnActionClick:!1}),r.on("actionClick",function(){e.rapidTracker.beacon(t,"cameraRollChangePrivacySuperConfirmationClick"
),r.get("container").one(".foot").addClass("loading").append(this.templates("flickr-balls")({})),r.get("container").one(".close-x").hide(),i.savePrivacy(s,n).then(function(){r.close()})}),r.show()}})},"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-cameraroll-tray-privacy-button","hermes-template-cameraroll-privacy-dialog","cameraroll-tray-css","cameraroll-selection-manager","cameraroll-view-model","fluid-droparound-view","fluid-modal-view","hermes-template-flickr-balls","fluid-balls-css","privacy-helper"],langBundles:["cameraroll","common","settings"],optional:[]});
YUI.add("hermes-template-cameraroll-tray-delete-button",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="delete-selected-photos">\n	<i class="delete-selected-photos-icon"></i>\n	<span>',u={hash:{intlName:"cameraroll.DELETE"},data:i},s+=f((o=n.intlHTMLMessage||t.intlHTMLMessage,o?o.call(t,u):a.call(t,"intlHTMLMessage",u)))+"</span>\n</div>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/cameraroll-tray-delete-button",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("cameraroll-tray-delete-button-view",function(e,t){var n=require("lib/flog")(t);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this.maxItemsToEdit=e.maxItemsToEdit,this},loadState:function(){return e.Promise.resolve()},buildContainer:function(){var e;return e=this.templates("cameraroll-tray-delete-button")({}),this.setContainerHTML(e),this},activate:function(){return this.registerEventHandler(this.get("container").one(".delete-selected-photos").on("click",this.showDeleteDialog.bind(this))),this},showDeleteDialog:function(n){n.preventDefault();var r,i=this,s=e.CameraRollSelectionManager.getSelection(),o=s.length,u,a,f,l;f=s.map(function(t){return e.CameraRollViewModel.getPhotoIDByGUID(t)}),e.Promise.all(f).then(function(n){l=e.Array.dedupe(n),o=l.length,e.rapidTracker.beacon(t,"cameraRollDeletePhotosClick",{count:o}),u=i.intlMessage({intlName:"cameraroll.DELETE_PHOTOS",selectedCount:o}),a=i.intlMessage({intlName:"cameraroll.DELETE_MESSAGE",selectedCount:o}),r=new e.Views.FluidModal({appContext:this.appContext,title:u,message:a,actionButtonLabel:i.intlMessage({intlName:"common.DELETE"}),cancelButtonLabel:i.intlMessage({intlName:"common.CANCEL"}),actionButtonIsDangerous:!0,classList:"cameraroll-delete-dialog",dismissOnActionClick:!1}),r.on("actionClick",function(){r.get("container").one(".close-x").hide(),r.get("container").one(".foot").hasClass("loading")||r.get("container").one(".foot").addClass("loading").append(this.templates("flickr-balls")({})),e.rapidTracker.beacon(t,"deleteConfirmationClick",{count:o}),i.handleDeleteFromCameraRollConfirm(s).then(function(t){var n,s;t.photoIDsSuccessfullyDeleted.length&&(n=e.CameraRollViewModel.getValue("viewerProfileModel"),n&&(s=n.getValue("photoCount"),n.setValue("photoCount",s-t.photoIDsSuccessfullyDeleted.length))),i.appContext.getModelRegistry("photostream-models").then(function(e){e.attributeSearch({normalizedId:i.appContext.getViewer().nsid},!0).forEach(function(t){e.remove(t)})}),r.close(),e.fire("cameraRollSelectionTray:selectionDeleted",t)})}),r.show()})},deletePhotosByID:function(t){var r=this,i=e.CameraRollSelectionManager,s=e.config.flickr.api.max_concurrent_photo_deletions,o,u=[],a,f,l,c;o=Math.ceil(t.length/s);for(c=0;c<o;c++)f=c*s,l=f+s,a=function(){var s=t.slice(f,l);return e.RetryablePromise(function(){return r.appContext.callAPI("flickr.photos.delete",{photo_ids:s.join(",")}).then(function(t){var n=[],r,o,u,a,f;for(u=0,f=s.length;u<f;u++){r=s[u],o=e.CameraRollViewModel.getGUIDsByPhotoID(r);for(a=0;a<o.length;a++)n.push(i.deselect(o[a]))}return i.update(n),{photoIDsSuccessfullyDeleted:s,photoIDsNotDeleted:[]}},function(e){return{photoIDsSuccessfullyDeleted:[],photoIDsNotDeleted:s}}).catch(function(e){n.error("Error in the deletion success handler",{err:e})})},3)}(),u.push(a);return e.Promise.all(u)},handleDeleteFromCameraRollConfirm:function(t){var n=this,r;return e.fire("cameraRollSelectionTray:selectionDeletionConfirmed"),r=t.map(function(t){return e.CameraRollViewModel.getPhotoIDByGUID(t)}),e.Promise.all(r).then(function(e){return n.deletePhotosByID(e).then(function(e){var t=[],r=[];return e.forEach(function(e){t=t.concat(e.photoIDsSuccessfullyDeleted),r=r.concat(e.photoIDsNotDeleted)}),t.forEach(function(e){n.appContext.getModelRegistry("photo-sets-models",e).then(function(e){e.removeAll()})}),n.appContext.getModelRegistry("sets-models").then(function(e){e.exists(n.appContext.getViewer().nsid)&&e.remove(n.appContext.getViewer().nsid)}),{photoIDsSuccessfullyDeleted:t,photoIDsNotDeleted:r}})}).catch(function(n){e.fire("cameraRollSelectionTray:selectionDeleted",{photoIDsSuccessfullyDeleted:[],photoIDsNotDeleted:t})})},onError:function(t){var n=this,r;e.fire("cameraRollSelectionTray:selectionDeletionError"),r=new e.Views.FluidModal({appContext:this.appContext,title:n.intlMessage({intlName:"common.ERROR"}),message:t,actionButtonLabel:n.intlMessage({intlName:"common.OK"}),showCancelButton:!1}),r.show()}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-modal-view","hermes-template-cameraroll-tray-delete-button","cameraroll-tray-css","cameraroll-selection-manager","cameraroll-view-model","fluid-modal-view","hermes-template-flickr-balls","fluid-balls-css","photostream-models"],langBundles:["cameraroll","common"],optional:[]});
YUI.add("hermes-template-cameraroll-tray-album-button",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="album-selected-photos">\n	<i class="album-photos-icon"></i>\n	<span>',u={hash:{intlName:"photo-page-scrappy.ADD_TO_ALBUM"},data:i},s+=f((o=n.intlMessage||t.intlMessage,o?o.call(t,u):a.call(t,"intlMessage",u)))+"</span>\n</div>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/cameraroll-tray-album-button",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-album-selection",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<div class="album-selection">\n	<h2 class="album-selection-heading">',(o=n.titleSelect)?o=o.call(t,{hash:{},data:i}):(o=t.titleSelect,o=typeof o===u?o.apply(t):o),s+=a(o)+'</h2>\n	<button class="ui-dialog-button ui-dialog-button-neutral ui-dialog-button-close hide-text"><span>&nbsp;</span></button>\n	<input type="text" placeholder="',(o=n.placeholderSearch)?o=o.call(t,{hash:{},data:i}):(o=t.placeholderSearch,o=typeof o===u?o.apply(t):o),s+=a(o)+"\" class='album-selection-search' />\n	<ol class='album-selection-list loading'>\n		<li>",(o=n.loadingText)?o=o.call(t,{hash:{},data:i}):(o=t.loadingText,o=typeof o===u?o.apply(t):o),s+=a(o)+'</li>\n	</ol>\n	<div class="album-selection-buttons">\n		<button class="ui-dialog-button ui-dialog-button-neutral ui-dialog-button-done album-selection-done"><span>',(o=n.buttonTextComplete)?o=o.call(t,{hash:{},data:i}):(o=t.buttonTextComplete,o=typeof o===u?o.apply(t):o),s+=a(o)+"</span></button>\n	</div>\n</div>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/album-selection",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-album-creation",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function l(e,t){var r="",i;return r+='\n			<div class="album-selection-list-item-icon-wrapper album-creation-list-item-create">\n				<img src="',(i=n.photoUrl)?i=i.call(e,{hash:{},data:t}):(i=e.photoUrl,i=typeof i===u?i.apply(e):i),r+=a(i)+'" class="album-creation-list-item-icon" />\n			</div>\n		',r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+="<div class='album-creation'>\n	<h2 class=\"album-creation-heading\">",(o=n.titleCreate)?o=o.call(t,{hash:{},data:i}):(o=t.titleCreate,o=typeof o===u?o.apply(t):o),s+=a(o)+'</h2>\n	<button class="ui-dialog-button ui-dialog-button-neutral ui-dialog-button-close hide-text"><span>&nbsp;</span></button>\n	<div class="album-creation-content">\n		<span class="album-creation-list-item-icon-topper">&nbsp;</span>\n		',o=n.unless.call(t,t.multiplePhotos,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+='\n		<div class="album-creation-list-item-entry">\n			<input type="text" placeholder="',(o=n.placeholderTitle)?o=o.call(t,{hash:{},data:i}):(o=t.placeholderTitle,o=typeof o===u?o.apply(t):o),s+=a(o)+"\" class='album-creation-title' />\n			<textarea placeholder=\"",(o=n.placeholderDescription)?o=o.call(t,{hash:{},data:i}):(o=t.placeholderDescription,o=typeof o===u?o.apply(t):o),s+=a(o)+'" class="album-creation-description"></textarea>\n		</div>\n	</div>\n	<div class="album-creation-buttons">\n		<button class="ui-dialog-button ui-dialog-button-neutral ui-dialog-button-done album-selection-done album-creation-create" disabled><span>',(o=n.buttonTextCreate)?o=o.call(t,{hash:{},data:i}):(o=t.buttonTextCreate,o=typeof o===u?o.apply(t):o),s+=a(o)+'</span></button>\n		<button class="ui-dialog-button ui-dialog-button-neutral album-creation-cancel">\n			<span class="hide-text album-creation-cancel-back-icon">&nbsp;</span>\n			<span>',(o=n.buttonTextCancel)?o=o.call(t,{hash:{},data:i}):(o=t.buttonTextCancel,o=typeof o===u?o.apply(t):o),s+=a(o)+"</span>\n		</button>\n	</div>\n</div>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/album-creation",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-album-selection-list-item-stats",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<span class="album-selection-list-item-stats">\n	',(o=n.photoCountDisplay)?o=o.call(t,{hash:{},data:i}):(o=t.photoCountDisplay,o=typeof o===u?o.apply(t):o),s+=a(o)+"\n</span>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/album-selection-list-item-stats",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-album-selection-list-item",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function p(e,t){return"\n	pending belongs-to-album\n"}function d(e,t){var r="",i;return r+='\n		<img src="',(i=n.bestIconURL)?i=i.call(e,{hash:{},data:t}):(i=e.bestIconURL,i=typeof i===f?i.apply(e):i),r+=l(i)+'" class="album-selection-list-item-icon" />\n	',r}function v(e,t){return'\n		<img src="https://s.yimg.com/pw/images/buddyicon11_s.png" class="album-selection-list-item-icon" />\n	'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=this.merge(r,e.partials),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;s+='<li class="album-selection-list-item ',(o=n["class"])?o=o.call(t,{hash:{},data:i}):(o=t["class"],o=typeof o===f?o.apply(t):o),s+=l(o)+" ",o=n["if"].call(t,t.isPending,{hash:{},inverse:c.noop,fn:c.program(1,p,i),data:i});if(o||o===0)s+=o;s+='" data-album-id="',(o=n.id)?o=o.call(t,{hash:{},data:i}):(o=t.id,o=typeof o===f?o.apply(t):o),s+=l(o)+'" data-machine-title="',(o=n.machineTitle)?o=o.call(t,{hash:{},data:i}):(o=t.machineTitle,o=typeof o===f?o.apply(t):o),s+=l(o)+'">\n	<span class="album-selection-list-item-icon-topper">&nbsp;</span>\n	<div class="album-selection-list-item-icon-wrapper">\n	',o=n["if"].call(t,t.bestIconURL,{hash:{},inverse:c.program(5,v,i),fn:c.program(3,d,i),data:i});if(o||o===0)s+=o;s+='\n	</div>\n\n	<div class="album-selection-list-item-labels">\n		<span class="album-selection-list-item-title">',a={hash:{},data:i},s+=l((o=n.truncate||t.truncate,o?o.call(t,t.title,60,a):h.call(t,"truncate",t.title,60,a)))+"</span>\n		",u=c.invokePartial(r["album-selection-list-item-stats"],"album-selection-list-item-stats",t,n,r,i);if(u||u===0)s+=u;return s+='\n		<span class="isPending">',a={hash:{intlName:"groups.GROUP_ADD_PENDING"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):h.call(t,"intlMessage",a)))+"</span>\n	</div>\n\n</li>",s}),r={};e.Array.each(["album-selection-list-item-stats"],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/album-selection-list-item",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-album-selection-list-item-stats"]});
YUI.add("hermes-template-album-selection-list",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function c(e,t){var r="",i;return r+='\n	<li class="album-selection-list-item album-selection-create-switch">\n		<span class="album-selection-list-item-icon-wrapper album-selection-list-item-create">&nbsp;</span>\n		<div class="album-selection-list-item-labels">\n			<span class="album-selection-list-item-title">',(i=n.buttonTextSwitchCreate)?i=i.call(e,{hash:{},data:t}):(i=e.buttonTextSwitchCreate,i=typeof i===u?i.apply(e):i),r+=a(i)+"</span>\n		</div>\n	</li>\n",r}function h(e,t){var r="",i;r+="\n	",i=n.each.call(e,e.albums,{hash:{},inverse:f.noop,fn:f.program(4,p,t),data:t});if(i||i===0)r+=i;return r+="\n",r}function p(e,t){var i="",s;i+="\n		",s=f.invokePartial(r["album-selection-list-item"],"album-selection-list-item",e,n,r,t);if(s||s===0)i+=s;return i+="\n	",i}function d(e,t){var r="",i;r+="\n	",i=n["if"].call(e,e.canCreateNew,{hash:{},inverse:f.program(9,m,t),fn:f.program(7,v,t),data:t});if(i||i===0)r+=i;return r+="\n",r}function v(e,t){return"\n	"}function m(e,t){var r="",i,s;return r+='\n		<div class="none">',s={hash:{},data:t},r+=a((i=n.renderTrustedMarkup||e.renderTrustedMarkup,i?i.call(e,e.none,s):l.call(e,"renderTrustedMarkup",e.none,s)))+"</div>\n	",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=this.merge(r,e.partials),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this,l=n.helperMissing;o=n["if"].call(t,t.canCreateNew,{hash:{},inverse:f.noop,fn:f.program(1,c,i),data:i});if(o||o===0)s+=o;s+="\n",o=n["if"].call(t,t.albums,{hash:{},inverse:f.program(6,d,i),fn:f.program(3,h,i),data:i});if(o||o===0)s+=o;return s}),r={};e.Array.each(["album-selection-list-item"],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/album-selection-list",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-album-selection-list-item"]});
YUI.add("hermes-lang-shared-entity",function(e,t){e.Intl.add("hermes/shared-entity","en-US",{USERNAME_HAS_SHARED_PHOTOS_ONLY:["${username}"," has shared ",{type:"plural",valueName:"photoCount",options:{one:"${#} photo",other:"${#} photos"}}," with you!"],USERNAME_HAS_SHARED_VIDEOS_ONLY:["${username}"," has shared ",{type:"plural",valueName:"videoCount",options:{one:"${#} video",other:"${#} videos"}}," with you!"],USERNAME_HAS_SHARED_PHOTOS_VIDEOS:["${username}"," has shared ",{type:"plural",valueName:"photoCount",options:{one:"${#} photo",other:"${#} photos"}}," ",{type:"plural",valueName:"videoCount",options:{one:"and ${#} video",other:"and ${#} videos"}}," with you!"],OWNER_HAS_SHARED_PHOTOS_ONLY:["You have shared ",{type:"plural",valueName:"photoCount",options:{one:"${#} photo",other:"${#} photos"}},"."],OWNER_HAS_SHARED_VIDEOS_ONLY:["You have shared ",{type:"plural",valueName:"videoCount",options:{one:"${#} video",other:"${#} videos"}},"."],OWNER_HAS_SHARED_PHOTOS_VIDEOS:["You have shared ",{type:"plural",valueName:"photoCount",options:{one:"${#} photo",other:"${#} photos"}}," ",{type:"plural",valueName:"videoCount",options:{one:"and ${#} video",other:"and ${#} videos"}},"."],VIEW_YOUR_SHARING_HISTORY:["View your sharing history"]})},"@VERSION@",{requires:["intl"]});
YUI.add("flickr-favorites-getContext-fetcher",function(e,t){"use strict";function n(t){var n={photo_id:t.photoId,num_prev:t.numNext,num_next:t.numPrev,extras:e.APIHelper.request.getRebootPhotoExtras()};return t.id?n.user_id=t.id:n.path_alias=t.pathAlias,n}function r(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=[],c=[],h=s.proxy(n.photoId),p,d,v,m,g,y,b=[];return p=r.prevphotos,d=r.nextphotos,c=e.APIHelper.response.parsePhotos({photos:p.photo,personModelRegistry:o,photoModelRegistry:s,photoEngagementModelRegistry:u,photoStatsModelRegistry:a,photoCurationModelRegistry:f}),l=e.APIHelper.response.parsePhotos({photos:d.photo,personModelRegistry:o,photoModelRegistry:s,photoEngagementModelRegistry:u,photoStatsModelRegistry:a,photoCurationModelRegistry:f}),y=i.getValue(n.id,"photoContextList"),m=y.hasMinBoundary?y.hasMinBoundary():!1,g=y.hasMaxBoundary?y.hasMaxBoundary():!1,v=y.getList(),b=e.APIHelper.response.addOrReplaceListByContext({model:h,next:c,prev:l.reverse(),hasMax:g,hasMin:m,current:v,numNext:n.numNext,numPrev:n.numPrev}),i.setValue(n.id,"photoContextList",b),{next:c,previous:l.reverse()}}function i(n,r){var i=this;return e.Promise.all([r.callAPI("flickr.favorites.getContext",this._processParams(n),!0),r.getModelRegistry("favorite-models"),r.getModelRegistry("photo-models"),r.getModelRegistry("person-models"),r.getModelRegistry("photo-engagement-models"),r.getModelRegistry("photo-stats-models"),r.getModelRegistry("photo-curation-models")]).then(function(e){return i._processResponse(e,n)},function(e){throw e.code===3&&e.message==="Photo not a favorite"&&(e.notInContext=!0),e}).then(null,e.FetcherErrorLogger(t))}e.namespace("ListFetchers")["flickr-favorites-getContext"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["favorite-models","photo-models","person-models","photo-engagement-models","photo-stats-models","photo-curation-models"]});
YUI.add("flickr-favorites-getList-fetcher",function(e,t){"use strict";function n(t){var n={extras:e.APIHelper.request.getRebootPhotoExtras(),per_page:t.perPage||20,page:t.page||1,get_user_info:1,jump_to:t.withPhotoId||""};if(t.id||t.userId)n.user_id=(t.id||t.userId).split("-")[0];else{if(!t.pathAlias)throw new Error("[flickr-favorites-getList-fetcher] `id` or `pathAlias` is required.");n.path_alias=t.pathAlias}return n}function r(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l,c={id:r.user.nsid,pathAlias:r.user.pathAlias,totalItems:r.photos.total},h,p=n.id||n.userId;return p&&p!==c.id&&(c.id=p),h=e.APIHelper.response.parsePerson(r.user),c.owner=s.addOrUpdate(h),l=e.APIHelper.response.parsePhotos({photos:r.photos.photo,personModelRegistry:s,photoModelRegistry:i,photoEngagementModelRegistry:u,photoStatsModelRegistry:a,photoCurationModelRegistry:f}),c.photoPageList={perPage:r.photos.perpage,page:r.photos.page,pageContent:l,totalItems:r.photos.total},o.addOrUpdate(c),l}function i(n,r){var i=this;return e.Promise.all([r.callAPI("flickr.favorites.getList",this._processParams(n)),r.getModelRegistry("photo-models"),r.getModelRegistry("person-models"),r.getModelRegistry("favorite-models"),r.getModelRegistry("photo-engagement-models"),r.getModelRegistry("photo-stats-models"),r.getModelRegistry("photo-curation-models")]).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ListFetchers")["flickr-favorites-getList"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-models","person-models","favorite-models","photo-engagement-models","photo-stats-models","photo-curation-models"]});
YUI.add("favorite-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-favorites-getList"].run(t,this.appContext)}},attributes:{normalizedId:{readOnly:!0,defaultFn:function(e){return e.split("-")[0]}},displayType:{readOnly:!0,defaultFn:function(){return"favorites"}},title:{readOnly:!0,derivedBy:["owner","normalizedId"],defaultFn:function(e){var t=this.appContext.getViewer(),n=this.getValue(e,"normalizedId"),r;return t&&t.nsid===n?"Your favorites":(r=this.getValue(e,"owner"),r?r.getValue("displayname")+"'s favorites":"Favorites")}},pathAlias:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)||undefined},defaultFn:function(e){return this.getValue(e,"normalizedId")}},owner:{isModel:!0},isOwner:e.PhotoModelHelper.attributes.isOwner,photoPageList:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-favorites-getList"]}},photoContextList:{isListProxy:!0,contextFetch:{listFetcher:e.ListFetchers["flickr-favorites-getContext"],listItemIdField:"photoId"}},url:{readOnly:!0,derivedBy:["owner","normalizedId"],defaultFn:function(e){var t=this.getValue(e,"owner"),n=this.getValue(e,"normalizedId"),r=t?t.getValue("pathAlias"):n;return"/photos/"+r+"/favorites/"}},totalItems:{defaultFn:function(){return null}},urlSuffix:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){var t=this.getValue(e,"owner"),n=t.getValue("pathAlias");return"faves-"+n}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-favorites-getContext-fetcher","flickr-favorites-getList-fetcher","photo-model-helper"]});
YUI.add("flickr-galleries-getPhotos-fetcher",function(e,t){"use strict";function n(t){var n={gallery_id:t.compoundId,extras:e.APIHelper.request.getRebootPhotoExtras(),per_page:t.perPage||1,page:t.page||20,get_user_info:1,get_gallery_info:1,primary_photo_extras:"url_sq, url_t, url_s, url_m"};return n}function r(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l;if(r&&r.gallery)return r.gallery.owner=r.user,r.gallery.title=r.gallery.title&&r.gallery.title.content,r.gallery.description=r.gallery.description&&r.gallery.description.content,r.gallery.photoCount=r.gallery.countPhotos,r.gallery.videoCount=r.gallery.countVideos,e.APIHelper.response.addContextToRegistry(r.gallery,o,s),l=e.APIHelper.response.parsePhotos({photos:r.photos.photo,personModelRegistry:s,photoModelRegistry:i,photoEngagementModelRegistry:u,photoStatsModelRegistry:a,photoCurationModelRegistry:f}),o.setValue(n.id,"photoPageList",l),l}function i(n,r){var i=this;return e.Promise.all([r.callAPI("flickr.galleries.getPhotos",this._processParams(n),!0),r.getModelRegistry("photo-models"),r.getModelRegistry("person-models"),r.getModelRegistry("gallery-models"),r.getModelRegistry("photo-engagement-models"),r.getModelRegistry("photo-stats-models"),r.getModelRegistry("photo-curation-models")]).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ListFetchers")["flickr-galleries-getPhotos"]={run:i,_processResponse:r,_processParams:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-models","person-models","gallery-models","photo-engagement-models","photo-stats-models","photo-curation-models"]});
