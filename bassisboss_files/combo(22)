YUI.add("fluid-magic-subnav-view",function(e,t){"use strict";var n=require("lib/flog")(t);e.FlickrView.create(this.name,e.namespace("Views")["fluid-subnav-view"],[],{langBundles:this.details.langBundles,loadState:function(){var e=[],t=this;return e.push(this.appContext.getModel("person-relationship-models",this.nsid).then(function(e){t.set("relationship",e)},function(t){n.warn({err:t})})),this.constructor.superclass.loadState.call(this,e)},activate:function(){return this.get("relationship")&&this.registerEventHandler(this.get("relationship").on("valuesChanged",this.handleDataChanged.bind(this))),this.constructor.superclass.activate.call(this)},handleDataChanged:function(e){"isIgnored"in e&&e.isIgnored.newVal===!1&&this.populateUrls(this.get("personModel"))},populateUrls:function(t){var n,r,i=this,s,o=!1,u=!1;n=e.URLHelper.generatePersonUrls(t),this.nsid!==this.appContext.getViewer().nsid&&(u=!0),this.get("relationship")&&this.get("relationship").getValue("isIgnored")&&(o=!0),this.set("links",[{name:this.intlMessage({intlName:"cameraroll.CAMERA_ROLL"}),id:"cameraroll",href:n.cameraroll,disabled:u},{name:this.intlMessage({intlName:"header.PHOTOSTREAM"}),id:"photostream",href:n.photostream},{name:this.intlMessage({intlName:"header.ALBUMS"}),id:"albums",href:n.albums},{name:this.intlMessage({intlName:"header.FAVORITES"}),id:"favorites",href:n.favorites},{name:this.intlMessage({intlName:"filter-bar.GROUPS"}),id:"groups",href:u?n.theirGroups:n.myGroups,disabled:u&&!this.appContext.flipper.isFlipped("enable-people-groups")},{name:this.intlMessage({intlName:"header.CREATIONS"}),id:"creations",href:n.creations,disabled:u},{name:this.intlMessage({intlName:"common.STATS"}),id:"stats",href:n.stats,disabled:u||!this.appContext.flipper.isFlipped("rebootify-stats")&&!this.get("personModel").getValue("isPro")}]),this.get("selected")&&(r=this.get("links").filter(function(e){return e.id===i.get("selected")}),r[0].selected=!0),s=[{text:this.intlMessage({intlName:"header.EDIT"}),href:n.edit,className:"server-only-link",hidden:u},{text:this.intlMessage({intlName:"header.MAP"}),href:n.map},{text:this.intlMessage({intlName:"common.GALLERIES"}),href:n.galleries},{text:this.intlMessage({intlName:"common.COLLECTIONS"}),href:n.collections},{text:this.intlMessage({intlName:"common.ARCHIVES"}),href:n.archives},{text:this.intlMessage({intlName:"common.TAGS"}),href:n.tags},{text:this.intlMessage({intlName:"common.PHOTOS_OF"}),href:n.photosOf},{text:this.intlMessage({intlName:"common.PROFILE"}),href:n.profile},{text:this.intlMessage({intlName:"common.POPULAR"}),href:n.popular,hidden:u},{text:this.intlMessage({intlName:"common.ACTIVITY"}),href:"/activity/",hidden:u},{text:this.intlMessage({intlName:"common.STATS"}),href:n.stats,hidden:u||!this.appContext.flipper.isFlipped("rebootify-stats")&&!this.get("personModel").getValue("isPro")},{text:this.intlMessage({intlName:"common.ORGANIZE"}),href:"/photos/organize/",hidden:u},{text:this.intlMessage({intlName:"header.GUESTPASS_HISTORY"}),href:"/invite/history/guests/",hidden:u},{text:this.intlMessage({intlName:"header.SEND_FLICKR_MAIL"}),href:"/mail/write/?to="+this.nsid,hidden:!u||!this.appContext.getViewer().signedIn},{text:this.intlMessage({intlName:"header.BLOCK"}),href:"/ignore.gne?id="+this.nsid,hidden:!u||o||!this.appContext.getViewer().signedIn}],this.set("moreLinks",s)}})},"@VERSION@",{requires:["flickr-view","fluid-subnav-view","url-helper"],langBundles:["filter-bar","header","common","cameraroll"]});
YUI.add("upload-file-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,t.PHOTO_FILE_EXTENSIONS=["jpg","jpeg","gif","png","tif","tiff","bmp"],t.VIDEO_FILE_EXTENSIONS=["3gp","3gp","avi","mov","mp4","mpg","mpeg","wmv","ogg","ogv","m2v"],e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(n){var r={id:n.id,file:n.file,filename:n.file.name,filesize:n.file.size},i=n.file.name.split("."),s=i[i.length-1];return s=/([A-Za-z0-9]+)/.exec(s),r.extension=s&&s[1]&&s[1].toLowerCase(),n.file.type&&(/^image\/.*$/.test(n.file.type)?r.mediaType="photo":/^video\/.*$/.test(n.file.type)&&(r.mediaType="video")),r.mediaType||r.extension&&(t.PHOTO_FILE_EXTENSIONS.indexOf(r.extension)>-1?r.mediaType="photo":t.VIDEO_FILE_EXTENSIONS.indexOf(r.extension)>-1&&(r.mediaType="video")),r.mediaType||(r.mediaType="invalid"),this.add(r),e.Promise.resolve(r)}},removeXHR:function(e){var t=this.getValue(e,"xhr");this.setValue(e,"xhr",null),t&&t.abort()},incrementNumTicketChecks:function(e){var t=this.getValue(e,"numTicketChecks");this.setValue(e,"numTicketChecks",t+1)},incrementNumRetries:function(e){var t=this.getValue(e,"numRetries");this.setValue(e,"numRetries",t+1)},addError:function(e,t){var n=this.getValue(e,"errors"),r=n.some(function(e){return e.type===t.type});r||(n.push(t),this.setValue(e,"errors",n))},attributes:{file:{},filename:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},filesize:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},mediaType:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},extension:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},isVideo:{readOnly:!0,derivedBy:["mediaType"],getter:function(e,t){var n=this.getValue(t,"mediaType");return n==="video"}},isValidFiletype:{readOnly:!0,derivedBy:["mediaType"],getter:function(e,t){var n=this.getValue(t,"mediaType");return n==="photo"||n==="video"}},bytesLoaded:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},bytesTotal:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},percentageLoaded:{readOnly:!0,derivedBy:["bytesLoaded","bytesTotal"],getter:function(e,t){var n=Math.ceil(this.getValue(t,"bytesLoaded")/this.getValue(t,"bytesTotal")*100);return n=Math.max(0,Math.min(e,100)),n}},xhr:{validator:function(e,t){return!e||e instanceof XMLHttpRequest},defaultValue:null},ticketId:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},numTicketChecks:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},numRetries:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},errors:{setter:function(e){return e?e instanceof Array||(e=[e]):e=[],e},defaultValue:[]},photoId:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:null}}})},"@VERSION@",{requires:["flickr-model-registry","attribute-helpers"]});
YUI.add("upload-error",function(e){var t=e.UploadError=function(e,n){this.type=e||t.types.GENERIC,this.message=n||""};t.prototype={getIntlKey:function(){return"uploader."+this.type},isRetryable:function(){return[t.types.FILE_UPLOAD_TIMEOUT,t.types.FILE_UPLOAD_FAILED].indexOf(this.type)!==-1},getUserFacingCategory:function(){switch(this.type){case t.types.INVALID_FILE:case t.types.FILE_TOO_SMALL:case t.types.FILE_TOO_LARGE:return t.userFacingCategories.INVALID_FILE;default:return t.userFacingCategories.GENERIC}}},t.types={GENERIC:"GENERIC",INVALID_FILE:"INVALID_FILE",TOO_MANY_FILES:"TOO_MANY_FILES",FILE_TOO_SMALL:"FILE_TOO_SMALL",FILE_TOO_LARGE:"FILE_TOO_LARGE",OVER_VIDEO_LIMIT:"OVER_VIDEO_LIMIT",OVER_BANDWIDTH_LIMIT:"OVER_BANDWIDTH_LIMIT",VIDEO_UPLOADS_DISABLED:"VIDEO_UPLOADS_DISABLED",FILE_UPLOAD_TIMEOUT:"FILE_UPLOAD_TIMEOUT",FILE_UPLOAD_ABORTED:"FILE_UPLOAD_ABORTED",FILE_UPLOAD_FAILED:"FILE_UPLOAD_FAILED",DUPLICATE_FILE:"DUPLICATE_FILE"},t.userFacingCategories={GENERIC:"GENERIC",TOO_MANY_FILES:"TOO_MANY_FILES",INVALID_FILE:"INVALID_FILE",CANCELED:"CANCELED",PROCESSING_ERROR:"PROCESSING_ERROR"}},"@VERSION@",{requires:[]});
YUI.add("upload-queue",function(e,t){"use strict";function h(){var e;p(),a=!1,f&&clearTimeout(f),l&&clearTimeout(l),c={progress:0,numFiles:0,numUploaded:0,numFailed:0};if(s)for(e in s)clearTimeout(s[e]);s={}}function p(){i={currentBatch:{},pending:[],transferring:{},waitingForTicket:{},transferred:{},checkingTicket:{},uploaded:{},failed:{}}}function d(t,n){if(YUI.Env.isServer)throw new Error("Y.UploadQueue creates a single object per session, and is designed for use only on the client.");o||(o=n,u=o.flipper.isFlipped("uploader-debugging")),t.forEach(function(t){i.currentBatch[t.id]=t;var n=!1;P(t)&&(O(t,e.UploadError.types.FILE_TOO_SMALL),n=!0),H(t)&&(O(t,e.UploadError.types.FILE_TOO_LARGE),n=!0),B(t)&&(O(t,e.UploadError.types.OVER_VIDEO_LIMIT),n=!0),j()&&(O(t,e.UploadError.types.OVER_BANDWIDTH_LIMIT),n=!0),F(t)&&(O(t,e.UploadError.types.VIDEO_UPLOADS_DISABLED),n=!0),n||(t.setValues({bytesLoaded:0,bytesTotal:t.getValue("filesize")}),i.pending.push(t))})}function v(t,n){o||(o=n,u=o.flipper.isFlipped("uploader-debugging")),t.forEach(function(t){i.currentBatch[t.id]=t,i.failed[t.id]=t,t.getValue("errors").forEach(function(n){e.UploadQueue.fire("error",{file:t,error:n})})})}function m(){I("========== batch started =========="),o.uploadIsInProgress()||(o.markUploadInProgress(!0),e.UploadQueue.fire("start",c)),!Object.keys(i.currentBatch).length||!i.pending.length?b():g()}function g(){var e;if(!i.pending.length)return;if(Object.keys(i.transferring).length>=r.maxParallelUploads)return;if(Object.keys(i.waitingForTicket).length>=r.maxParallelUploadsWaitingForTicket)return;e=i.pending.shift(),y(e)}function y(t){var n=new FormData,o=new XMLHttpRequest,u=e.config.flickr.api.hostname_client_upload,a,f,l,c,h,p;t.setValue("xhr",o),n.append("api_key",e.config.flickr.api.site_key),n.append("csrf",e.config.flickr.csrf.token),n.append("photo",t.getValue("file"),t.getValue("filename")),n.append("async","1"),n.append("is_public","0"),n.append("is_friend","0"),n.append("is_family","0"),n.append("hermes","1"),o.open("POST",u,!0),o.withCredentials=!0,a=f=function(n,r,i){r||(n&&n.type==="abort"?r=e.UploadError.types.FILE_UPLOAD_ABORTED:r=e.UploadError.types.FILE_UPLOAD_FAILED),i||(i=n?n.target.statusText:"");if(!p())return;t.removeXHR(),O(t,r,i),b()},l=function(n){var r,s,u,a;if(!p())return;if(o.status===200){if(!o.responseXML){O(t,e.UploadError.types.FILE_UPLOAD_FAILED,"Response XML failure");return}r=o.responseXML.documentElement,s=r.getAttribute("stat");if(s==="ok")t.setValue("ticketId",r.getElementsByTagName("ticketid")[0].firstChild.nodeValue),i.transferred[t.id]=t,E(t),g();else{u=r.getElementsByTagName("err"),a=u&&u[0]&&u[0].getAttribute("code");switch(parseInt(a,10)){case 5:O(t,e.UploadError.types.INVALID_FILE,s);break;case 6:O(t,e.UploadError.types.OVER_BANDWIDTH_LIMIT,s);break;case 7:O(t,e.UploadError.types.OVER_VIDEO_LIMIT,s);break;case 9:O(t,e.UploadError.types.DUPLICATE_FILE,s);break;default:O(t,e.UploadError.types.FILE_UPLOAD_FAILED,s)}}}else O(t,e.UploadError.types.FILE_UPLOAD_FAILED,"Upload API failure with status: "+o.status);t.removeXHR(),b()},c=function(e){var n,o;if(!e.lengthComputable)return;t.setValue("bytesLoaded",e.loaded),t.setValue("bytesTotal",e.total),b(),e.loaded>=e.total?(delete i.transferring[t.id],i.waitingForTicket[t.id]=t,g(),n=r.ticketReceiptTimeoutDelay):n=r.transferTimeoutDelay,o=s[t.id],o&&clearTimeout(o),s[t.id]=setTimeout(h,n)},h=function(){a(null,e.UploadError.types.FILE_UPLOAD_TIMEOUT)},p=function(){return t.getValue("xhr")?(o.removeEventListener("load",l),o.removeEventListener("error",a),o.removeEventListener("abort",f),o.upload.removeEventListener("progress",c),clearTimeout(s[t.id]),delete s[t.id],delete i.transferring[t.id],delete i.waitingForTicket[t.id],!0):!1},o.addEventListener("load",l),o.addEventListener("error",a),o.addEventListener("abort",f),o.upload.addEventListener("progress",c),i.transferring[t.id]=t,o.send(n)}function b(){if(!o.uploadIsInProgress())return;var t=Object.keys(i.currentBatch).length,n=Object.keys(i.uploaded).length,s=Object.keys(i.failed).length,u=0,a=0,f=0,h=c?c.progress:0,p,d;for(p in i.currentBatch){d=i.currentBatch[p];if(i.failed[d.id])continue;u+=d.getValue("bytesLoaded"),a+=d.getValue("bytesTotal")}s>=t?f=1:(f+=r.progressRatios.transferring*u/a,f+=r.progressRatios.flickrizing*n/(t-s)),c={progress:f,numFiles:t,numUploaded:n,numFailed:s},I("progress: ",c),e.UploadQueue.fire("progress",c),f>h&&(clearTimeout(l),l=setTimeout(D,r.networkOfflineTimeoutDelay)),f>=1&&_()}function w(){return e.merge(c)}function E(e){I("beginCheckingTicket() ticket id:",e.getValue("ticketId")),i.checkingTicket[e.id]=e,S()}function S(){if(a)return;var t=[],n={};Object.keys(i.checkingTicket).forEach(function(e){var r=i.checkingTicket[e],s=r.getValue("ticketId");t.push(s),n[s]=r}),I("open tickets:",t);if(!t.length)return;a=!0,o.callAPI("flickr.photos.upload.checkTickets",{tickets:t.join(",")}).then(function(t){I("ticket response:",t),t&&t.stat&&t.stat==="ok"&&t.uploader&&t.uploader.ticket instanceof Array?(t.uploader.ticket.forEach(function(t){var r=n[t.id];if(!r)return;parseInt(t.complete,10)===1?(r.setValue("photoId",t.photoid),A(r)):parseInt(t.complete,10)===2?O(r,e.UploadError.types.INVALID_FILE):parseInt(t.invalid,10)===1?O(r,e.UploadError.types.FILE_UPLOAD_FAILED):T(r)}),N(!0)):x()},x)}function x(e){var t,n;for(t in i.checkingTicket)n=i.checkingTicket[t],T(n);N(!1)}function T(t){t.incrementNumTicketChecks(),t.getValue("numTicketChecks")>=r.maxNumTicketChecks&&O(t,e.UploadError.types.FILE_UPLOAD_FAILED)}function N(e){a=!1;if(!Object.keys(i.checkingTicket).length)return;var t=r.ticketCheckPollTime[e?"afterOKResponse":"afterBadResponse"];f=setTimeout(S,t)}function C(e){I("retrying fileModel.id:",e.id),e.incrementNumRetries(),M(e),d([e],o)}function k(){var e;for(e in i.currentBatch)M(i.currentBatch[e]);_(!0)}function L(){var e;o.getModelRegistry("photostream-models").then(function(t){e=t.attributeSearch({normalizedId:o.getViewer().nsid},!0),e.forEach(function(e){t.remove
(e)})})}function A(t){M(t),i.uploaded[t.id]=t,e.UploadQueue.fire("success",{file:t}),b()}function O(t,s,o){var u=new e.UploadError(s,o),a=u.isRetryable();t.addError(u),n.error("Error during upload",{type:s,message:o}),e.UploadQueue.fire("error",{file:t,error:u}),a&&t.getValue("numRetries")<r.maxNumRetries?C(t):(i.failed[t.id]=t,M(t),e.UploadQueue.fire("fail",{file:t,error:u})),b(),g()}function M(e){var t=i.pending.indexOf(e.id);t!==-1&&i.pending.splice(t,1),delete i.transferring[e.id],delete i.waitingForTicket[e.id],delete i.transferred[e.id],delete i.checkingTicket[e.id],e.removeXHR()}function _(t){try{t?(I("========== batch canceled =========="),e.UploadQueue.fire("canceled")):(I("========== batch complete =========="),!Object.keys(i.uploaded).length||L(),e.UploadQueue.fire("complete",{uploaded:e.merge(i.uploaded),failed:e.merge(i.failed)}))}catch(r){n.error("Error in event handler onBatchComplete",{err:r})}o.markUploadInProgress(!1),h()}function D(){e.UploadQueue.fire("offline"),k()}function P(e){var t=e.getValue("filesize");return!t||t<=0}function H(e){var t=r.uploadLimits.pro.sizes.video,n=r.uploadLimits.pro.sizes.photo,i=e.getValue("filesize"),s=e.getValue("isVideo");return s&&i>t?!0:!s&&i>n?!0:!e.getValue("mediaType")&&i>n&&i>t?!0:!1}function B(e){return!1}function j(){var e=0;return e>r.uploadLimits.pro.monthlyBandwidthLimit}function F(e){return r.videoUploadsDisabled&&e.getValue("isVideo")}function I(){var e=new Array(arguments.length);for(var t=0;t<e.length;++t)e[t]=arguments[t];e.unshift("[UPLOAD]"),u&&console.log.apply(console,e)}var n=require("lib/flog")(t),r={maxParallelUploads:1,maxParallelUploadsWaitingForTicket:4,maxNumTicketChecks:100,maxNumRetries:2,videoUploadsDisabled:!1,editrBatchId:23,ticketCheckPollTime:{afterOKResponse:1e3,afterBadResponse:3e3},transferTimeoutDelay:15e3,ticketReceiptTimeoutDelay:6e4,networkOfflineTimeoutDelay:9e4,uploadLimits:{pro:{sizes:{photo:209715200,video:1073741824},videoCountMonthlyLimit:Number.MAX_VALUE,monthlyBandwidthLimit:214748364800},nonPro:{sizes:{photo:209715200,video:1073741824},videoCountMonthlyLimit:2,monthlyBandwidthLimit:214748364800}},progressRatios:{transferring:.65,flickrizing:.35,publishing:0,adding:0}},i,s,o,u=!1,a,f,l,c;(function(){h()})(),e.UploadQueue={addToQueue:d,addToFailedQueue:v,beginProcessing:m,getBatchProgress:w,cancelBatch:k},e.UploadQueue.exposedForUnitTests={queues:i,checkForNextUpload:g,fileSizeTooSmall:P,fileSizeTooLarge:H,fileOverVideosPerMonth:B,fileOverMonthlyBandwidth:j,fileIsDisabledVideo:F},e.augment(e.UploadQueue,e.EventTarget,!0,null,{emitFacade:!0})},"@VERSION@",{requires:["event-custom","upload-file-models","upload-error"]});
YUI.add("upload-file-picker",function(e,t){var n=require("lib/flog")(t),r={selectors:{dropzone:".uploader-drop-zone",filePickerInput:"#uploader-input"},classes:{dropzoneActive:"active"},maxNumFiles:Number.POSITIVE_INFINITY,allowVideo:!0,allowedFileTypes:{photo:e.Models["upload-file-models"].PHOTO_FILE_EXTENSIONS.concat(),video:e.Models["upload-file-models"].VIDEO_FILE_EXTENSIONS.concat()},documentHandlesDragEvents:!0},i=e.UploadFilePicker=function(t,n){this.initedSuccessfully=!1;if(!this._fileAPIIsSupported())return;t=t?e.clone(t):{},this.config=e.merge(r,t),this.appContext=n,this.isUploading=!1,this.initUI(),e.UploadQueue.addTarget(this),this.initedSuccessfully=!0,this.dragDropTracker={},this.dragLeaveTimeout=null};i.prototype={initUI:function(){this.dropzone=e.one(this.config.selectors.dropzone),this.boundEventHandlers={inputChange:this.handleInputChange.bind(this),dragover:this.handleDragOver.bind(this),dragenter:this.handleDragEnter.bind(this),dragleave:this.handleDragLeave.bind(this),drop:this.handleDrop.bind(this)},this.filePickerInput=e.one(this.config.selectors.filePickerInput),this.filePickerInput&&this.filePickerInput.on("change",this.boundEventHandlers.inputChange),this.config.documentHandlesDragEvents?(e.config.doc.addEventListener("dragover",this.boundEventHandlers.dragover),e.config.doc.addEventListener("dragenter",this.boundEventHandlers.dragenter),e.config.doc.addEventListener("dragleave",this.boundEventHandlers.dragleave),e.config.doc.addEventListener("drop",this.boundEventHandlers.drop)):this.dropzone},disableUI:function(){if(!this.boundEventHandlers)return;this.filePickerInput&&this.filePickerInput.detach("change",this.boundEventHandlers.inputChange),this.config.documentHandlesDragEvents?(e.config.doc.removeEventListener("dragover",this.boundEventHandlers.dragover),e.config.doc.removeEventListener("dragenter",this.boundEventHandlers.dragenter),e.config.doc.removeEventListener("dragleave",this.boundEventHandlers.dragleave),e.config.doc.removeEventListener("drop",this.boundEventHandlers.drop)):this.dropzone,this.boundEventHandlers=null},reset:function(t){var n;if(this.dropzone)for(n in this.config.classes)this.dropzone.removeClass(this.config.classes[n]);t&&e.UploadQueue.cancelBatch()},destroy:function(){this.reset(!1),this.disableUI()},handleDragOver:function(e){e.stopImmediatePropagation(),e.preventDefault()},handleDragEnter:function(t){if(e.OverlayManager.ModalOverlay.alreadyShowingModal())return;var n=e.one(t.target).generateID();t.stopImmediatePropagation(),t.preventDefault(),Object.keys(this.dragDropTracker).length===0&&this.dropzone&&this.dropzone.addClass(this.config.classes.dropzoneActive),this.dragDropTracker[n]=!0},handleDragLeave:function(t){var n=e.one(t.target).generateID();t.stopImmediatePropagation(),t.preventDefault(),delete this.dragDropTracker[n],clearTimeout(this.dragLeaveTimeout),this.dragLeaveTimeout=setTimeout(function(){Object.keys(this.dragDropTracker).length===0&&this.dropzone&&this.dropzone.removeClass(this.config.classes.dropzoneActive)}.bind(this),100)},handleDrop:function(n){if(e.OverlayManager.ModalOverlay.alreadyShowingModal())return;n.stopImmediatePropagation(),n.preventDefault(),e.OverlayManager.ModalOverlay.close(),this.dropzone&&this.dropzone.removeClass(this.config.classes.dropzoneActive);var r;r=n.dataTransfer.items||n.dataTransfer.files,this.enqueueFiles(r),e.rapidTracker.beacon(t,"uploadrFileDropped",{count:r.length})},handleInputChange:function(e){e._event.target&&e._event.target.files&&this.enqueueFiles(e._event.target.files),this.filePickerInput.set("value","")},enqueueFiles:function(t){var r=[];if(!t)return;return t=this.normalizeFiles(t),r=t.map(function(t){var n=e.guid();return this.appContext.getModel("upload-file-models",n,{id:n,file:t})}.bind(this)),e.Promise.all(r).then(function(t){var n=this.validateFiles(t),r=[],i;n.valid.length&&e.UploadQueue.addToQueue(n.valid,this.appContext),n.invalid.forEach(function(t){i=new e.UploadError(e.UploadError.types.INVALID_FILE),t.addError(i),r.push(t)}.bind(this)),n.excess.forEach(function(t){i=new e.UploadError(e.UploadError.types.TOO_MANY_FILES),t.addError(i),r.push(t)}.bind(this)),r.length&&e.UploadQueue.addToFailedQueue(r,this.appContext),e.UploadQueue.beginProcessing()}.bind(this),function(e){n.error("upload error",{err:e})})},normalizeFiles:function(e){var t=[],n,r,i;e.length||(e=[e]);for(n=0;n<e.length;n++){r=e[n];if(r.isFile||r.isDirectory)i=r;else if(r.getAsEntry)i=r.getAsEntry();else{if(!r.webkitGetAsEntry){if(typeof r.getAsFile=="function"){t.push(r.getAsFile());continue}if(Blob&&r instanceof Blob){t.push(r);continue}continue}i=r.webkitGetAsEntry()}if(!i)continue;i.isFile?r.getAsFile&&t.push(r.getAsFile()):i.isDirectory}return t},validateFiles:function(e){var t=[],n=[],r=[];return e.forEach(function(e){e.getValue("isValidFiletype")?e.getValue("isVideo")?this.config.allowVideo?this.config.allowedFileTypes.video[e.getValue("extension")]===-1?n.push(e):t.push(e):n.push(e):this.config.allowedFileTypes.photo.indexOf(e.getValue("extension"))===-1?n.push(e):t.push(e):n.push(e)}.bind(this)),t.length>this.config.maxNumFiles&&(r=t.slice(this.config.maxNumFiles),t=t.slice(0,this.config.maxNumFiles)),{valid:t,invalid:n,excess:r}},_fileAPIIsSupported:function(){return e.config.win.File&&e.config.win.FileList&&e.config.win.FileReader}},e.augment(e.UploadFilePicker,e.EventTarget)},"@VERSION@",{requires:["event-custom","upload-file-models","upload-queue","upload-error","fluid-overlay-manager-view"]});
YUI.add("hermes-template-uploader-minimal",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="notification">\n	<div class="header">',u={hash:{intlName:"common.UPLOADING"},data:i},s+=f((o=n.intlMessage||t.intlMessage,o?o.call(t,u):a.call(t,"intlMessage",u)))+'</div>\n	<div class="progress-bar"><div class="progress"></div></div>\n	<div class="progress-text"></div>\n	<a class="progress-cancel">',u={hash:{intlName:"common.CANCEL"},data:i},s+=f((o=n.intlMessage||t.intlMessage,o?o.call(t,u):a.call(t,"intlMessage",u)))+'</a>\n</div>\n\n<div class="uploader-drop-zone">\n	<div class="drop-here">\n		<div class="uploader-centered-content">\n			<i></i>\n			<h5>',u={hash:{intlName:"common.UPLOAD_DROP_TARGET"},data:i},s+=f((o=n.intlMessage||t.intlMessage,o?o.call(t,u):a.call(t,"intlMessage",u)))+"</h5>\n		</div>\n	</div>\n</div>\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/uploader-minimal",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-uploader-minimal-errors",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function c(e,t){var r="",i,s,o;r+="\n<p>",o={hash:{intlName:e.title},data:t},r+=a((i=n.intlHTMLMessage||e.intlHTMLMessage,i?i.call(e,o):f.call(e,"intlHTMLMessage",o)))+'</p>\n<div class="file-list-container">\n	<table>\n		<tbody>\n			',s=n.each.call(e,e.files,{hash:{},inverse:l.noop,fn:l.program(2,h,t),data:t});if(s||s===0)r+=s;return r+="\n		</tbody>\n	</table>\n</div>\n",r}function h(e,t){var r="",i;return r+='\n			<tr>\n				<th class="col100">',(i=n.filename)?i=i.call(e,{hash:{},data:t}):(i=e.filename,i=typeof i===u?i.apply(e):i),r+=a(i)+"</th>\n			</tr>\n			",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=n.helperMissing,l=this;o=n.each.call(t,t.errorList,{hash:{},inverse:l.noop,fn:l.program(1,c,i),data:i});if(o||o===0)s+=o;return s+="\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/uploader-minimal-errors",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("uploader-minimal-view",function(e){e.namespace("Views")[this.name]=e.Base.create("uploader-minimal-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.numItemsUploadedForNotification=e.numItemsUploadedForNotification||Number.POSITIVE_INFINITY,this.firedInitialUploadsNotification=!1,this.willNavigateAfterInitialUpload=e.willNavigateAfterInitialUpload,this.uploadFilePicker=null,this.notification=null,this.dropzone=null,this},loadState:function(){return e.Promise.resolve()},buildContainer:function(){var e={};return this.setContainerHTML(this.templates("uploader-minimal")(e)),this.notification=this.get("container").one(".notification"),this.dropzone=this.get("container").one(".uploader-drop-zone"),this},activate:function(){return this.initUI(),this.uploadFilePicker=new e.UploadFilePicker(null,this.appContext),this.handleEvents(),this},destructor:function(){this.uploadFilePicker&&this.uploadFilePicker.destroy()},reconnect:function(){var t=e.UploadQueue.getBatchProgress(),n=this.appContext.retrievePendingUploadErrorModal();t&&t.progress>0&&t.progress<1&&this.notification.addClass("active"),n&&this.showErrorModal(n)},initUI:function(){this.registerEventHandler(this.get("container").one(".progress-cancel").on("click",this.handleCancel.bind(this)))},updateNotificationUI:function(e){var t=Math.min((e.numComplete||0)+1,e.numFiles)+"",n=e.numFiles||"0",r=e.progress||"0";this.notification.one(".progress-bar > .progress").setStyle("width",r+"%"),this.notification.one(".progress-text").setHTML(this.intlMessage({intlName:"common.NUMERIC_PROGRESS_COUNT",progress:t,total:n}))},handleCancel:function(){this.uploadFilePicker.reset(!0)},handleEvents:function(){this.registerEventHandler(this.uploadFilePicker.on("start",this.onUploadStart.bind(this))),this.registerEventHandler(this.uploadFilePicker.on("progress",this.onUploadProgress.bind(this))),this.registerEventHandler(this.uploadFilePicker.on("complete",this.onUploadEnd.bind(this))),this.registerEventHandler(this.uploadFilePicker.on("canceled",this.onUploadEnd.bind(this)))},onUploadStart:function(e){this.onUploadProgress(e),this.notification.addClass("active"),this.fire("upload:start")},onUploadProgress:function(e){this.updateNotificationUI({progress:Math.ceil(e.progress*100),numComplete:e.numUploaded+e.numFailed,numFiles:e.numFiles}),!this.firedInitialUploadsNotification&&e.numUploaded>=this.numItemsUploadedForNotification&&this.notifyInitialItemsComplete()},onUploadEnd:function(e){var t=e&&e.uploaded?Object.keys(e.uploaded).length:0;this.notification.removeClass("active"),t&&!this.firedInitialUploadsNotification&&this.numItemsUploadedForNotification&&this.notifyInitialItemsComplete(),e&&e.failed&&Object.keys(e.failed).length&&this.displayErrors(e.failed),this.fire("upload:complete",{numUploaded:t})},displayErrors:function(t){var n={},r,i,s,o,u,a,f;for(i in t)r=t[i],r.getValue("errors").forEach(function(e){s=r.toJSON(),o=e.getUserFacingCategory(),n[o]||(n[o]={title:this.getIntlKeyForErrorCategory(o),files:[]}),u=n[o],u.files.push(s)}.bind(this));a=Object.keys(n).map(function(e){return n[e].files.sort(function(e,t){return e.filename<t.filename?-1:t.filename<e.filename?1:0}),n[e]}),f=new e.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"common.UPLOAD_ERROR_TITLE"}),showActionButton:!0,showCancelButton:!1,classList:"uploader-minimal-view-error-dialog",htmlMessage:this.templates("uploader-minimal-errors")({errorList:a})}),this.firedInitialUploadsNotification&&this.willNavigateAfterInitialUpload?this.appContext.storePendingUploadErrorModal(f):this.showErrorModal(f)},showErrorModal:function(e){this.appContext.storePendingUploadErrorModal(null),e.show()},notifyInitialItemsComplete:function(){this.fire("subviewViewEvent","initialUploadsComplete"),this.firedInitialUploadsNotification=!0},getIntlKeyForErrorCategory:function(t){switch(t){case e.UploadError.userFacingCategories.INVALID_FILE:return"common.UPLOAD_ERROR_CATEGORY_INVALID";case e.UploadError.userFacingCategories.GENERIC:case e.UploadError.userFacingCategories.TOO_MANY_FILES:case e.UploadError.userFacingCategories.CANCELED:case e.UploadError.userFacingCategories.PROCESSING_ERROR:default:return"common.UPLOAD_ERROR_CATEGORY_GENERIC"}}})},"@VERSION@",{requires:["upload-file-picker","hermes-template-uploader-minimal","hermes-template-uploader-minimal-errors","uploader-minimal-css","fluid-modal-view","upload-error"],langBundles:["common"]});
