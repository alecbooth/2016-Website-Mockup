YUI.add("group-pool-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-groups-pools-getPhotos"].run(t,this.appContext)},addPhoto:function(t,n){return t.registryName=this.name,e.ModelCreators["flickr-groups-pools-add"].run(t,n)},removePhoto:function(t,n){return t.registryName=this.name,e.ModelDeletors["flickr-groups-pools-remove"].run(t,n)},invitePhoto:function(t,n){return e.ModelCreators["flickr-groups-invite-photo-invite"].run(t,n)},cancelPhotoInvitation:function(t,n){return e.ModelDeletors["flickr-groups-invite-photo-cancel"].run(t,n)}},addPhotoLocal:function(e,t){return this.getValue(e,"photoPageList").unshift(t),this.getValue(e,"photoContextList").hasMaxBoundary()&&this.getValue(e,"photoContextList").appendToList(t),this},addPhotoRemote:function(e,t){return this.remote.addPhoto.call(this,{photoID:t,groupID:e},this.appContext)},removePhotoLocal:function(e,t){return this.getValue(e,"photoPageList").removeFromList(t.getValue("id")),this.getValue(e,"photoContextList").removeFromList(t.getValue("id")),this},removePhotoRemote:function(e,t){return this.remote.removePhoto.call(this,{photoID:t,groupID:e},this.appContext)},invitePhotoRemote:function(e,t){return this.remote.invitePhoto.call(this,{photoID:t,groupID:e},this.appContext)},cancelPhotoInvitationRemote:function(e,t){return this.remote.cancelPhotoInvitation.call(this,{photoID:t,groupID:e},this.appContext)},hasPhoto:function(e,t){return this.getValue(e,"photoPageList").getFromListByID(t)||this.getValue(e,"photoContextList").getFromListByID(t)},attributes:{displayType:{readOnly:!0,defaultFn:function(){return"group"}},pathAlias:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultFn:function(e){return e}},photoPageList:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-groups-pools-getPhotos"]}},photoContextList:{isListProxy:!0,contextFetch:{listFetcher:e.ListFetchers["flickr-groups-pools-getContext"],listItemIdField:"photoId"}},group:{isModel:!0},urlSuffix:{readOnly:!0,derivedBy:["pathAlias"],defaultFn:function(e){var t=this.getValue(e,"pathAlias");return t||(t=e),"pool-"+t}},url:{readOnly:!0,derivedBy:["group"],defaultFn:function(e){return this.getValue(e,"group").getValue("url")}},title:{readOnly:!0,derivedBy:["group"],defaultFn:function(e){return this.getValue(e,"group").getValue("title")}},poolCount:{readOnly:!0,derivedBy:["group"],defaultFn:function(e){return this.getValue(e,"group").getValue("poolCount")}},filteredPoolCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultFn:function(e){return this.getValue(e,"group").getValue("poolCount")}},friendlyPoolCount:{readOnly:!0,derivedBy:["group"],defaultFn:function(e){return this.getValue(e,"group").getValue("friendlyPoolCount")}}}},{buildCompoundId:function(e,t){return e+"-"+t},extractGroupFromCompoundId:function(e){return e.split("-")[0]}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-groups-pools-getContext-fetcher","flickr-groups-pools-getPhotos-fetcher","flickr-groups-pools-add-creator","flickr-groups-pools-remove-deletor","flickr-groups-invite-photo-invite-creator","flickr-groups-invite-photo-cancel-deletor","attribute-helpers"],optional:["group-top-contributors-models"]});
YUI.add("flickr-groups-pools-getGroups-fetcher",function(e,t){"use strict";function n(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=r.groups,a=n.id,f={},l=[];if(u)return u.group&&e.Array.each(u.group,function(e,t){var n,r,i;i=o.parseGroupModel(e.id,e.pathAlias,e),n=o.addOrUpdate(i),r=s.addOrUpdate({id:e.id,pathAlias:e.pathAlias,group:n}),l.push(r)}),f={id:a,memberCount:r.userGroupMemberships?r.userGroupMemberships.member:null,moderatorCount:r.userGroupMemberships?r.userGroupMemberships.moderator:null,adminCount:r.userGroupMemberships?r.userGroupMemberships.admin:null,invitedCount:r.userGroupMemberships?r.userGroupMemberships.invited:null},f.groups=e.APIHelper.response.addOrReplaceListByPage({current:i.exists(a)?i.proxy(a).getValue("groups").getList():[],perPage:n.perPage,pageNum:n.page,totalItems:r.groups.total,newPages:l}),i.exists(a)?i.setValue(a,"groups",f.groups):i.add(f),f.groups}function r(n,r){var i=this;return e.Promise.all([r.callAPI("flickr.groups.pools.getGroups",{extras:e.APIHelper.request.getRebootGroupExtras()+", icon_urls, needs_interstitial",page:n.page||0,per_page:n.perPage||400},!0),r.getModelRegistry("person-groups-models"),r.getModelRegistry("group-pool-models"),r.getModelRegistry("group-models")]).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ListFetchers")["flickr-groups-pools-getGroups"]={run:r,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["person-groups-models","group-models","group-pool-models","person-models"]});
YUI.add("flickr-groups-fave-fetcher",function(e,t){"use strict";function n(e){}function r(n,r){var i=this;return e.Promise.all([r.callAPI("flickr.groups.fave",n),r.getModelRegistry("person-groups-models")]).then(i._processResponse,e.FetcherErrorLogger(t))}e.namespace("ModelFetchers")["flickr-groups-fave"]={run:r,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","flickr-promise"],optional:["person-groups-models","api-helper"]});
YUI.add("flickr-groups-unfave-fetcher",function(e,t){"use strict";function n(e){}function r(n,r){var i=this;return e.Promise.all([r.callAPI("flickr.groups.unfave",n),r.getModelRegistry("person-groups-models")]).then(i._processResponse,e.FetcherErrorLogger(t))}e.namespace("ModelFetchers")["flickr-groups-unfave"]={run:r,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","flickr-promise"],optional:["person-groups-models","api-helper"]});
YUI.add("flickr-people-getGroupsWithStatus-fetcher",function(e,t){"use strict";function n(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=r.groups,a=n.id,f,l={},c=[];if(u)return e.Array.each(u,function(t,r){var i,u,a,l=s.parseGroupModel(n.id,n.pathAlias,t);i=s.addOrUpdate(l),c.push(i),t.viewDates?(t.viewDates.pool!=="0"?u=e.moment(t.viewDates.pool,"X"):u=o.getDefaultViewedDate(),t.viewDates.discussions!=="0"?a=e.moment(t.viewDates.discussions,"X"):a=o.getDefaultViewedDate(),a.isValid()||(a=o.getDefaultViewedDate()),u.isValid()||(u=o.getDefaultViewedDate())):(u=o.getDefaultViewedDate(),a=o.getDefaultViewedDate()),f={id:l.id,viewedPool:u,viewedDiscussions:a,group:i},o.addOrUpdate(f)}),l={id:a,memberCount:r.members?r.members:null,moderatorCount:0,adminCount:0,invitedCount:0},l[n.attribute]=c,i.exists(a)?i.setValue(a,n.attribute,l[n.attribute]):i.add(l),l[n.attribute]}function r(n,r){var i=this,s={extras:e.APIHelper.request.getRebootGroupExtras()+", icon_urls, date_activity, date_last_viewed",user_id:n.id,status:n.status};return n.id!==r.getViewer().nsid&&(s.public_only=1,s.status="2,3,4"),e.Promise.all([r.callAPI("flickr.people.getGroupsWithStatus",s,!0),r.getModelRegistry("person-groups-models"),r.getModelRegistry("group-models"),r.getModelRegistry("group-activity-models")]).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ListFetchers")["flickr-people-getGroupsWithStatus"]={run:r,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["person-groups-models","group-models"]});
YUI.add("person-groups-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-people-getInfo"].run(t,this.appContext)},faveGroup:function(t,n){return e.ModelFetchers["flickr-groups-fave"].run(t,n)},unfaveGroup:function(t,n){return e.ModelFetchers["flickr-groups-unfave"].run(t,n)}},faveGroup:function(e){var t=this,n=e.group_id,r=e.user_id;return this.remote.faveGroup(e,this.appContext).then(null,function(){t.appContext.getModel("group-models",n).then(function(e){t.getValue(r,"groupsFaved").removeFromList(n)})}),this.appContext.getModel("group-models",n).then(function(e){t.getValue(r,"groupsFaved").appendToList(e)})},unfaveGroup:function(e){var t=e.group_id,n=e.user_id,r=this;return this.remote.unfaveGroup(e,this.appContext).then(null,function(){r.appContext.getModel("group-models",t).then(function(e){r.getValue(n,"groupsFaved").appendToList(e)})}),this.appContext.getModel("group-models",t).then(function(e){r.getValue(n,"groupsFaved").removeFromList(t)})},attributes:{id:{},memberCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},moderatorCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},adminCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},invitedCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},groups:{isListProxy:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-groups-pools-getGroups"]}},groupsAdministered:{isListProxy:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-people-getGroupsWithStatus"]}},groupsModerated:{isListProxy:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-people-getGroupsWithStatus"]}},groupsBelongingTo:{isListProxy:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-people-getGroupsWithStatus"]}},groupsFaved:{isListProxy:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-people-getGroupsWithStatus"]}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-groups-pools-getGroups-fetcher","flickr-people-getInfo-fetcher","flickr-groups-fave-fetcher","flickr-groups-unfave-fetcher","flickr-people-getGroupsWithStatus-fetcher"]});
YUI.add("person-curation-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-people-getInfo"].run(t,this.appContext)},update:function(t,n){var r={user_id:t};return"canPassOver"in n?e.ModelUpdaters["flickr-licensing-curation-passOverUser"].run(r,this.appContext):e.Promise.resolve()}},attributes:{enrollmentStatus:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},canPassOver:{validator:function(t,n){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-licensing-curation-passOverUser-updater","attribute-helpers"]});
YUI.add("flickr-photos-getContext-fetcher",function(e,t){"use strict";function n(t,n){var r;return r={photo_id:t.photoId,num_prev:t.numNext,num_next:t.numPrev,extras:e.APIHelper.request.getRebootPhotoExtras()},t.viewAs&&(r.view_as=t.viewAs),t.orderBy&&(r.order_by=t.orderBy),r}function r(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=[],l=[],c=s.proxy(n.photoId),h=c.getValue("owner"),p,d,v,m,g,y,b=[];return p=r.prevphotos,d=r.nextphotos,l=e.APIHelper.response.parsePhotos({photos:p.photo,existingPerson:h,photoModelRegistry:s,photoEngagementModelRegistry:o,photoStatsModelRegistry:u,photoCurationModelRegistry:a}),f=e.APIHelper.response.parsePhotos({photos:d.photo,existingPerson:h,photoModelRegistry:s,photoEngagementModelRegistry:o,photoStatsModelRegistry:u,photoCurationModelRegistry:a}),m=i.getValue(n.id,"photoContextList"),g=m.hasMinBoundary?m.hasMinBoundary():!1,y=m.hasMaxBoundary?m.hasMaxBoundary():!1,v=m.getList(),b=e.APIHelper.response.addOrReplaceListByContext({model:c,next:l,prev:f.reverse(),hasMin:g,hasMax:y,current:v,numNext:n.numNext,numPrev:n.numPrev}),i.setValue(n.id,"photoContextList",b),{next:l,previous:f.reverse()}}function i(n,r){var i=this;return e.Promise.all([r.callAPI("flickr.photos.getContext",this._processParams(n,r),!0),r.getModelRegistry("photostream-models"),r.getModelRegistry("photo-models"),r.getModelRegistry("photo-engagement-models"),r.getModelRegistry("photo-stats-models"),r.getModelRegistry("photo-curation-models")]).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ListFetchers")["flickr-photos-getContext"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photostream-models","photo-models","photo-engagement-models","photo-stats-models","photo-curation-models"]});
YUI.add("flickr-people-getPhotos-fetcher",function(e,t){"use strict";function n(t){var n={per_page:t.perPage||20,page:t.page||1,extras:e.APIHelper.request.getRebootPhotoExtras(),get_user_info:1,jump_to:t.withPhotoId||""};return t.id||t.userId?n.user_id=(t.id||t.userId).split("-")[0]:t.pathAlias&&(n.path_alias=t.pathAlias),t.privacyFilter&&(n.privacy_filter=t.privacyFilter),t.viewAs&&(n.view_as=t.viewAs),t.orderBy&&(t.orderBy==="datetaken"?n.sort="date-taken-desc":n.sort=t.orderBy),t.safeSearch&&(n.safe_search=t.safeSearch),t.media&&(n.media=t.media),t.withPhotoId&&(n.jump_to=t.withPhotoId),t.contentType&&(n.content_type=t.contentType),n}function r(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l,c,h=r&&r.user?r.user.nsid:null,p=n.id||n.userId;if(!h)throw new Error("API was missing valid nsid");return c={id:h,pathAlias:r.user.pathAlias,owner:e.APIHelper.response.parsePerson(r.user),totalItems:r.photos.total},p&&p!==h&&(c.id=p),c.owner=s.addOrUpdate(c.owner),l=e.APIHelper.response.parsePhotos({photos:r.photos.photo,ownerID:r.photos.owner,personModelRegistry:s,photoModelRegistry:i,photoEngagementModelRegistry:u,photoStatsModelRegistry:a,photoCurationModelRegistry:f}),c.photoPageList={perPage:r.photos.perpage,page:r.photos.page,pageContent:l,totalItems:parseInt(r.photos.total,10)||0},o.addOrUpdate(c),l}function i(n,r){var i=this;return e.Promise.all([r.callAPI("flickr.people.getPhotos",this._processParams(n),!0),r.getModelRegistry("photo-models"),r.getModelRegistry("person-models"),r.getModelRegistry("photostream-models"),r.getModelRegistry("photo-engagement-models"),r.getModelRegistry("photo-stats-models"),r.getModelRegistry("photo-curation-models")]).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ListFetchers")["flickr-people-getPhotos"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-models","person-models","photostream-models","photo-engagement-models","photo-stats-models","photo-curation-models"]});
YUI.add("photostream-models",function(e,t){function n(e){n.superclass.constructor.call(this,e)}e.Models[this.name]=n,e.extend(n,e.FlickrModelRegistry,{langBundles:this.details.langBundles,name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-people-getPhotos"].run(t,this.appContext)}},attributes:{normalizedId:{readOnly:!0,defaultFn:function(e){return e.split("-")[0]}},displayType:{readOnly:!0,defaultFn:function(){return"photostream"}},title:{readOnly:!0,derivedBy:["owner","normalizedId"],defaultFn:function(e){var t=this.appContext.getViewer(),n=this.getValue(e,"normalizedId"),r;return t&&t.nsid===n?this.intlMessage({intlName:"models.YOUR_PHOTOSTREAM"}):(r=this.getValue(e,"owner"),r?this.intlMessage({intlName:"models.USER_PHOTOSTREAM",name:r.getValue("displayname")}):this.intlMessage({intlName:"models.PHOTOSTREAM"}))}},pathAlias:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)||undefined},defaultFn:function(e){return this.getValue(e,"normalizedId")}},owner:{isModel:!0},isOwner:e.PhotoModelHelper.attributes.isOwner,photoPageList:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-people-getPhotos"]}},photoContextList:{isListProxy:!0,contextFetch:{listFetcher:e.ListFetchers["flickr-photos-getContext"],listItemIdField:"photoId"}},url:{readOnly:!0,derivedBy:["owner","normalizedId"],defaultFn:function(e){var t=this.getValue(e,"owner"),n=this.getValue(e,"normalizedId"),r=t?t.getValue("pathAlias"):n;return"/photos/"+r+"/"}},totalItems:{defaultFn:function(){return null}},urlSuffix:{readOnly:!0,defaultFn:function(e){var t,r=n.splitCompoundId(e);return r.orderBy?(t=r.orderBy,r.viewAs?t+="-"+r.viewAs:r.orderBy==="dateposted"&&(t="photostream")):t="photostream",t}}}},{buildCompoundId:function(e,t,n){var r=e;return t&&(r+="-"+t),n&&(t||(r+="-dateposted"),r+="-"+n),r},splitCompoundId:function(e){var t=e.split("-");return{nsid:t[0],orderBy:t[1],viewAs:t[2]}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photos-getContext-fetcher","flickr-people-getPhotos-fetcher","photo-model-helper"],langBundles:["models"]});
YUI.add("person-model-helper",function(e){e.PersonModelHelper={attributes:{pathAlias:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)||undefined},defaultFn:function(e){return e}},username:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},realname:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},displayname:{readOnly:!0,derivedBy:["username","realname"],getter:function(e,t){return this.getValue(t,"realname")||this.getValue(t,"username")}},nsid:{readOnly:!0,defaultFn:function(e){return e}},url:{readOnly:!0,derivedBy:["pathAlias"],defaultFn:function(e){var t=this.getValue(e,"pathAlias");return"/photos/"+t+"/"}},isMe:{readOnly:!0,defaultFn:function(e){var t=this.appContext.getViewer();return t.signedIn&&t.nsid===e}}}}},"@VERSION@",{requires:[]});
YUI.add("person-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-people-getInfo"].run(t,this.appContext)}},attributes:{pathAlias:e.PersonModelHelper.attributes.pathAlias,username:e.PersonModelHelper.attributes.username,realname:e.PersonModelHelper.attributes.realname,displayname:e.PersonModelHelper.attributes.displayname,nsid:e.PersonModelHelper.attributes.nsid,url:e.PersonModelHelper.attributes.url,isMe:e.PersonModelHelper.attributes.isMe,buddyicon:{},isPro:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},isMinor:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},proExpireDate:{validator:function(t){return e.AttributeHelpers.validateDate(t)},setter:function(t){return e.AttributeHelpers.coerceDate(t)},serialize:function(e){return e.format("X")},deserialize:function(t){return e.moment(t,"X")}},canBuyPro:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultFn:function(){return!1}},isDeleted:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},isAdFree:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},isNoAds:{derivedBy:["isPro","isAdFree"],readOnly:!0,getter:function(e,t){var n=this.getValue(t,"isPro"),r=this.getValue(t,"isAdFree");return n||r}},hasStats:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},hasAdfree:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},has1TB:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},has2TB:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},hasUnlimitedStorage:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},hasFreeStandardShipping:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},hasFreeEducationalResources:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},dateCreated:{validator:function(t){return e.AttributeHelpers.validateDate(t)},setter:function(t){return e.AttributeHelpers.coerceDate(t)},serialize:function(e){return e.format("X")},deserialize:function(t){return e.moment(t,"X")}},location:{defaultFn:function(){return""}},curation:{isModel:!0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-people-getInfo-fetcher","attribute-helpers","person-model-helper","person-curation-models"]});
YUI.add("flickr-people-getInfo-fetcher",function(e,t){"use strict";function n(t,n){var r={datecreate:1};r.extras=e.APIHelper.request.getRebootPeopleExtras(),YUI.Env.isServer&&t.id===n.request.probableUser&&(r.storage=1,r.extras+=", classic_user_id, active_group_membership, timezone_dst, unified_search_view_pref, photostream_view_order_pref, photostream_view_as_pref, album_view_layout, download_pref",n.flipper.isFlipped("enable-new-pro")&&(r.extras+=", products_features"),r.extras+=", is_minor"),t.extras&&typeof t.extras=="string"&&t.extras.length>0&&(r.extras=r.extras+","+t.extras);if(t.id)r.user_id=t.id;else{if(!t.pathAlias)throw new Error("`fetch` is missing required params.");r.path_alias=t.pathAlias}return t.storage&&(r.storage=t.storage),r.extras||(r.extras=""),r.extras+=", has_stats",r}function r(t,n,r){var i=t.apiResponse,s=t.personModelRegistry,o=t.personRelationshipModelRegistry,u=t.personProfileModelRegistry,a=t.personPreferencesModelRegistry,f=t.personGroupsModelRegistry,l=t.personNotificationsModelRegistry,c=t.personCurationModelRegistry,h=t.photostreamModelRegistry,p,d=i.person,v,m=r.getViewer(),g=d.id,y;return y={id:g,pathAlias:d.pathAlias,username:d.username&&d.username._content,realname:d.realname&&d.realname._content,buddyicon:e.APIHelper.response.agnosticizeFarmPathTransferProtocol(d.iconurls),isAdFree:d.isAdFree,isPro:d.ispro,isMinor:d.isMinor,canBuyPro:d.canBuyPro,hasStats:d.hasStats,location:d.location&&d.location._content,hasAdfree:d.hasAdfree,has1TB:d.has1TB,has2TB:d.has2TB,hasUnlimitedStorage:d.hasUnlimitedStorage,hasFreeStandardShipping:d.hasFreeStandardShipping,hasFreeEducationalResources:d.hasFreeEducationalResources,dateCreated:d.datecreate._content},d.ispro&&(y.proExpireDate=d.expire),s.addOrUpdate(y),l.addOrUpdate({id:g,unreadNotificationCount:0,unreadFlickrMailCount:0}),o.addOrUpdate({id:g,pathAlias:d.pathAlias,isContact:d.contact,isFriend:d.friend,isFamily:d.family,isIgnored:d.ignored,isIgnoredBy:d.ignoredby}),m&&m.signedIn&&g===m.nsid&&(v={id:g},d.safeSearch&&(v.safeSearch=(d.safeSearch||1)-1),d.viewPrefs&&(v.unifiedSearchViewPref=d.viewPrefs.unifiedSearchViewPref,v.photostreamViewOrderPref=d.viewPrefs.photostreamViewOrderPref,v.photostreamViewAsPref=d.viewPrefs.photostreamViewAsPref,v.albumViewLayoutPref=d.viewPrefs.albumViewLayout),a.exists(g)?a.setValues(g,v):a.add(v)),p={id:g,coverPhotoUrls:e.APIHelper.response.agnosticizeFarmPathTransferProtocol(d.coverphoto_url),photoCount:d.photos.count.content,location:d.location?d.location.content:null},d.storage&&(p.storageUsed=d.storage.used.content,p.storageTotal=d.storage.total.content),d.unreadMessages&&(p.unreadMessages=d.unreadMessages.content),u.addOrUpdate(p),f.addOrUpdate({id:g,memberCount:d.groupMemberships?d.groupMemberships.member:null,moderatorCount:d.groupMemberships?d.groupMemberships.moderator:null,adminCount:d.groupMemberships?d.groupMemberships.admin:null,invitedCount:d.groupMemberships?d.groupMemberships.invited:null}),c.addOrUpdate({id:g,enrollmentStatus:d.curation&&d.curation.status_name||"",canPassOver:d.curation&&d.curation.can_pass_over||!1}),h.addOrUpdate({id:g,pathAlias:d.pathAlias,owner:s.proxy(g),totalItems:d.photos.count&&d.photos.count.content}),d}function i(n,r){var i=this,s=r.getViewer(),o=!0;return s&&s.signedIn&&(n.id===s.nsid||n.nsid===s.nsid)&&(n.storage=1),(new e.FlickrPromise({apiResponse:r.callAPI("flickr.people.getInfo",this._processParams(n,r),o),personModelRegistry:r.getModelRegistry("person-models"),personRelationshipModelRegistry:r.getModelRegistry("person-relationship-models"),personProfileModelRegistry:r.getModelRegistry("person-profile-models"),personPreferencesModelRegistry:r.getModelRegistry("person-preferences-models"),personGroupsModelRegistry:r.getModelRegistry("person-groups-models"),personNotificationsModelRegistry:r.getModelRegistry("person-notifications-models"),personCurationModelRegistry:r.getModelRegistry("person-curation-models"),photostreamModelRegistry:r.getModelRegistry("photostream-models")})).then(function(e){return i._processResponse(e,n,r)},e.FetcherErrorLogger(t))}e.namespace("ModelFetchers")["flickr-people-getInfo"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise"],optional:["person-models","person-relationship-models","person-preferences-models","person-profile-models","person-groups-models","person-curation-models","photostream-models","api-helper"]});
YUI.add("person-relationship-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-people-getInfo"].run(t,this.appContext)},update:function(t,n){var r=[],i={};if(e.Lang.isObject(n,!0)){i.user_id=t,i.friend=this.getValue(t,"isFriend"),i.family=this.getValue(t,"isFamily"),"isContact"in n&&(n.isContact.newVal?r.push(e.ModelUpdaters["flickr-contacts-add"].run(i,this.appContext)):r.push(e.ModelUpdaters["flickr-contacts-remove"].run(i,this.appContext)));if("isFriend"in n||"isFamily"in n)"isFriend"in n&&(i.friend=n.isFriend.newVal),"isFamily"in n&&(i.family=n.isFamily.newVal),r.push(e.ModelUpdaters["flickr-contacts-edit"].run(i,this.appContext));"isIgnored"in n&&(n.isIgnored.newVal===!0?r.push(e.ModelUpdaters["flickr-contacts-block"].run(i,this.appContext)):r.push(e.ModelUpdaters["flickr-contacts-unblock"].run(i,this.appContext)))}return e.Promise.all(r)}},toggleFollowing:function(e){var t=this.getValue(e,"isContact");t?this.setValue(e,"isContact",!1):this.setValue(e,"isContact",!0)},toggleFriend:function(e){var t=this.getValue(e,"isFriend");t?this.setValue(e,"isFriend",!1):this.setValue(e,"isFriend",!0)},toggleFamily:function(e){var t=this.getValue(e,"isFamily");t?this.setValue(e,"isFamily",!1):this.setValue(e,"isFamily",!0)},toggleIgnore:function(e){var t=this.getValue(e,"isIgnored");t?this.setValue(e,"isIgnored",!1):this.setValue(e,"isIgnored",!0)},attributes:{pathAlias:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},isContact:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isFriend:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isFamily:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isIgnoredBy:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isIgnored:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isMe:{readOnly:!0,getter:function(e,t){var n=this.appContext.getViewer();return!!n&&this.getValue(t,"nsid")===n.nsid}},nsid:{readOnly:!0,defaultFn:function(e){return e}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-people-getInfo-fetcher","flickr-contacts-add-updater","flickr-contacts-remove-updater","flickr-contacts-edit-updater","flickr-contacts-block-updater","flickr-contacts-unblock-updater","attribute-helpers"]});
YUI.add("flickr-contacts-getListfetcher",function(e,t){"use strict";function n(t,n){var r=t[0],i=t[1];return r.contacts&&r.contacts.contact&&r.contacts.contact.forEach(function(t){i.addOrUpdate(e.APIHelper.response.parsePerson(t))}),r}function r(n,r){var i=this;return n.extras=(n.extras||"")+", icon_urls, paid_products",e.Promise.all([r.callAPI("flickr.contacts.getList",n),r.getModelRegistry("person-models")]).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ListFetchers")["flickr-contacts-getList"]={run:r,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["person-models"]});
YUI.add("contact-search-box",function(e){var t,n=function(n){this.options=n,this.options.elValue=this.options.elValue||"value",this.options.hideInitially||[],this._contacts=null,this.queryEl=this.options.el,this.queryElEvent,this.listEl=null,t=this.options.DOMContainer||e.config.win,this.init()};n.prototype={langBundles:["common","photo-page-scrappy"],init:function(){var t=this;this.options.showFollowingState!==!1&&(this.options.showFollowingState=!0),this.queryEl.on("keydown",this.keynav.bind(this)),this.queryElEvent=this.queryEl.on("keyup",this.search.bind(this)),this.wrapperEl=e.Node.create("<div/>"),this.wrapperEl.addClass("c-contact-search-autocomplete"),this.listEl=e.Node.create("<ul/>"),this.listEl.addClass("contact-list"),this.wrapperEl.appendChild(this.listEl),this.listEl.on("mouseover",function(e){var n=e.target.ancestor("li",!0);if(!n||n===t.highlighted)return;t._highlight(n)}),this.queryEl.ancestor().insertBefore(this.wrapperEl,this.queryEl),this.wrapperEl.appendChild(this.queryEl),this.options.clickContact=this.options.clickContact||function(e){var n=e.target.ancestor("[data-nsid]",!0),r=n?n.getData("nsid"):"";t.select(r)},this.listEl.delegate("click",this.options.clickContact,"li"),this.selectedIndex=0},keynav:function(e){e.keyCode===38?(e.preventDefault(),this.selectedIndex--,this.selectedIndex<0&&(this.selectedIndex=this.numShowing+this.selectedIndex),this._highlight(this.selectedIndex),this._scrollToNode(this.highlighted)):e.keyCode===40?(e.preventDefault(),this.selectedIndex++,this.selectedIndex>this.numShowing-1&&(this.selectedIndex=this.numShowing-this.selectedIndex),this._highlight(this.selectedIndex),this._scrollToNode(this.highlighted)):e.keyCode===9?this._visible&&this.highlighted&&(e.preventDefault(),this.select(this.highlighted.getData("nsid"))):e.keyCode===13&&this._visible&&this.highlighted&&(e.preventDefault(),!e.target.ancestor(".share-view",!0)&&!e.target.ancestor(".fluid-share-panel-view",!0)?this.options.clickContact(e,this.highlighted):this.select(this.highlighted.getData("nsid")))},_highlight:function(t){var n=this.listEl.all("li"),r=t instanceof e.Node,i=r?t:n.item(t),s=r?n.indexOf(t):t;i&&!i.hasClass("loading")&&!i.hasClass("no-members")&&(n.removeClass("highlight"),i.addClass("highlight"),this.selectedIndex=s,this.highlighted=i)},_scrollToNode:function(e){var t=this.listEl.get("scrollTop"),n=t+this.listEl.get("clientHeight"),r=e.get("offsetTop"),i=r+e.get("clientHeight"),s=5;t>r?this.listEl.set("scrollTop",r-s):n<i&&this.listEl.set("scrollTop",i-this.listEl.get("clientHeight")+s)},getContact:function(e){var t=0,n=this._contacts,r=n.length;for(;t<r;t++)if(n[t].nsid===e&&!n[t].hide)return n[t]},hideFromSearch:function(e){e=e.trim(),this._contacts&&this._contacts.some(function(t){if(t.nsid.trim()===e)return t.hide=!0,!0})},resetSearch:function(){this._contacts&&this._contacts.forEach(function(e){e.hide=!1})},showInSearch:function(e){e=e.trim(),this._contacts&&this._contacts.some(function(t){if(t.nsid.trim()===e)return t.hide=!1,!0})},load:function(e){var t={},n=this,r,i;if(this._busy)return;return this._end=!1,this._busy=!0,t.can_tag=this.options.canTag||0,i=this.options.appContext.getViewer().nsid,r=this.options.appContext.getModel("contacts-models",i),r.then(function(r){return t.page=1,t.perPage=3e3,t.per_page=3e3,n._loadMoreContacts(r,t,e)},function(){n._busy=!1,n.options.onError()})},_loadMoreContacts:function(e,t,n){var r=this;return this._busy=!0,r.options.loadingState&&!r.listEl.one("li.loading")&&r.appendLoader(),e.getValue("contacts").getPage(t).then(function(i){r._contacts=(r.processContactModels(i,!0,!0)||[]).concat(r._contacts||[]),n(),(!r._contacts||r._contacts.length===0)&&r.hide(),t.page<e.getValue("pages")&&(t.page++,r._loadMoreContacts(e,t,n))},function(){r._busy=!1,r.options.onError()})},processContactModels:function(t,n,r){var i=this,s,o,u;try{u=t.map(function(e){return e.toJSON()})||[]}catch(a){u=[]}if(!i.contactIds){i.contactIds={};if(i._contacts)for(o in i._contacts)i.contactIds[o.id]=!0}return u=u.filter(function(e){return!i.contactIds[e.id]}),u.forEach(function(t,n){i.contactIds[t.id]=!0,t.realname=t.realname||t.username,t.isContact=r,t.buddyicon=e.URLHelper.getBuddyIconURL(t.nsid,t.iconfarm,t.iconserver)}),n&&i.options.me&&(s=i.options.me.toJSON(),e.APIHelper.response.agnosticizeFarmPathTransferProtocol(s.buddyicon),s.buddyicon=s.buddyicon["default"],i.contactIds[s.id]=!0,s.me=!0,u.push(s)),i.options.hideInitially&&u.forEach(function(e){i.options.hideInitially.indexOf(e.nsid)>-1&&(e.hide=!0)}),u},destructor:function(){this.queryElEvent&&this.queryElEvent.detach&&this.queryElEvent.detach()},hide:function(e){e&&e.halt();if(!this._visible)return;this._visible=!1,this.highlighted=null,this.selectedIndex=0,this.selected=null,this.options.noShim||this._shimUp(!1),this.listEl.setStyle("display","none"),this.options.onHide&&this.options.onHide()},show:function(){if(this._visible)return;this._visible=!0,this.options.noShim||this._shimUp(),this.listEl.setStyle("display","block"),this._reposition(),this.options.onShow()},_reposition:function(){var n={width:t.innerWidth||t.clientWidth,height:t.innerHeight||t.clientHeight},r=this.options.el,i=r.getDOMNode(),s=i.getBoundingClientRect(),o=this.listEl.getDOMNode().getBoundingClientRect(),u=!this._contacts,a=u&&this.options.upInitially,f=t===e.config.win?s.top:i.clientTop,l;this.options.dialogOffset&&(l=this.options.dialogOffset()),a||f>0&&f+o.height+25>n.height&&!this.options.alwaysDownward?(this.listEl.setStyle("top","auto"),this.listEl.setStyle("bottom","25px"),this.options.onOrientationChange&&this.options.onOrientationChange(!0)):(this.listEl.setStyle("top",l||null),this.listEl.setStyle("bottom",null),this.options.onOrientationChange&&this.options.onOrientationChange(!1),r.ancestor(".modal",!0)&&this.listEl.setStyle("maxHeight",n.height-f-25))},_shimUp:function(t){if(t===!1){if(!this._shim)return;this._shim.detach("click").remove(),this._shim=null;return}this._shim=e.Node.create("<div/>"),this
._shim.addClass(this.options.shim),this._shim.on("click",this.hide.bind(this)),this.wrapperEl.appendChild(this._shim)},select:function(e){typeof e=="string"&&(e=this.getContact(e),e&&this.queryEl.set("value",e.realname)),e&&(this.selected=e,this.options.onSelect(e)),this.hide()},search:function(e){var t=this.queryEl.get(this.options.elValue),n=this,r,i,s,o=this.options.appContext.getViewer().nsid;if(e&&e.keyCode===27){e.preventDefault(),this.queryEl.blur();return}if(e&&[38,40,9].indexOf(e.keyCode)!==-1){e.preventDefault();return}this._nameTest(t),this.selected=null,this.selectedIndex=0,this.abort=!1;if(t.trim()==="")return this.abort=!0,this.hide();this.options.searchNonContacts||(this._end=!0,this._busy=!1);if(this._contacts&&this.options.me&&t==="me")return this.showResults(this._contacts.filter(function(e){return!e.hide&&e.me}).concat(this._contacts.filter(function(e){return!e.hide&&n._matchesQuery(e)})));if(this._isEmail(t))return this.select({email:t,nsid:null});if(/,/.test(t))return this.select(null);if(!this._contacts){if(this.options.signedOut)return;this.showResults(),this.load(this.search.bind(this))}this._contacts&&(r=this._contacts.filter(function(e){return!e.hide&&n._matchesQuery(e)})),this.showResults(r),i=n.listEl.getDOMNode(),this.options.searchNonContacts&&(this.options.loadMoreOnScroll&&t.length>0?(s=1,clearTimeout(this.searchAllPeople),this.searchInstanceId=Math.random()*999999,this.searchAllPeople=setTimeout(function(){n._searchPeople(t,o,s,n.searchInstanceId,function(){n._busy=!1,n.showResults(n._contacts.filter(function(e){return!e.hide&&n._matchesQuery(e)})),n.listElScrollEvent=n.listEl.on("scroll",function(){n.listEl._node.clientHeight+n.listEl._node.scrollTop===n.listEl._node.scrollHeight&&(s++,n._loadMore(s,o,t))})})},500)):(clearTimeout(this.searchAllPeople),this.searchInstanceId=Math.random()*999999))},_loadMore:function(e,t,n){var r=this;this._busy=!0,clearTimeout(this.searchAllPeople),this.searchInstanceId=Math.random()*999999,this.searchAllPeople=setTimeout(function(){r.options.loadingState&&!r.listEl.one("li.loading")&&r.appendLoader(),r._searchPeople(n,t,e,r.searchInstanceId,function(){r.showResults(r._contacts.filter(function(e){return!e.hide&&r._matchesQuery(e)})),r.listElScrollEvent&&r.listElScrollEvent.detach(),r.listElScrollEvent=r.listEl.on("scroll",function(){r.listEl._node.clientHeight+r.listEl._node.scrollTop===r.listEl._node.scrollHeight&&(e++,r._loadMore(e,t,n))})})},100)},_nameTest:function(t){var n=new RegExp(".*"+e.flutil.agnosticizeUnicode(t).replace(/\s/,"\\s")+".*","ig");this._matchesQuery=function(e){return n.test(e.username)||n.test(e.realname)||n.test(e.email)}},appendLoader:function(e){e=e||this.listEl;var t=document.createElement("li"),n=e.scrollTop;t.className="loading",t.innerHTML=this.options.loadingState,e.appendChild(t),e.scrollTop=n+t.clientHeight},_searchPeople:function(e,t,n,r,i){var s=this,o,u;s._end=!1,s.options.loadingState&&!s.listEl.one("li.loading")&&s.appendLoader(),o=s.options.appContext.getModel("contacts-models",t),o.then(function(t){return u=t.search({username:e,page:n}),u.then(function(e){var t=e.people,n=s.processContactModels(t,!1,!1);s._contacts=s._contacts||[],s._contacts=s._contacts.concat(n),s._contacts.some(function(e){return s._matchesQuery(e)})||(s._end=!0),i()},function(){s._end=!0,s._busy=!1,i()})},function(){s._end=!0,s._busy=!1,i()})},_isEmail:function(e,t){/,/.test(e)?e=e.split(/,/):e=[e];var n=/^\s*[\w\-\+_]+(\.[\w\-\+_]+)*\@[\w\-\+_]+\.[\w\-\+_]+(\.[\w\-\+_]+)*\s*$/;if(t){while(e.length)if(n.test(e.shift().trim()))return!0;return!1}while(e.length)if(!n.test(e.shift().trim()))return!1;return!0},showResults:function(t){if(this.abort)return;var n=this.options.max||10,r,i,s=this;r=document.createDocumentFragment(),t&&this.selectedIndex>=t.length&&(this.selectedIndex=t.length-1),this.numShowing=Math.min(n,t&&t.length||0),!s._busy&&t&&t.length===0?(i=document.createElement("li"),i.innerHTML='<span class="no-contacts">'+this.intlMessage({intlName:"photo-page-scrappy.NO_MEMBERS_FOUND"})+"</span>",i.className="no-members",r.appendChild(i),s.highlighted=null):t&&t.slice(0,n).forEach(function(t,n,i){var o=s.createItem(t);n===s.selectedIndex&&(o.setAttribute("class","highlight"),s.highlighted=e.Node(o)),r.appendChild(o)}),(s._busy||!t)&&s.options.loadingState&&s.appendLoader(r),this.options.loadMoreOnScroll&&this.listElScrollEvent&&this.listElScrollEvent.detach(),this.listEl.setHTML(""),this.listEl.getDOMNode().appendChild(r),this.show()},_template:function(){return['<img src="{{buddyicon}}">','<div class="following-status {{isContact}}">','<span class="following-icon">&nbsp;</span>',"<span>"+this.intlMessage({intlName:"common.FOLLOWING"})+"</span>","</div>",'<h2 class="all">{{realname}}</h2>','<h3 class="all">{{username}}</h3>'].join("")},_onlyContactTemplate:['<img src="{{buddyicon}}">',"<h2>{{realname}}</h2>","<h3>{{username}}</h3>"].join(""),createItem:function(t){var n=document.createElement("li"),r,i=this.options.searchNonContacts&&this.options.showFollowingState?this._template():this._onlyContactTemplate,s=this.options.truncateLength||70;return r=i.replace(/\{\{(\w+)\}\}/g,function(n,r){if(r==="buddyicon")return t[r];if(r==="isContact")return t[r]?"am-following":"";var i=e.flutil.escapeInput(t[r]);return e.Handlebars.helpers.truncate(i,s)}),n.innerHTML=r,n.dataset?(n.dataset=n.dataset,n.dataset.nsid=t.nsid,n.dataset.displayname=t.realname||t.username,n.dataset.pathAlias=t.pathAlias,n.dataset.ispro=t.isPro):(n.setAttribute("data-nsid",t.nsid),n.setAttribute("data-displayname",t.realname||t.username),n.setAttribute("data-path-alias",t.pathAlias),n.setAttribute("data-ispro",t.isPro)),n}},e.mix(n.prototype,e.Localizable),e.ContactSearchBox=n},"@VERSION@",{requires:["api-helper","flutil","contact-search-css","handlebars-helpers","flickr-contacts-getListfetcher"],langBundles:["common","photo-page-scrappy"]});
YUI.add("hermes-lang-photo-page-scrappy",function(e,t){e.Intl.add("hermes/photo-page-scrappy","en-US",{PAGE_TITLE:["${title}"," | Flickr - Photo Sharing!"],BACK_TO:["Back to ","${entryType}"],COULDNT_UPDATE_SETTINGS:["We couldn't update your settings"],ADULT_CONTENT:["Adult Content"],MATURE_AUDIENCES:["This content is for mature audiences only."],USER_DISCRETION:["User discretion is advised."],SHOW_ME_THIS_CONTENT_TYPE:["Show Me This Content Type From Now On"],CHANGE_SAFE_SEARCH_IN_SETTINGS:['You can always change <a href="/account/prefs/safesearch/?from=privacy"  data-track="photoWellSafeSearchClick">SafeSearch settings</a> in your account preferences.'],SIGNED_IN_FOR_CONTENT:["You must be signed in to see this content."],VIDEO_COMING_SOON:["Video support coming soon"],FIND_OUT_MORE_AD:["Find out more at ","${brand}"],SHARE_THIS_PHOTO:["Share this photo"],DOWNLOAD_THIS_VIDEO:["Download this video"],DOWNLOAD_THIS_PHOTO:["Download this photo"],VIEW_ALL_SIZES:["View all sizes"],DOWNLOAD_PHOTO:["Download photo"],SOME_RIGHTS_RESERVED:["Some rights reserved"],DOWNLOAD:["Download"],ERROR_LOADING_CONTEXT:["Error loading context"],ADD_TITLE:["Add title"],ADD_DESCRIPTION:["Add description"],TITLE_DESCRIPTION_FAILURE:["We couldn't change the Title and Description at this time."],VIEW_PREVIOUS_COMMENT:["View previous comment"],VIEW_MORE_PREVIOUS_COMMENTS:["View ","${count}"," previous comments"],EMPTY_COMMENT_ERROR:["An empty comment box? That won't work!"],COMMENT_RATE_LIMIT_ERROR:["Slow down, partner! To protect the Flickr community against spam and spammy behavior we place a few restrictions on commenting."],COMMENT_POST_ERROR:["We couldn't post your comment."],MORE_COMMENTS_ERROR:["We couldn't get more comments."],COMMENT_PERMALINK_ERROR:["We were unable to find the specified comment on the photo."],DELETE_COMMENT:["Delete Comment"],COMMENT_DELETE_CONFIRMATION:["Are you sure you want to delete this comment?"],COMMENT_DELETE_ERROR:["We couldn't delete your comment."],COMMENT_LOADING_ERROR:["Error loading comments"],COMMENT:["Comment"],SHOW_MORE_COMMENTS:["${count}"," more"],REPLY:["Reply"],PERMALINK:["Permalink"],SINGLE_FAVER:['<a class="faved-by-person-link" href="/photos/',"${pathAlias}",'/">',"${displayName}","</a> faved this"],DOUBLE_FAVER:['<a class="faved-by-person-link" href="/photos/',"${pathAliasOne}",'/">',"${displayNameOne}",'</a> and <a class="faved-by-person-link" href="/photos/',"${pathAliasTwo}",'/">',"${displayNameTwo}","</a> faved this"],TRIPLE_FAVER:['<a class="faved-by-person-link" href="/photos/',"${pathAliasOne}",'/">',"${displayNameOne}",'</a>, <a class="faved-by-person-link" href="/photos/',"${pathAliasTwo}",'/">',"${displayNameTwo}",'</a>, and <a class="faved-by-person-link" href="/photos/',"${pathAliasThree}",'/">',"${displayNameThree}","</a> faved this"],MULTI_FAVER:['<a class="faved-by-person-link" href="/photos/',"${pathAliasOne}",'/">',"${displayNameOne}",'</a>, <a class="faved-by-person-link" href="/photos/',"${pathAliasTwo}",'/">',"${displayNameTwo}",'</a> and <a class="remaining-faved-by" href="#">',"${count}"," more people</a> faved this"],RELATIONSHIP_FRIEND_ERROR:["There was a problem setting your friend relationship."],RELATIONSHIP_FAMILY_ERROR:["There was a problem setting your family relationship."],HIDE_EXIF:["Hide EXIF"],SHOW_EXIF:["Show EXIF"],EDIT_LOCATION:["Edit Location"],EDIT_LOCATION_ORGANIZR:["We\u2019re hard at work redesigning our brand new photo experience. For now, you can Edit Location in Organizr."],SAVE_LOCATION:["Save location"],APERTURE:["Aperture"],FOCAL_LENGTH:["Focal length"],EXPOSURE_TIME:["Exposure time"],FLASH_AUTO_FIRED:["Flash (auto, fired)"],FLASH_AUTO_NO_FIRE:["Flash (auto, did not fire)"],FLASH_ON_FIRED:["Flash (on, fired)"],FLASH_ON_NO_FIRE:["Flash (on, did not fire)"],FLASH_OFF:["Flash (off, did not fire)"],FLASH_SIMPLE_ON:["On"],FLASH_SIMPLE_OFF:["Off"],POWERED_BY:["POWERED BY"],FOURSQUARE:["FOURSQUARE"],ADD_PHOTO_TO_MAP:["Add this photo to your map"],SINGULAR_FAVE:["fave"],PLURAL_FAVE:["faves"],SINGULAR_VIEW:["view"],PLURAL_VIEW:["views"],SINGULAR_COMMENT:["comment"],PLURAL_COMMENT:["comments"],LICENSE_ERROR:["There was a problem changing your photo's license"],ALL_RIGHTS_RESERVED:["All rights reserved"],NO_RESTRICTIONS:["No known copyright restrictions"],PUBLIC_DOMAIN:["Public domain"],USA_GOV_WORK:["United States government work"],SAFETY_CHANGE_ERROR:["There was an error while changing your photo's safety level"],PRIVACY_CHANGE_ERROR:["There was a problem changing your photo's privacy"],COMMENT_PERM_CHANGE_ERROR:["There was an error while changing your photo's commenting permission"],FLAG_PHOTO:["Flag Photo"],MARK_FOR_REVIEW:["Mark for review"],ADDITIONAL_INFO:["Additional info"],VIEWING_THIS_PHOTO:["Viewing this photo"],PRIVACY_UPDATE_ERROR:["There was an error while updating the privacy. Please try again."],META_PERMS_UPDATE_ERROR:["There was an error while updating add meta permission. Please try again."],ADD_META_TO_THIS_PHOTO:["Add tags and people to this photo"],COMMENT_PERMS_UPDATE_ERROR:["There was an error while updating commenting permission. Please try again."],COMMENTING_ON_THIS_PHOTO:["Commenting on this photo"],SAFETY_UPDATE_ERROR:["There was an error while updating the safety level. Please try again."],SAFETY_LEVEL_OF_PHOTO:["Safety level of this photo"],FLAG_ERROR:["There was an error trying to flag this photo. Please try again."],PROVIDE_FEEDBACK:["Provide feedback on the new photo page"],ERROR_DELETING_AUTOTAG:["Error deleting Autotag"],AUTOTAGS:["Autotags"],CONTACT_LIST_ERROR:["An error occurred while trying to fetch your contact list. Please try again."],FAILED_TO_REMOVE_PERSON:["Failed to remove that person from the photo at this time."],PERSON_CANNOT_BE_TAGGED:["This person cannot be tagged."],PEOPLE_IN_PHOTO:["People in photo"],ADD_PEOPLE:["Add people"],ADD_PERSON:["Add a person"],ERROR_REMOVING_FROM_GROUP:["There was a problem removing this photo from the group"],ERROR_ACCEPTING_INVITATION:["There was a problem accepting the group invitation"
],SEARCH_GROUPS:["Search groups"],PHOTO_NOT_IN_GROUPS:["This photo is currently not in any groups"],ADD_TO_GROUP:["Add to group"],INVITE_TO_GROUP:["Invite to group"],ONE_GROUP_INVITATION:["You have 1 group invitation"],N_GROUP_INVITATIONS:["You have ","${count}"," group invitations"],VIEW_MORE_GROUPS:["View more groups"],ERROR_REMOVING_FROM_ALBUM:["There was a problem removing this photo from the album"],WARNING_REMOVE_LAST_PHOTO_FROM_ALBUM:["You're about to remove the last photo from an album, which will also delete the album."],REMOVE_PHOTO_AND_ALBUM:["Remove photo and delete album"],ADD_PHOTO_TO_ALBUM:["Add this photo to an album"],SEARCH_ALBUMS:["Search albums"],ADD_TO_ALBUM:["Add to album"],PHOTO_NOT_IN_ALBUMS:["This photo is currently not in any albums"],VIEW_MORE_ALBUMS:["View more albums"],PHOTO_IN_ONE_ALBUM:["This photo is in 1 album"],PHOTO_IN_N_ALBUMS:["This photo is in ","${count}"," albums"],INVITE_PENDING:["Invite pending"],CANCEL_INVITE:["Cancel invite"],ACCEPT_INVITE:["Accept invite"],ONE_ITEM:["1 item"],N_ITEMS:["${count}"," items"],ERROR_REMOVING_FROM_GALLERY:["There was a problem removing this photo from the gallery"],SEARCH_GALLERIES:["Search galleries"],ADD_TO_GALLERY:["Add to gallery"],PHOTO_NOT_IN_GALLERIES:["This photo is currently not in any galleries"],VIEW_MORE_GALLERIES:["View more galleries"],PHOTO_IN_ONE_GALLERY:["This photo is in 1 gallery"],PHOTO_IN_N_GALLERIES:["This photo is in ","${count}"," galleries"],DELETE_PHOTO:["Delete Photo"],PERMANTENTLY_DELETE:["Do you want to permanently delete this photo?"],EDIT_PHOTO:["Edit photo"],NO_VIDEOS_IN_AVIARY:["Videos cannot be edited in Aviary"],ENHANCE_WITH_AVIARY:["Enhance with Aviary"],NO_VIDEO_ROTATION:["Videos cannot be rotated"],ROTATE:["Rotate"],NO_VIDEO_REPLACE:["Videos cannot be replaced"],REPLACE:["Replace"],PHOTO_NAVIGATION:["Photo navigation"],THUMBNAIL_NAVIGATION:["Thumbnail navigation"],ZOOM:["Zoom"],VIEW_IN_LIGHTBOX:["View in light box"],BACK_TO_CONTEXT:["Back to context"],ADD_TAG:["Add tag"],GO_TO_ORGANIZER:["Go to Organizr"],ALBUM:["album"],ALBUMS:["albums"],ERROR_LOADING_ALBUMS:["There was a problem loading your albums"],ERROR_ADDING_PHOTO_TO_ALBUM:["There was a problem adding this photo to the album"],ERROR_REMOVING_PHOTO_FROM_ALBUM:["There was a problem removing this photo from the album"],ERROR_LOADING_GROUPS:["There was a problem loading the groups you can add photos to"],ERROR_ADDING_TO_GROUP:["There was a problem adding this photo to the group"],ERROR_ADDING_TO_GROUP_NOT_OWNER:["Sorry, the photo couldn't be added to the group because you don't own the photo."],ERROR_ADDING_TO_GROUP_NOT_MEMBER:["Sorry, the photo couldn't be added to the group. You are not a member of the group."],ERROR_ADDING_TO_GROUP_ALREADY_IN_POOL:["The photo is already in that group pool."],ERROR_ADDING_TO_GROUP_MAX_POOLS:["Sorry, the photo couldn't be added to the group because it is already in the maximum number of group pools."],ERROR_ADDING_TO_GROUP_MAX_PHOTOS_FROM_USER:["Sorry, the photo couldn't be added to the group. You have already added the maximum number of photos to the pool."],ERROR_ADDING_TO_GROUP_ADDED_TO_QUEUE:["Your photo has been added to the pending queue for the group."],ERROR_ADDING_TO_GROUP_ALREADY_IN_QUEUE:["Your photo is already in the pending queue for the group."],ERROR_ADDING_TO_GROUP_INVALID_CONTENT:["Sorry, the photo couldn't be added to the group. For more information, check the group requirements for media type, content type, safety level, and geo location."],ERROR_ADDING_TO_GROUP_MAX_IN_POOL:["Sorry, the photo couldn't be added to the group. The group has the maximum number of photos allowed in a pool."],ERROR_INVITING_TO_GROUP:["There was a problem inviting this photo to the group"],ERROR_CANCELING_GROUP_INVITIATON:["There was a problem canceling this photo's invitation to the group"],NO_MATCHES:["No matches"],CREATE_NEW:["Create new"],ERROR_LOADING_GROUP_INVITATIONS:["There was a problem loading this photo's group invitations"],NO_GROUP_INVITATIONS:["No pending group invitations"],PENDING_INVITATIONS_FOR_PHOTO:["Pending invitations for this photo"],LOADING_INVITATIONS:["Loading invitations"],ERROR_LOADING_GALLERIES:["There was a problem loading your galleries"],ERROR_ADDING_TO_GALLERY:["There was a problem adding this photo to the gallery"],ERROR_PHOTO_NOT_ALLOWED_IN_GALLERY:["The owner of this photo does not allow the photo to be added to your gallery"],ERROR_CREATING_GALLERY:["There was a problem creating your new gallery"],DATE_TAKEN_FORMAT:["The taken date must be in the MM/DD/YYYY hh:mm:ss format."],DATE_POSTED_FUTURE:["The posted date cannot be in the future."],DATE_UPLOADED_FUTURE:["The uploaded date cannot be in the future."],DATE_POSTED_FLICKR_JOIN:["Posted date must be after you joined Flickr."],DATE_UPLOADED_FLICKR_JOIN:["Uploaded date must be after you joined Flickr."],ERROR_SAVING_DATE:["Error saving dates"],DATE_INVALID:["One or more dates are invalid"],EDIT_DATES:["Edit Dates"],DATE_TAKEN_ON:["Date Taken On"],DATE_POSTED_ON:["Date Posted On"],DATE_UPLOADED_ON:["Date Uploaded On"],TAKEN_CIRCA:["Taken circa ","${intlDate}"],TAKEN_SOMETIME_IN:["Taken sometime in ","${intlDate}"],TAKEN_IN:["Taken in ","${intlDate}"],TAKEN_ON:["Taken on ",{type:"date",valueName:"intlDate",format:"long"}],UPLOADED_ON:["Uploaded on ","${intlDate}"],SOMETHING_WENT_WRONG:["Something went wrong."],REFRESH_BROWSER:["Please refresh your browser and try again."],TWITTER_NOT_FOUND:["Twitter account not found on posting"],TUMBLR_NOT_FOUND:["Tumblr account not found on posting"],LINK:["Link"],LINK_TO_VIDEO:["Link to this video:"],LINK_TO_PHOTO:["Link to this photo:"],NO_LINKS_FOR_RESTRICTED_VIDEO:["Links are not available for restricted videos"],PRIVATE_VIDEO_SHARE:["This is a private video, do you still want to share it?"],NO_LINKS_FOR_RESTRICTED_PHOTO:["Links are not available for restricted photos"],PRIVATE_PHOTO_SHARE:["This is a private photo, do you still want to share it?"],SHARING_RESTRICTED_VIDEO:["Sharing is restricted for this video"
],SHARING_RESTRICTED_PHOTO:["Sharing is restricted for this photo"],EMBED:["Embed"],PUBLIC_TO_SHARE:["Please share this photo publicly to view embed code"],SIZE:["Size:"],TITLE_AND_OWNER_AT_START:["Display title and owner at start"],SHARE_NOW:["Share now!"],SHARE_PHOTO:["Share Photo"],SHARE_ON_TWITTER:["Share on Twitter"],AUTHORIZE_FOR_TWITTER:["please authorize Flickr to post on Twitter"],SHARE_ON_TUMBLR:["Share on Tumblr"],PUBLISH_NOW:["Publish now"],ADD_TO_QUEUE:["Add to queue"],SAVE_AS_DRAFT:["Save as draft"],AUTHORIZE_FOR_TUMBLR:["please authorize Flickr to post on Tumblr"],SHARE_VIA_MAIL:["Share via mail"],SCREEN_NAME_OR_EMAIL:["Screen name or email"],SQUARE:["Square"],SMALL:["Small"],MEDIUM:["Medium"],LARGE:["Large"],ORIGINAL:["Original"],DUPLICATE_TAG:["Duplicate Tag"],INVALID_TAG:["Invalid Tag"],MAXIMUM_TAG_LIMIT:["Maximum tag limit (76) reached"],MAX_TAG_LIMIT:["Maximum tag limit (75) reached"],ERROR_ADDING_TAG:["Error adding tag"],ERROR_DELETING_TAG:["Error deleting tag"],TAGS:["Tags"],ADD_TAGS:["Add tags"],ADD_A_TAG:["Add a tag"],PHOTO_IN_ONE_GROUP:["This photo is in 1 group"],PHOTO_IN_MANY_GROUPS:["This photo is in ",{type:"number",valueName:"count"}," groups"],PHOTO_IN_NO_GROUPS:["This photo is not in any groups"],ADD_A_COMMENT:["Add a comment"],COMMENT_TUTORIAL:["press Enter to post and Shift+Enter for newline"],SIGNED_IN_TO_POST_A_COMMENT:["You must be signed in to post a comment"],SHARE:["Share"],CODE:["Code"],INCLUDE_A_MESSAGE:["Include a message"],FOR_MORE_INFORMATION_SAFESEARCH:['For more information please read <a href="//www.flickr.com/help/photos/?search=flag#145">this FAQ</a>.'],FLAG_CONFIRMATION_SAFE_WITHIN:['This photo is marked as <a href="//www.flickr.com/help/filters/#258">safe</a> and falls within your <a href="//www.flickr.com/account/prefs/safesearch/">SafeSearch settings</a>.'],FLAG_CONFIRMATION_SAFE_OUTSIDE:['This photo is marked as <a href="//www.flickr.com/help/filters/#258">safe</a> and falls outside your <a href="//www.flickr.com/account/prefs/safesearch/">SafeSearch settings</a>.'],FLAG_CONFIRMATION_MODERATE_WITHIN:['This photo is marked as <a href="//www.flickr.com/help/filters/#258">moderate</a> and falls within your <a href="//www.flickr.com/account/prefs/safesearch/">SafeSearch settings</a>.'],FLAG_CONFIRMATION_MODERATE_OUTSIDE:['This photo is marked as <a href="//www.flickr.com/help/filters/#258">moderate</a> and falls outside your <a href="//www.flickr.com/account/prefs/safesearch/">SafeSearch settings</a>.'],FLAG_CONFIRMATION_RESTRICTED_WITHIN:['This photo is marked as <a href="//www.flickr.com/help/filters/#258">restricted</a> and falls within your <a href="//www.flickr.com/account/prefs/safesearch/">SafeSearch settings</a>.'],FLAG_CONFIRMATION_RESTRICTED_OUTSIDE:['This photo is marked as <a href="//www.flickr.com/help/filters/#258">restricted</a> and falls outside your <a href="//www.flickr.com/account/prefs/safesearch/">SafeSearch settings</a>.'],PRIVATE_PHOTO:["Private photo"],PHOTO_UNFIT_FOR_YOUR_EYES:["Photo is unfit for your eyes. Have a kitten: (^._.^)\uff89"],NO_PHOTO_WITH_THAT_ID:["No photo found with id ","${photoId}"],NO_MEMBERS_FOUND:["No members found"],TAKEN_ON_INTL:["Taken on ",{type:"date",valueName:"intlDate",format:"long"}],UPLOADED_ON_INTL:["Uploaded on ",{type:"date",valueName:"intlDate",format:"long"}],TAKEN_IN_MONTH:["Taken in ",{type:"date",valueName:"intlDate",format:"monthYear"}],VIEW_IN_LIGHTBOX_SHORTCUT:["View in light box"],ZOOM_MAX_MESSAGE:["Whoa there, tiger! This photo is already at maximum size."],CLICK_TO_FAVE_PHOTO:["Click here to fave this photo"],CLICK_TO_FAVE_VIDEO:["Click here to fave this video"],BACK_TO_ACTIVITY_FEED:["Back to activity feed"],BACK_TO_PHOTOSTREAM:["Back to photostream"],BACK_TO_SHARED_PHOTOS:["Back to shared photos"],BACK_TO_ALBUM:["Back to album"],BACK_TO_CONTACTS_LIST:["Back to contacts list"],BACK_TO_FAVORITES:["Back to favorites"],BACK_TO_GALLERY:["Back to gallery"],BACK_TO_PROFILE:["Back to profile"],BACK_TO_EXPLORE:["Back to explore"],BACK_TO_COMMONS:["Back to commons"],BACK_TO_GROUP:["Back to group"],BACK_TO_GROUPS:["Back to groups"],BACK_TO_MAP:["Back to map"],BACK_TO_SEARCH:["Back to search"],BACK_TO_TAG:["Back to tag"],ERROR_ADDING_PHOTOS_TO_ALBUM:["There was a problem adding these photos to the album"],ERROR_REMOVING_PHOTOS_FROM_ALBUM:["There was a problem removing these photos from the album"],ERROR_CREATING_ALBUM:["There was a problem creating your new album"],STRICTER_PRIVACY_CHANGE_DIALOG_TITLE:["Changing to a stricter privacy level"],STRICTER_PRIVACY_CHANGE_DIALOG_MESSAGE:["Changing a photo to a stricter privacy level will remove any favorites that have accumulated. It will also change the URL of the photo."],TAGS_HELPER_TEXT:["Tags are keywords that make photos easier to find. Add as many as you like, and Flickr\u2019s friendly robots will try to help out by adding some for you."],TAGS_HELP_TEXT:["Tags are keywords that make photos easier to find in Flickr search. The ones you add will show up in dark gray. Flickr\u2019s friendly robots will try to help out by adding some for you; these will appear with just a gray outline."],PRIVATE_TAGS_OWNER_HELPER_TEXT:["This private tag is only visible to you and your friends and family who are allowed to see this photo."],PRIVATE_TAGS_FRIENDS_FAMILY_HELPER_TEXT:["This private tag is only visible to you because you are a friend or family of the photo\u2019s owner."],CREATE_WALLART_WITH_PHOTO:["Create wall art with this photo"],ERROR_ROTATING_PHOTO:["There was a problem rotating this photo, please close and retry."],ROTATE_PHOTO:["Rotate photo"],ERROR_REPLACING_PHOTO:["There was a problem replacing this photo, please close and retry."],REPLACE_PHOTO:["Replace photo"],PERMANENTLY_REPLACE:['Permanently replace this photo ("',"${photoTitle}",'" by ',"${username}",") with <em>","${fileName}","</em>?"],REPLACE_WARNING:["Replacing a photo can't be undone. Choose a file to replace this photo with."],REPLACE_UPLOADING:["Uploading <em>","${fileName}"
,"</em>..."],ERROR_DELETING_PHOTO:["There was a problem deleting this photo, please close and retry."],SHOW_MORE_STATS:["Show more stats"],SIGNUP_AND_DOWNLOAD_TITLE:["You found a photo to download!"],SIGNUP_AND_DOWNLOAD_VIDEO_TITLE:["You found a video to download!"],SIGNUP_AND_DOWNLOAD_MESSAGE:["Join Flickr to access billions of photos."],SIGNUP_AND_COMMENT_TITLE:["Comment on this photo!"],SIGNUP_AND_COMMENT_MESSAGE:["Join Flickr to leave a comment on this photo."],IMMERSIFY:["Immersify"],SIGNUP_FOOTER_MESSAGE:["Join Flickr to explore world class photos"],TIMEOUT_FAILURE:["We're having some trouble displaying this photo at the moment. Please try again."],BUY:["Buy"]})},"@VERSION@",{requires:["intl"]});
YUI.add("cameraroll-edit-dialog-people-view",function(e){var t=e.config.flickr.api.max_people_in_photo;e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this._css={locked:"ui-util-locked",working:"ui-util-working",removed:"ui-util-removed",shim:"c-contact-search-shim"},this},loadState:function(){var t=this,n=new e.FlickrPromise({person:t.appContext.getModelRegistry("person-models")});return n.then(function(e){t.set("person",e.person)}).then(function(){var e=t.appContext.getViewer();if(e.signedIn)return t.get("person").get(e.nsid).then(function(e){t.set("me",e)})})},buildContainer:function(){var e;return e=this.templates("cameraroll-edit-dialog-people")(),this.setContainerHTML(e),this},activate:function(){var n=this.get("container"),r=n.one(".edit-photos-people-tags"),i="",s=[],o=this;return this.focus&&(setTimeout(function(){r.focus()},100),this.focus=!1),r&&(this.arrow=e.Node.create('<span class="ui-dialog-arrow contact-autocomplete-arrow"></span>'),this.contacts=new e.ContactSearchBox({el:r,appContext:this.appContext,shim:this._css.shim,elValue:"value",signedOut:!1,canTag:1,noShim:!0,searchNonContacts:!0,loadMoreOnScroll:!0,upInitially:!1,alwaysDownward:!0,loadingState:this.templates(e.Balls())(),max:1e3,hideInitially:s.map(function(e){return e.id}),me:this.get("me"),onError:function(){var e=o.get("container").one(".contact-list-error");r.blur(),o.contacts.hide(),e.hasClass("hidden")&&e.removeClass("hidden")},onShow:function(t){var i=r.ancestor(".c-contact-search-autocomplete");o.arrow||(o.arrow=e.Node.create('<span class="ui-dialog-arrow contact-autocomplete-arrow"></span>')),o.arrow.inDoc()||i.appendChild(o.arrow),o.arrow.removeClass("hide"),n.addClass(o._css.locked),o.fire("subviewViewEvent","make in view",n)},onSelect:function(e){e?n.removeClass(o._css.locked):n.addClass(o._css.locked)},onHide:function(){var e=r;o.arrow.addClass("hide"),e.setHTML(i),o.fire("subviewViewEvent","close in view")},onOrientationChange:function(e){o.arrow&&(e?o.arrow.addClass("upside-down"):o.arrow.removeClass("upside-down"))},clickContact:function(n){var s,u,a,f,l,c,h=o.get("container").one(".people-tags-list"),p=o.get("container").one(".max-people-reached"),d=o.get("container").one(".edit-photos-people-tags");if(e.UA.ie&&document.getSelection()){l=document.getSelection().anchorNode;if(l.id==="content")return}r.removeClass("focused"),r.setHTML(i),o.contacts.abort=!0,o.hideDropdown=setTimeout(function(){o.contacts.hide()},150),s=n.target.ancestor("[data-nsid]",!0);if(!s){o.contacts.hide();return}u=s.getData("nsid"),f=s.one("img").get("src"),c=s.getData("ispro")||!1,a=s.getData("displayname")||"",h.getDOMNode().childElementCount<t?(o.addTemporaryPersonTag(a,u,f,c),o.fire("subviewViewEvent","camerarollEditDialogPeople:personAdded",u),o.contacts.hideFromSearch(u)):p.hasClass("hidden")&&p.removeClass("hidden"),o.contacts.hide(),o.contacts.abort=!0,d.set("value",""),d.focus()}}),this.registerEventHandler(r.on("focus",function(){var t=this;this.addClass("focused"),o.contacts.abort=!1,setTimeout(function(){e.UA.ie&&(t.addClass("focused"),t.focus()),t.set("text","")},40)})),this.registerEventHandler(r.on("keydown",function(e){e.keyCode===13&&(e.halt(),clearTimeout(o.hideDropdown),r.focus())})),this.registerEventHandler(r.on("blur",function(e){this.removeClass("focused")})),this.registerEventHandler(r.ancestor(".c-contact-search-autocomplete").on("focus",function(e){e.target.hasClass("c-contact-search-autocomplete")&&(clearTimeout(o.hideDropdown),r.focus())}))),n.one(".people-tags-list")&&this.registerEventHandler(n.one(".people-tags-list").on("click",function(e){var n,r,i=o.get("container").one(".people-tags-list"),s=o.get("container").one(".max-people-reached");e.target.hasClass("remove-person")&&(e.preventDefault(),n=e.target.ancestor(".person"),r=n.getData("person-tag-nsid"),n.remove(),o.contacts.showInSearch(r),i.getDOMNode().childElementCount<t&&!s.hasClass("hidden")&&s.addClass("hidden"),o.fire("subviewViewEvent","camerarollEditDialogPeople:personRemoved",r))})),this},addTemporaryPersonTag:function(e,t,n,r){this.addPerson({dataAttr:{key:"person-tag-nsid",value:t},buddyicon:n,size:50,isPro:this.appContext.flipper.isFlipped("enable-pro-badge")&&r,displayname:e,showRemove:!0})},addPerson:function(e){var n=this.get("container"),r=n.one(".people-tags-list"),i=this.templates("cameraroll-edit-dialog-person")(e);r.getDOMNode().childElementCount<t&&r.prepend(i),r.hasClass("hidden")&&r.removeClass("hidden")}})},"@VERSION@",{requires:["flickr-view","hermes-template-cameraroll-edit-dialog-people","hermes-template-cameraroll-edit-dialog-person","url-helper","contact-search-box","cameraroll-edit-dialog-people-css","html5-balls"],optional:[],langBundles:["common","photo-page-scrappy","cameraroll"]});
YUI.add("hermes-template-cameraroll-edit-dialog-dates",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression,l="function";return s+='\n<div class="date-taken-inputs date-inputs">\n	<div class="date-taken-label">\n		<i class="date-icon"></i>\n		<span class="date-taken-label-text">',u={hash:{intlName:"common.DATE_TAKEN"},data:i},s+=f((o=n.intlMessage||t.intlMessage,o?o.call(t,u):a.call(t,"intlMessage",u)))+'</span>\n	</div>\n\n	<div class="month" data-monthName="'+f((o=(o=t.dateTaken,o==null||o===!1?o:o.monthName),typeof o===l?o.apply(t):o))+'">\n		<span class="date-value">',u={hash:{},data:i},s+=f((o=n.fallback||t.fallback,o?o.call(t,(o=t.dateTaken,o==null||o===!1?o:o.monthName),"-",u):a.call(t,"fallback",(o=t.dateTaken,o==null||o===!1?o:o.monthName),"-",u)))+'</span>\n		<span class="ui-dropdown-arrows">&nbsp;</span>\n	</div>\n	<div class="day" data-day="'+f((o=(o=t.dateTaken,o==null||o===!1?o:o.day),typeof o===l?o.apply(t):o))+'">\n		<span class="date-value">',u={hash:{},data:i},s+=f((o=n.fallback||t.fallback,o?o.call(t,(o=t.dateTaken,o==null||o===!1?o:o.day),"-",u):a.call(t,"fallback",(o=t.dateTaken,o==null||o===!1?o:o.day),"-",u)))+'</span>\n		<span class="ui-dropdown-arrows">&nbsp;</span>\n	</div>\n	<div class="year" data-year="'+f((o=(o=t.dateTaken,o==null||o===!1?o:o.year),typeof o===l?o.apply(t):o))+'">\n		<span class="date-value">',u={hash:{},data:i},s+=f((o=n.fallback||t.fallback,o?o.call(t,(o=t.dateTaken,o==null||o===!1?o:o.year),"-",u):a.call(t,"fallback",(o=t.dateTaken,o==null||o===!1?o:o.year),"-",u)))+'</span>\n		<span class="ui-dropdown-arrows">&nbsp;</span>\n	</div>\n	<div class="time-fields">\n		<input type="text" placeholder="hh" class="date-hour" maxlength="2" value="'+f((o=(o=t.dateTaken,o==null||o===!1?o:o.hour),typeof o===l?o.apply(t):o))+'" />\n		<span class="time-seperator">:</span>\n		<input type="text" placeholder="mm" class="date-minute" maxlength="2" value="'+f((o=(o=t.dateTaken,o==null||o===!1?o:o.minute),typeof o===l?o.apply(t):o))+'" />\n		<span class="time-seperator">:</span>\n		<input type="text" placeholder="ss" class="date-second" maxlength="2" value="'+f((o=(o=t.dateTaken,o==null||o===!1?o:o.second),typeof o===l?o.apply(t):o))+'" />\n	</div>\n</div>\n\n'+'\n<div class="date-posted-inputs date-inputs">\n	<div class="date-posted-label">\n		<i class="date-icon"></i>\n		<span class="date-taken-label-text">',u={hash:{intlName:"common.DATE_UPLOADED"},data:i},s+=f((o=n.intlMessage||t.intlMessage,o?o.call(t,u):a.call(t,"intlMessage",u)))+'</span>\n	</div>\n\n	<div class="month" data-monthName="'+f((o=(o=t.datePosted,o==null||o===!1?o:o.monthName),typeof o===l?o.apply(t):o))+'">\n		<span class="date-value">',u={hash:{},data:i},s+=f((o=n.fallback||t.fallback,o?o.call(t,(o=t.datePosted,o==null||o===!1?o:o.monthName),"-",u):a.call(t,"fallback",(o=t.datePosted,o==null||o===!1?o:o.monthName),"-",u)))+'</span>\n		<span class="ui-dropdown-arrows">&nbsp;</span>\n	</div>\n	<div class="day" data-day="'+f((o=(o=t.datePosted,o==null||o===!1?o:o.day),typeof o===l?o.apply(t):o))+'">\n		<span class="date-value">',u={hash:{},data:i},s+=f((o=n.fallback||t.fallback,o?o.call(t,(o=t.datePosted,o==null||o===!1?o:o.day),"-",u):a.call(t,"fallback",(o=t.datePosted,o==null||o===!1?o:o.day),"-",u)))+'</span>\n		<span class="ui-dropdown-arrows">&nbsp;</span>\n	</div>\n	<div class="year" data-year="'+f((o=(o=t.datePosted,o==null||o===!1?o:o.year),typeof o===l?o.apply(t):o))+'">\n		<span class="date-value">',u={hash:{},data:i},s+=f((o=n.fallback||t.fallback,o?o.call(t,(o=t.datePosted,o==null||o===!1?o:o.year),"-",u):a.call(t,"fallback",(o=t.datePosted,o==null||o===!1?o:o.year),"-",u)))+'</span>\n		<span class="ui-dropdown-arrows">&nbsp;</span>\n	</div>\n	<div class="time-fields">\n		<input type="text" placeholder="hh" class="date-hour" maxlength="2" value="'+f((o=(o=t.datePosted,o==null||o===!1?o:o.hour),typeof o===l?o.apply(t):o))+'" />\n		<span class="time-seperator">:</span>\n		<input type="text" placeholder="mm" class="date-minute" maxlength="2" value="'+f((o=(o=t.datePosted,o==null||o===!1?o:o.minute),typeof o===l?o.apply(t):o))+'" />\n		<span class="time-seperator">:</span>\n		<input type="text" placeholder="ss" class="date-second" maxlength="2" value="'+f((o=(o=t.datePosted,o==null||o===!1?o:o.second),typeof o===l?o.apply(t):o))+'" />\n	</div>\n</div>',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/cameraroll-edit-dialog-dates",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-date-dropdown",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function l(e,t){var r="",i;r+="\n	",i=n["if"].call(e,e.value,{hash:{},inverse:f.program(4,h,t),fn:f.program(2,c,t),data:t});if(i||i===0)r+=i;return r+="\n",r}function c(e,t){var n="",r;return n+='\n		<li value="'+a((r=e.value,typeof r===u?r.apply(e):r))+'">'+a((r=e.display,typeof r===u?r.apply(e):r))+'<span class="ui-dropdown-checked">&nbsp;</span></li>\n	',n}function h(e,t){var n="";return n+='\n		<li value="'+a(typeof e===u?e.apply(e):e)+'">'+a(typeof e===u?e.apply(e):e)+'<span class="ui-dropdown-checked">&nbsp;</span></li>\n	',n}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+="<ul>\n",o=n.each.call(t,t.list,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+="\n</ul>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/date-dropdown",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("cameraroll-edit-dialog-dates-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){this.dateTaken={},this.originalDateTaken={},this.datePosted={},this.originalDatePosted={},this.hadMultipleValues=!0,this.granularityStrings={circa:this.intlMessage({intlName:"common.CIRCA"}),sometimeIn:this.intlMessage({intlName:"common.SOMETIME_IN"})},this.months=[this.intlMessage({intlName:"common.CIRCA"}),this.intlMessage({intlName:"common.SOMETIME_IN"}),this.intlMessage({intlName:"common.JANUARY"}),this.intlMessage({intlName:"common.FEBRUARY"}),this.intlMessage({intlName:"common.MARCH"}),this.intlMessage({intlName:"common.APRIL"}),this.intlMessage({intlName:"common.MAY"}),this.intlMessage({intlName:"common.JUNE"}),this.intlMessage({intlName:"common.JULY"}),this.intlMessage({intlName:"common.AUGUST"}),this.intlMessage({intlName:"common.SEPTEMBER"}),this.intlMessage({intlName:"common.OCTOBER"}),this.intlMessage({intlName:"common.NOVEMBER"}),this.intlMessage({intlName:"common.DECEMBER"})],this.monthsEnglish=[this.granularityStrings.circa,this.granularityStrings.sometimeIn,"January","February","March","April","May","June","July","August","September","October","November","December"];var n=1825,r=2004,i,s=[],o=[],u=parseInt((new Date).getFullYear(),10);while(u>=n)o.push(u.toString()),u--;u=parseInt((new Date).getFullYear(),10);while(u>=r)s.push(u.toString()),u--;this.takenYears=o,this.postedYears=s,this.days=["-"];for(i=1;i<32;i++)this.days.push(i);if(t.commonData&&t.commonData.dateTaken){this.originalDateTaken=e.clone(t.commonData.dateTaken,!0),this.originalDateTaken.granularity=this.dateTaken.granularity=parseInt(t.commonData.dateTakenGranularity,10),t.commonData.dateTaken.m?this.originalDateTaken.m=this.months[t.commonData.dateTaken.m+1]:this.dateTaken.granularity===6?this.originalDateTaken.m=this.months[1]:this.dateTaken.granularity===8&&(this.originalDateTaken.m=this.months[0]);switch(this.dateTaken.granularity){case 4:this.dateTaken.year=t.commonData.dateTaken.y,this.dateTaken.monthName=this.months[t.commonData.dateTaken.m+1],t.commonData.dateTaken.y&&t.commonData.dateTaken.m&&(this.hadMultipleValues=!1);break;case 6:this.dateTaken.year=t.commonData.dateTaken.y,this.dateTaken.monthName=this.months[1],t.commonData.dateTaken.y&&(this.hadMultipleValues=!1);break;case 8:this.dateTaken.year=t.commonData.dateTaken.y,this.dateTaken.monthName=this.months[0],t.commonData.dateTaken.y&&(this.hadMultipleValues=!1);break;case 10:case 20:break;default:"y"in t.commonData.dateTaken&&(this.dateTaken.year=t.commonData.dateTaken.y),"m"in t.commonData.dateTaken&&(this.dateTaken.monthName=this.months[t.commonData.dateTaken.m+1]),"d"in t.commonData.dateTaken&&(this.dateTaken.day=t.commonData.dateTaken.d),"h"in t.commonData.dateTaken&&(this.dateTaken.hour=this.zeroPad(t.commonData.dateTaken.h)),"i"in t.commonData.dateTaken&&(this.dateTaken.minute=this.zeroPad(t.commonData.dateTaken.i)),"s"in t.commonData.dateTaken&&(this.dateTaken.second=this.zeroPad(t.commonData.dateTaken.s))}}return this.dateTaken.granularity===0&&t.commonData.dateTaken.y!==undefined&&t.commonData.dateTaken.m!==undefined&&t.commonData.dateTaken.d!==undefined&&(this.hadMultipleValues=!1),t.commonData&&t.commonData.dateCreate&&(this.originalDatePosted=e.clone(t.commonData.dateCreate,!0),this.originalDatePosted.m=this.months[t.commonData.dateCreate.m+1],this.datePosted.year=t.commonData.dateCreate.y,this.datePosted.monthName=this.months[t.commonData.dateCreate.m+1],this.datePosted.day=t.commonData.dateCreate.d,this.datePosted.hour=this.zeroPad(t.commonData.dateCreate.h),this.datePosted.minute=this.zeroPad(t.commonData.dateCreate.i),this.datePosted.second=this.zeroPad(t.commonData.dateCreate.s)),this},loadState:function(){return this.appContext.getModel("person-models",this.appContext.getViewer().nsid).then(function(e){this.set("accountStartDate",e.getValue("dateCreated"))}.bind(this))},buildContainer:function(){this.setContainerHTML(this.templates("cameraroll-edit-dialog-dates")({dateTaken:this.dateTaken,datePosted:this.datePosted}))},activate:function(){var e=this.get("container"),t=this;return e.delegate("click",function(e){t.handleDoneClick(e)},".ui-dialog-button-done"),e.delegate("click",function(e){t.handleCloseClick(e)},".ui-dialog-button-close"),e.all(".year").on("click",function(e){var n=e.target.ancestor(".date-inputs").hasClass("date-taken-inputs"),r=e.target.ancestor("div",!0);t.createDropdown(r,n?t.takenYears:t.postedYears,n?t.dateTaken:t.datePosted,134,11,"year")}),e.all(".month").on("click",function(e){var n=e.target.ancestor(".date-inputs").hasClass("date-taken-inputs"),r=e.target.ancestor("div",!0),i=[],s;for(s=0;s<t.months.length;s++)i[s]={},i[s].value=t.monthsEnglish[s],i[s].display=t.months[s];t.createDropdown(r,n?i:i.slice(2),n?t.dateTaken:t.datePosted,134,11,"monthName")}),e.all(".day").on("click",function(e){var n=e.target.ancestor(".date-inputs").hasClass("date-taken-inputs"),r=e.target.ancestor("div",!0);t.createDropdown(r,n?t.days:t.days.slice(1),n?t.dateTaken:t.datePosted,134,11,"day")}),e.all(".date-hour, .date-minute, .date-second").on("keydown",function(e){e.charCode!==190&&e.charCode>31&&(e.charCode<48||e.charCode>57)&&(e.charCode<96||e.charCode>105)&&(e.charCode<37||e.charCode>40)&&e.charCode!==110&&e.charCode!==8&&e.charCode!==46&&e.preventDefault()}),t.registerEventHandler(t.on("validateDates",t.validateNewDates,t)),this.setDateRows(e.one(".date-taken-inputs"),this.dateTaken),this.setDateRows(e.one(".date-posted-inputs"),this.datePosted),this},createDropdown:function(t,n,r,i,s,o){if(t.getAttribute("disabled")==="true")return;var u=e.Node.create("<div></div>"),a=e.Node.create("<div></div>"),f=e.Node.create("<span></span>"),l=this.get("container"),c=l.ancestor(".cameraroll-edit-dialog"),h=c.get("clientWidth"),p=c.get("clientHeight"),d=e.config.win.innerHeight,v=i,m=t.get("offsetLeft"),g=t.get("offsetTop"),y=t.get("offsetWidth"),b=t.get("offsetHeight"
),w=25,E=270,S=p+E*2,x,T,N,C,k,L,A=this,O,M;C=this.templates("date-dropdown")({list:n}),u.setHTML(C),u.hide(),u.addClass("date-dropdown"),u.setStyle("width",v),d<S&&(x=(d-p)/2,T=p-g-b,T+x<E&&(N=T+x-b,N<b*2&&(N=b*2),u.setStyle("maxHeight",N))),u.setY(g+30),u.setX(m+y-v),f.addClass("date-dropdown-arrow"),f.setY(g+21),f.setX(m+y-w),a.addClass("date-dropdown-curtain"),a.setStyle("width",h),a.setStyle("height",p),l.append(a),a.append(f),a.append(u),k=u.delegate("click",function(e){A.onDropdownRowSelected(t,k,a,r,o,e)},"li"),a.on("click",function(e){A.onCloseDropdown(e,k,a)}),r&&r[o]&&(L=u.one('li[value="'+r[o]+'"]'),L&&L.addClass("selected-item")),u.show(),r&&r[o]&&L&&(M=L.getXY(),O=u.getXY(),M[1]-O[1]>=265&&(u.getDOMNode().scrollTop=M[1]-O[1]))},onDropdownRowSelected:function(e,t,n,r,i,s){s.target.get("tagName")==="SPAN"&&(s.target=s.target.ancestor("li"));if(!s.target.hasClass("selected-item")){var o=s.target.getAttribute("value"),u=s.target.get("text");e.one(".date-value").setHTML(u),e.setAttribute("data-"+i,o),r[i]=o,this.onCloseDropdown(s,t,n),this.setDateRows(e,r)}},onCloseDropdown:function(e,t,n){t.detach(),n.remove(!0)},validateNewDates:function(){var t=this,n="?",r="?",i=[{selector:".month",value:"data-monthName",attributeValue:!0,dateFormat:"MMM",commonDataKey:"m"},{selector:".day",value:"data-day",attributeValue:!0,dateFormat:"DD",commonDataKey:"d"},{selector:".year",value:"data-year",attributeValue:!0,dateFormat:"YYYY",commonDataKey:"y"},{selector:".date-hour",value:"value",dateFormat:"HH",defaultValue:0,validate:!0,min:0,max:23,commonDataKey:"h"},{selector:".date-minute",value:"value",dateFormat:"mm",validate:!0,min:0,max:59,commonDataKey:"i"},{selector:".date-second",value:"value",dateFormat:"ss",validate:!0,min:0,max:59,commonDataKey:"s"}],s,o,u,a,f="",l="",c="",h="",p="",d="",v={},m,g=e.one(".cameraroll-edit-dialog-dates-view"),y=g.one(".date-taken-inputs"),b=g.one(".date-posted-inputs"),w=!0,E=!0,S=!0,x=!0,T,N=this.appContext.getViewer().prefs.timezonePref,C=!1,k=this.dateTaken.granularity>=10,L=this.monthsEnglish.map(function(e){return e.toUpperCase()}),A=this.months.map(function(e){return e.toUpperCase()}),O,M=function(e,t){var r=t===""?n:t,i;e==="m"&&(i=L.indexOf((t||"").toUpperCase()),i<0&&(i=A.indexOf((t||"").toUpperCase())),i>0&&(r=i-1)),v[e]=r};O=function(){var e=(v.y||n)+"-"+(v.m||n)+"-"+(v.d||n)+" "+(v.h||n)+":"+(v.i||n)+":"+(v.s||n);return v={},e},i.forEach(function(e){s=y.one(e.selector)[e.attributeValue?"getAttribute":"get"](e.value).trim(),o=t.originalDateTaken[e.commonDataKey];if(o===null||o===undefined)o=n;s!==""||e.commonDataKey!=="h"&&e.commonDataKey!=="i"&&e.commonDataKey!=="s"?s==="-"&&(s=n):s=r,k&&e.commonDataKey==="m"&&s!=o&&(E=!1),E=E&&s==o;if(s===t.granularityStrings.circa||s===t.granularityStrings.sometimeIn){C=!0,t.dateTaken.granularity=s===t.granularityStrings.circa?8:6;return}if(s===n&&e.dateFormat==="DD"&&!C&&(t.originalDateTaken.granularity===4||t.dateTaken.day!==undefined&&t.originalDateTaken.day)){C=!0,t.dateTaken.granularity=4;return}if(s===r)w=!0,M(e.commonDataKey,r);else if(s!==n){if(e.validate){try{T=parseInt(s,10),w=w&&T>=e.min&&T<=e.max}catch(i){w=!1}if(!w)return!1}f+=s+" ",l+=e.dateFormat+" ",M(e.commonDataKey,s)}else if(e.defaultValue)f+=e.defaultValue+" ",l+=e.dateFormat+" ",M(e.commonDataKey,e.defaultValue);else{if(C)return;E||(w=!1)}});if(f&&l&&!E&&!w){t.fire("subviewViewEvent","camerarollEditDialog:datesInvalid","invalidDateTaken");return}p=O(),i.forEach(function(e){s=b.one(e.selector)[e.attributeValue?"getAttribute":"get"](e.value).trim(),o=t.originalDatePosted[e.commonDataKey];if(o===null||o===undefined)o=n;s!==""||e.commonDataKey!=="h"&&e.commonDataKey!=="i"&&e.commonDataKey!=="s"?s==="-"&&(s=n):s=r,x=x&&s==o;if(s===r)S=!0,M(e.commonDataKey,r);else if(s!==n){if(e.validate){try{T=parseInt(s,10),S=S&&T>=e.min&&T<=e.max}catch(i){S=!1}if(!S)return!1}c+=s+" ",h+=e.dateFormat+" ",M(e.commonDataKey,s)}else e.defaultValue?(c+=e.defaultValue+" ",h+=e.dateFormat+" ",M(e.commonDataKey,e.defaultValue)):x||(S=!1)});if(c&&h&&!S&&!x){t.fire("subviewViewEvent","camerarollEditDialog:datesInvalid","invalidDatePosted");return}d=O(),f!==""&&(u=e.moment(f,l||"dd-mm-yyyy")),m=this.dateTaken.granularity,N.name?a=e.moment.tz(c,h,N.name):a=e.moment(c,h);if(!u&&!a){this.fire("subviewViewEvent","camerarollEditDialog:datesEmpty");return}if(a&&a.year()!==0&&a.isValid()&&!x){var _=this.get("accountStartDate");if(a.isBefore(_)){this.fire("subviewViewEvent","camerarollEditDialog:datesInvalid","invalidDatePostedBeforeAccount",_);return}}if(E&&x){this.fire("subviewViewEvent","camerarollEditDialog:datesEmpty");return}if(u&&a&&!E&&!x){if(a.diff(e.moment(),"days")>1){this.fire("subviewViewEvent","camerarollEditDialog:datesInvalid","datePostedFuture");return}this.fire("subviewViewEvent","camerarollEditDialog:datesToBeUpdated",u.format("YYYY-MM-DD HH:mm:ss"),a.format("X"),m,p,d)}else if(u&&!E){if(u.diff(e.moment(),"days")>2){this.fire("subviewViewEvent","camerarollEditDialog:datesInvalid","dateTakenFuture");return}this.fire("subviewViewEvent","camerarollEditDialog:datesToBeUpdated",u.format("YYYY-MM-DD HH:mm:ss"),null,m,p)}else{if(!a||!!x){this.fire("subviewViewEvent","camerarollEditDialog:datesInvalid","both");return}if(a.diff(e.moment(),"days")>1){this.fire("subviewViewEvent","camerarollEditDialog:datesInvalid","datePostedFuture");return}this.fire("subviewViewEvent","camerarollEditDialog:datesToBeUpdated",null,a.format("X"),null,null,d)}},setDateRows:function(e,t){var n=e.ancestor(".date-inputs",!0),r,i,s,o,u,a,f,l,c,h;n&&(r=n.one(".year").getAttribute("data-year"),i=n.one(".month").getAttribute("data-monthName"),s=n.one(".day"),o=n.one(".date-hour"),u=n.one(".date-minute"),f=n.one(".date-second"),h=n.one(".time-fields"),l=i===this.granularityStrings.circa,c=i===this.granularityStrings.sometimeIn,a=n.hasClass("date-taken-inputs"),l||c?a&&(this.hadMultipleValues||(t.granularity=l?8:6),s.one(".date-value").setHTML("-"),s.setAttribute("data-day","-"),t.day="-",s.setAttribute
("disabled",!0),s.addClass("hide-day"),o.setAttribute("value","-"),o.setAttribute("disabled",!0),u.setAttribute("value","-"),u.setAttribute("disabled",!0),f.setAttribute("value","-"),f.setAttribute("disabled",!0),h.addClass("hide-time")):r&&i===""?a&&(this.hadMultipleValues||(t.granularity=6),o.setAttribute("value","-"),o.setAttribute("disabled",!0),u.setAttribute("value","-"),u.setAttribute("disabled",!0),f.setAttribute("value","-"),f.setAttribute("disabled",!0),h.addClass("hide-time")):(s.removeAttribute("disabled"),s.removeClass("hide-day"),s.getAttribute("data-day")==="-"?(this.hadMultipleValues||(t.granularity=4),o.setAttribute("value",""),o.setAttribute("disabled",!0),u.setAttribute("value",""),u.setAttribute("disabled",!0),f.setAttribute("value",""),f.setAttribute("disabled",!0),h.addClass("hide-time")):(this.hadMultipleValues||(!a||s.getAttribute("data-day")!==""||this.dateTaken.granularity!==10&&this.dateTaken.granularity!==20?t.granularity=0:t.granularity=this.dateTaken.granularity),o.setAttribute("value",t.hour||""),o.removeAttribute("disabled"),u.setAttribute("value",t.minute||""),u.removeAttribute("disabled"),f.setAttribute("value",t.second||""),f.removeAttribute("disabled"),h.removeClass("hide-time"))))},zeroPad:function(e){return e<10?"0"+e:e}})},"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-cameraroll-edit-dialog-dates","cameraroll-edit-dialog-dates-css","hermes-template-date-dropdown","hermes-template-validation-error","validation-error-css","moment","moment-timezone"],optional:[],langBundles:["common","photo-page-scrappy"]});
YUI.add("cameraroll-edit-dialog-body-view",function(e,t){var n=require("lib/flog")(t),r,i={},s={},o={},u,a,f=[],l=[],c=[],h=[],p=[],d=e.config.flickr.api.max_concurrent_photos_api_can_handle,v=e.config.flickr.api.max_tags_in_photo,m=e.config.flickr.api.max_concurrent_photo_date_sets,g=[],y,b,w=!1;u={tagAddition:!1,tagRemoval:!1,peopleAddition:!1,peopleRemoval:!1,photoUpdate:!1,permissionsUpdate:!1,datesUpdate:!0},a={tagsRetry:10,peopleRetry:10,photoRetry:10,permissionsRetry:10,datesRetry:10},r={debug:!1,css:{safetyLevel:".c-charm-item-safetylevel .ui-dropdown",privacy:".c-charm-item-privacy .ui-dropdown",license:".photo-license-info .ui-dropdown",commentingPermission:".commenting-permission .ui-dropdown",addMetaPermission:".add-meta-permission .ui-dropdown"}},e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return e.commonData.tags=e.commonData.tags||[],e.commonData.people=e.commonData.people||[],this.set("originalFieldValues",e.commonData),this},subviewConfig:{"cameraroll-edit-dialog-people-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"cameraroll-edit-dialog-dates-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1}},loadState:function(){var t=this;return(new e.FlickrPromise({personInPhotoModel:t.appContext.getModelRegistry("person-in-photo-models"),person:t.appContext.getModelRegistry("person-models")})).then(function(e){var n=t.appContext.getViewer();t.set("personInPhotoModel",e.personInPhotoModel),t.set("person",e.person);if(n.signedIn)return e.person.get(n.nsid).then(function(e){t.set("me",e)})})},buildContainer:function(){var e,t=this,n,r,i,s,o,u,a,f=this.get("selectedPhotosIDs").length,l;return n=t.intlMessage({intlName:"cameraroll.TITLE_PLACEHOLDER",selectedCount:f}),r=t.intlMessage({intlName:"cameraroll.DESCRIPTION_PLACEHOLDER",selectedCount:f}),i=t.intlMessage({intlName:"cameraroll.EDIT_PRIVACY_LABEL",selectedCount:f}),s=t.intlMessage({intlName:"cameraroll.EDIT_SAFETY_LABEL",selectedCount:f}),o=t.intlMessage({intlName:"cameraroll.EDIT_COMMENTING_PERMISSION_LABEL",selectedCount:f}),u=t.intlMessage({intlName:"cameraroll.EDIT_TAGGING_PERMISSION_LABEL",selectedCount:f}),a=t.intlMessage({intlName:"cameraroll.EDIT_COPYRIGHT_LABEL",selectedCount:f}),l=this.get("originalFieldValues"),l.description&&(l.description=l.description.replace(/&quot;/g,'"').replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<")),e=this.templates("cameraroll-edit-dialog-body")({originalFieldValues:l,titlePlaceholder:n,descriptionPlaceholder:r,privacyLabel:i,safetyLabel:s,commentingPermissionLabel:o,taggingPermissionLabel:u,licenseLabel:a,"cameraroll-edit-dialog-people-view":this.subviews["cameraroll-edit-dialog-people-view"].get("container"),"cameraroll-edit-dialog-dates-view":this.subviews["cameraroll-edit-dialog-dates-view"].get("container")}),this.setContainerHTML(e),this},activate:function(){var t=this,n=this.get("container"),o=n.one(".title-desc-container"),u=this.get("originalFieldValues"),a=this.subviews["cameraroll-edit-dialog-people-view"],f=this.subviews["cameraroll-edit-dialog-dates-view"],l,c,h;this.privacyDd=new e.Views.Dropdown({appContext:this.appContext,container:n.one(r.css.privacy),selected:this.getDataFromOriginalValues("privacy"),defaultLabel:this.intlMessage({intlName:"cameraroll.MULTIPLE_SELECT_VALUE"}),disabled:!1}),this.privacyDd.on("open",function(n){t.fire("subviewViewEvent","make in view",t.privacyDd.get("container")),e.rapidTracker.beacon(t.name,"camerarollTrayEditModalPrivacyMenuClick")}),this.privacyDd.on("close",function(e){t.fire("subviewViewEvent","close in view")}),this.privacyDd.on("selected",function(e){s.privacy=t.mapPrivacy(e.clicked.value)}),this.commentingPermissionDd=new e.Views.Dropdown({appContext:this.appContext,container:n.one(r.css.commentingPermission),selected:u.permComment,defaultLabel:this.intlMessage({intlName:"cameraroll.MULTIPLE_SELECT_VALUE"}),disabled:!1}),this.commentingPermissionDd.on("open",function(n){t.fire("subviewViewEvent","make in view",t.commentingPermissionDd.get("container")),e.rapidTracker.beacon(t.name,"camerarollTrayEdit:CommentPermissionMenuClick")}),this.commentingPermissionDd.on("close",function(e){t.fire("subviewViewEvent","close in view")}),this.commentingPermissionDd.on("selected",function(e){s.commenting=e.clicked.value}),this.addMetaPermissionDd=new e.Views.Dropdown({appContext:this.appContext,container:n.one(r.css.addMetaPermission),selected:u.permAddmeta,defaultLabel:this.intlMessage({intlName:"cameraroll.MULTIPLE_SELECT_VALUE"}),disabled:!1}),this.addMetaPermissionDd.on("open",function(n){t.fire("subviewViewEvent","make in view",t.addMetaPermissionDd.get("container")),e.rapidTracker.beacon(t.name,"camerarollTrayEdit:AddMetaPermissionMenuClick")}),this.addMetaPermissionDd.on("close",function(e){t.fire("subviewViewEvent","close in view")}),this.addMetaPermissionDd.on("selected",function(e){s.addMeta=e.clicked.value}),this.safetyLevelDd=new e.Views.Dropdown({appContext:this.appContext,container:n.one(r.css.safetyLevel),selected:u.adultness,defaultLabel:this.intlMessage({intlName:"cameraroll.MULTIPLE_SELECT_VALUE"}),disabled:!1}),this.safetyLevelDd.on("open",function(n){t.fire("subviewViewEvent","make in view",t.safetyLevelDd.get("container")),e.rapidTracker.beacon(t.name,"camerarollTrayEdit:safetyMenuClick")}),this.safetyLevelDd.on("close",function(e){t.fire("subviewViewEvent","close in view")}),this.safetyLevelDd.on("selected",function(e){i.safetyLevel=e.clicked.value}),this.licenseDd=new e.Views.Dropdown({appContext:this.appContext,container:n.one(r.css.license),selected:u.license,defaultLabel:this.intlMessage({intlName:"cameraroll.MULTIPLE_SELECT_VALUE"}),disabled:!1}),this.licenseDd.on("open",function(n){t.fire("viewEvent","make in view",t.licenseDd.get("container")),e.rapidTracker.beacon(t.name,"camerarollTrayEdit:LicenseMenuClick")}),this.licenseDd.on("close",function(e){t.fire("viewEvent","close in view")}),this.licenseDd.on("selected",function(
e){i.license=e.clicked.value}),this.on("destroy",function(){t.safetyLevelDd.destroy(),t.privacyDd.destroy(),t.licenseDd.destroy(),t.commentingPermissionDd.destroy(),t.addMetaPermissionDd.destroy()}),t.registerEventHandler(t.on("doSave",t.checkDates,t)),t.registerEventHandler(o.on("focus",function(){o.addClass("focused")})),t.registerEventHandler(o.on("blur",function(){o.removeClass("focused")})),t.registerEventHandler(n.one(".edit-photos-tags").on("keydown",function(e){e.charCode===13&&(e.preventDefault(),t.addTagsToDialog(this.get("value")))}));if(u.tags&&u.tags.length)for(l=0,c=u.tags.length;l<c;l++)t.addTagsToDialog(u.tags[l].tagRaw,!0);t.registerEventHandler(n.one(".tags-container").delegate("click",t.removeTag,".remove-tag",t)),a&&a.activate();if(u.people&&u.people.length)for(l=0,c=u.people.length;l<c;l++)h=u.people[l],a.addTemporaryPersonTag(h.realname||h.characterName,h.nsid,e.URLHelper.getBuddyIconURL(h.nsid,h.iconfarm,h.iconserver),h.ispro||h.isPro),a.contacts.hideFromSearch(h.nsid);return f&&f.activate(),this},checkDates:function(e){this.parentModal=e,this.subviews["cameraroll-edit-dialog-dates-view"].fire("validateDates")},callNextInQueue:function(){var e,t=this;if(g.length!==0)return y=!0,e=g.shift(),e().then(function(){return t.callNextInQueue()},function(){return t.callNextInQueue()});y=!1},addToQueue:function(e){g.push(e),y||this.callNextInQueue()},getDataFromOriginalValues:function(e){var t=this.get("originalFieldValues"),r;if(e==="privacy"){if(!("isPublic"in t&&"isFriend"in t&&"isFamily"in t))return;t.isPublic?r="public":t.isFriend&&t.isFamily?r="friendsandfamily":t.isFriend?r="friends":t.isFamily?r="family":r="private"}else n.warn("Unknown type passed to getDataFromOriginalValues");return r},mapPrivacy:function(e){var t,n,r,i,s;t=[["public",["isPublic"]],["friendsandfamily",["isVisibleByFriends","isVisibleByFamily"]],["friends",["isVisibleByFriends"]],["family",["isVisibleByFamily"]],["private",[]]];if(typeof e=="object"){for(n=0,r=t.length;n<r;n++){i=t[n];if(!i[1].length||i[1].every(function(t){return!!e[t]}))return i[0]}return null}s={};for(n=0,r=t.length;n<r;n++)i=t[n],i[1].forEach(function(t){s[t]=i[0]===e?!0:s[t]||!1});return s},processTag:function(t){var n=this,r,i,s;s=t.replace(/"(.*?)"/g,function(e,t){return t=t.replace(/(,)/g,function(e,t){return t="{COMMA}",t}),t=t.replace(/(\s+)/g,function(e,t){return t="{WHITESPACE"+t.charCodeAt(0)+"}",t}),t}),s.indexOf(",")>-1?i=s.split(/,/):i=s.split(/\s+/);for(r in i)i[r]=i[r].replace(/\{WHITESPACE([0-9]+)\}/g,function(e,t){return t=String.fromCharCode(t),t}),i[r]=i[r].replace(/\{COMMA\}/g,function(e,t){return t=",",t});return e.Array.each(i,function(t,n){i[n]=e.Lang.trim(t)}),i=e.Array.filter(i,function(e,t){if(e.length>0)return!0}),i=e.Array.unique(i,function(e,t,r){return n.cleanTag(e)===n.cleanTag(t)}),i},addTagsToDialog:function(t,n){var r=this,i=this.get("container"),s=this.get("originalFieldValues").tags,o,u,a,c,h,p;if(n){this.renderTag(t),this.resetTagInput();return}if(t==='""'||t==="''"){this.resetTagInput();return}o=this.processTag(t),o=o.filter(function(t){return t=r.cleanTag(t),f.indexOf(t)>-1?!1:e.Array.find(s,function(e){return t===e.tagClean})?e.Array.find(l,function(e){return t===e.tagClean}):!0}),h=f.length,s.length+h+o.length-l.length>v&&i.one(".max-tags-reached").removeClass("hidden");for(p=0;p<o.length;p++){u=o[p],a=this.cleanTag(u);if(s.length+h+p-l.length>=v)break;e.Array.find(s,function(e){return e.tagClean===a})?(e.Array.find(l,function(e,t){if(e.tagClean===a)return c=t,!0}),l.splice(c,1)):f.push(u),this.renderTag(u)}this.resetTagInput(!0)},removeTag:function(t){t.preventDefault();var n,r,i,s=this.get("container"),o=this.get("originalFieldValues").tags,u,a=s.one(".tags-list"),c=s.one(".machine-tags-list");i=t.target.ancestor(".tag"),n=i.one(".tag-text").get("text"),r=this.cleanTag(n),i.remove(),u=e.Array.find(o,function(e){return e.tagClean===r}),u?l.push(u):f.splice(f.indexOf(n),1),o.length+f.length<v&&s.one(".max-tags-reached").hasClass("hidden")&&s.one(".max-tags-reached").addClass("hidden"),c.getDOMNode().childElementCount?a.getDOMNode().childElementCount||a.addClass("hidden"):c.addClass("hidden")},cleanTag:function(e){return e.replace(/\s/g,"").toLowerCase()},renderTag:function(t){var n=this.get("container"),r=n.one(".tags-list"),i=n.one(".machine-tags-list"),s=/^[a-zA-Z]\w*:[a-zA-Z]\w*=.+/;s.test(t)?(i.removeClass("hidden"),i.append('<li class="tag"><span class="tag-text">'+e.flutil.escapeInput(t,"html")+'</span><a class="remove-tag"><i class="delete-tag" title="Delete"></i></a></li>')):(r.removeClass("hidden"),r.append('<li class="tag"><span class="tag-text">'+e.flutil.escapeInput(t,"html")+'</span><a class="remove-tag" href="#"><i class="delete-tag" title="Delete"></i></a></li>'))},resetTagInput:function(e){var t=this.get("container").one(".edit-photos-tags");t.set("value",""),e&&t.focus()},saveTags:function(t){var r,i=this,s=0,o,c,h,d=this.get("container"),v=d.one(".edit-photos-tags"),m,g=[],y=[],b,w,E=50,S;v.get("value")!==""&&this.addTagsToDialog(v.get("value")),r=t||this.get("selectedPhotosIDs"),w=r.length,b=Math.ceil(w/E),m=b,e.rapidTracker.beacon(i.name,"camerarollTrayEdit:TagsAdded"),i.appContext.getModelRegistry("tag-models").then(function(t){for(c=0;c<b;c++)o=r.slice(s,E+s),s+=E,f.length?(e.Array.each(f,function(e,t){f[t]='"'+e+'"'}),t.remoteCreate({photoId:o,tags:f,fullResponse:1}).then(function(e){m--;if(e&&e.length>0){n.warn("editing tags failed",{errors:e});for(h=0;h<e.length;h++)e[h].code===106&&a.tagsRetry>0?(g.push(e[h].photoId),g=g.filter(function(e,t){return g.indexOf(e)===t})):e[h].code===2?y.push(e[h].photoId):p.push({id:e[h].photoId,code:e[h].code,api:"tagsAdd"})}if(!m){if(g.length!==0&&a.tagsRetry>0)return u.tagAddition=!1,a.tagsRetry--,i.saveTags(g);y.length>0&&p.push({id:"",photosFailed:y.length,code:"2",api:"maxTagsInPhoto"}),u.tagAddition=!0,f=[],i.checkIfAPICallsAreDone()}},function(e){n.warn("editing tags failed",{err:e}),m--,e.photoIds.forEach(function(t){a.tagsRetry>0&&
(e.clientTimeout||e.message==="XHR error")?g.indexOf(t)===-1&&g.push(t):p.push({id:t,code:"noRetry",api:"tagsAdd"})});if(!m){if(g.length!==0&&a.tagsRetry>0)return u.tagAddition=!1,a.tagsRetry--,i.saveTags(g);u.tagAddition=!0,f=[],i.checkIfAPICallsAreDone()}})):u.tagAddition=!0,l.length?(S=[],e.Array.each(l,function(e,t){S.push(e.id)}),t.remoteDelete({photoIds:o,globalTagIds:S}).then(function(e){u.tagRemoval=!0,l=[],i.checkIfAPICallsAreDone()},function(e){i.checkIfAPICallsAreDone()})):u.tagRemoval=!0})},savePeople:function(t){var r,i=this,s=0,o,f,l,d,v,m,g=[],y=[],b=[],w=[],E=[],S,x,T,N=50;r=t||this.get("selectedPhotosIDs"),T=r.length,x=Math.ceil(T/N),S=x,e.rapidTracker.beacon(i.name,"camerarollTrayEdit:PeopleAdded");for(f=0;f<x;f++)o=r.slice(s,N+s),s+=N,c.length?this.get("personInPhotoModel").remoteCreate({photoId:o.join(","),userId:c.join(","),addedBy:i.get("me").getValue("nsid"),coords:{x:0,y:0,w:0,h:0},fullResponse:1}).then(function(e){S--;if(e){n.warn("editing people tags failed",{errors:e});if(e.photosAllUsers&&e.photosAllUsers.length>0)for(l=0;l<e.photosAllUsers.length;l++)E.push(e.photosAllUsers[l].photoId);if(e.usersAllPhotos&&e.usersAllPhotos.length>0)for(d=0;d<e.usersAllPhotos.length;d++)w.indexOf(e.usersAllPhotos[d].userId)<0&&w.push(e.usersAllPhotos[d].userId);if(e.otherErrors&&e.otherErrors.length>0)for(v=0;v<e.otherErrors.length;v++)e.otherErrors[v].code===106&&a.peopleRetry>0?(g.push(e.otherErrors[v].photoId),g=g.filter(function(e,t){return g.indexOf(e)===t})):e.otherErrors[v].code===5||e.otherErrors[v].code===3?b.push(e.otherErrors[v].userId):p.push({id:e.otherErrors[v].photoId,code:e.otherErrors[v].code,api:"peopleTagsAdd"})}if(!S){if(g.length!==0&&a.peopleRetry>0)return u.peopleAddition=!1,a.peopleRetry--,i.savePeople(g);b.length>0&&(b=b.filter(function(e,t){return b.indexOf(e)===t}),p.push({id:"",usersFailed:b.length,code:"5",api:"unableToAddPersonToPhoto"})),w.length>0&&p.push({id:"",usersFailed:w.length,code:"3",api:"peopleUserError"}),E.length>0&&p.push({id:"",photosFailed:E.length,code:"2",api:"peoplePhotoError"}),c=[],u.peopleAddition=!0,i.checkIfAPICallsAreDone()}},function(e){n.warn("editing people tags failed",{err:e}),S--,y=e.photoIds.split(",");if(a.peopleRetry>0&&(e.clientTimeout||e.message==="XHR error"))g=g.concat(y),g=g.filter(function(e,t){return g.indexOf(e)===t});else for(m=0;m<y.length;m++)p.push({id:y[m],code:"noRetry",api:"peopleTagsAdd"});if(!S){if(g.length!==0&&a.peopleRetry>0)return u.peopleAddition=!1,a.peopleRetry--,i.savePeople(g);c=[],u.peopleAddition=!0,i.checkIfAPICallsAreDone()}}):u.peopleAddition=!0,h.length?this.get("personInPhotoModel").remoteDelete({photoIds:o.join(","),userIds:h.join(",")}).then(function(e){n.info("people removal success",{result:e}),u.peopleRemoval=!0,h=[],i.checkIfAPICallsAreDone()},function(e){n.warn("people removal failure",{err:e}),i.checkIfAPICallsAreDone()}):u.peopleRemoval=!0},savePhotosUpdates:function(t){var r,s=0,o,f,l,c,h,v,m,g,y,b,w,E=[],S=[],x,T,N,C=this;r=t||this.get("selectedPhotosIDs"),N=r.length,T=Math.ceil(N/d),g=T,i.safetyLevel&&e.rapidTracker.beacon(C.name,"camerarollTrayEdit:SafetyChanged"),i.license&&e.rapidTracker.beacon(C.name,"camerarollTrayEdit:LicenseChanged"),C.appContext.getModelRegistry("photo-models").then(function(e){for(l=0;l<T;l++)o=r.slice(s,d+s),f=o.join(","),s+=d,e.remoteBatchUpdate(f,i).then(function(e){if(e&&e.length>0)if(e.length===3&&e[2]){y=e[0].errors;for(c=0;c<y.length;c++)y[c].code===106&&a.photoRetry>0?(E.push(y[c].photoId),E=E.filter(function(e,t){return E.indexOf(e)===t})):p.push({id:y[c].photoId,code:y[c].code,api:e[0].api});b=e[1].errors;for(h=0;h<b.length;h++)b[h].code===106&&a.photoRetry>0?(E.push(b[h].photoId),E=E.filter(function(e,t){return E.indexOf(e)===t})):p.push({id:b[h].photoId,code:b[h].code,api:e[1].api});w=e[2].errors;for(v=0;v<w.length;v++)w[v].code===106&&a.photoRetry>0?(E.push(w[v].photoId),E=E.filter(function(e,t){return E.indexOf(e)===t})):p.push({id:w[v].photoId,code:w[v].code,api:e[2].api})}else if(e.length===2&&e[1]){y=e[0].errors;for(c=0;c<y.length;c++)y[c].code===106&&a.photoRetry>0?(E.push(y[c].photoId),E=E.filter(function(e,t){return E.indexOf(e)===t})):p.push({id:y[c].photoId,code:y[c].code,api:e[0].api});b=e[1].errors;for(h=0;h<b.length;h++)b[h].code===106&&a.photoRetry>0?(E.push(b[h].photoId),E=E.filter(function(e,t){return E.indexOf(e)===t})):p.push({id:b[h].photoId,code:b[h].code,api:e[1].api})}else if(e[0]){y=e[0].errors;for(c=0;c<y.length;c++)y[c].code===106&&a.photoRetry>0?(E.push(y[c].photoId),E=E.filter(function(e,t){return E.indexOf(e)===t})):p.push({id:y[c].photoId,code:y[c].code,api:e[0].api})}g--;if(!g){if(E.length!==0&&a.photoRetry>0)return u.photoUpdate=!1,a.photoRetry--,C.savePhotosUpdates(E);i={},u.photoUpdate=!0,C.checkIfAPICallsAreDone()}},function(e){n.warn("editing photo failed",{err:e}),g--,S=e.photoIds.split(",");if(a.photoRetry>0&&(e.clientTimeout||e.message==="XHR error"))E=E.concat(S),E=E.filter(function(e,t){return E.indexOf(e)===t});else{x=e.returnApi;for(m=0;m<S.length;m++)p.push({id:S[c].photoId,code:"",api:x})}if(!g){if(E.length!==0&&a.photoRetry>0)return u.photoUpdate=!1,a.photoRetry--,C.savePhotosUpdates(E);i={},u.photoUpdate=!0,C.checkIfAPICallsAreDone()}}).catch(function(e){p.push({id:"",code:e.code,api:"photoUpdate"}),u.photoUpdate=!0,C.checkIfAPICallsAreDone()})})},savePhotosPermissions:function(t){var r,i=0,o,f,l,c,h,d,v,m=[],g=[],y,b,w,E=50,S=this;r=t||this.get("selectedPhotosIDs"),w=r.length,b=Math.ceil(w/E),v=b,e.rapidTracker.beacon(S.name,"camerarollTrayEdit:PermissionsChanged"),S.appContext.getModelRegistry("photo-privacy-models").then(function(t){for(c=0;c<b;c++)o=r.slice(i,E+i),f=o.join(","),i+=E,l=e.clone(s.privacy),t.remoteBatchUpdate(f,s).then(function(t){y=t.errors;if(y&&y.length>0){n.warn("editing permissions failed",t);for(h=0;h<y.length;h++)y[h].code===106&&a.permissionsRetry>0?(m.push(y[h].photoId),m=m.filter(function(e,t){return m.indexOf(e)===t})):p.push({id:y[h].photoId,code:y[h].code,api
:"photoPermissionsUpdate"})}else"privacy"in s&&e.fire("cameraRollEditDialog:selectionPrivacyChanged",{newPrivacyValues:l,privacyChangedIDs:t.photoIdsSent.split(",")});v--;if(!v){if(m.length!==0&&a.permissionsRetry>0)return u.permissionsUpdate=!1,a.permissionsRetry--,S.savePhotosPermissions(m);s={},u.permissionsUpdate=!0,S.checkIfAPICallsAreDone()}},function(e){n.warn("editing permissions failed",{err:e}),v--,g=e.photoIds.split(",");if(a.permissionsRetry>0&&(e.clientTimeout||e.message==="XHR error"))m=m.concat(g),m=m.filter(function(e,t){return m.indexOf(e)===t});else for(d=0;d<g.length;d++)p.push({id:g[d],code:"noRetry",api:"photoPermissionsUpdate"});if(!v){if(m.length!==0&&a.permissionsRetry>0)return u.permissionsUpdate=!1,a.permissionsRetry--,S.savePhotosPermissions(m);s={},u.permissionsUpdate=!0,S.checkIfAPICallsAreDone()}}).catch(function(e){p.push({id:"",code:e.code,api:"photoPermissionsUpdate"}),u.permissionsUpdate=!0,S.checkIfAPICallsAreDone()})})},saveDates:function(t,n){var r=this,i,s=0,f,l,c,h,d,v,g,y,b=[],E=[],S=[];u.datesUpdate=!1,i=n||this.get("selectedPhotosIDs"),g=i.length,v=Math.ceil(g/m),y=v,t&&(t[1]&&(o.takenDate=t[1]),t[2]&&(o.postedDate=t[2]),t[3]>=0&&t[3]<=10&&(o.takenGranularity=t[3]),t.length>=5&&t[4]&&(o.dateTakenPartial=t[4],o.takenDate=undefined),t.length>=6&&t[5]&&(o.datePostedPartial=t[5],o.postedDate=undefined)),e.rapidTracker.beacon(r.name,"camerarollTrayEdit:datesChanged",{count:g}),r.appContext.getModelRegistry("photo-stats-models").then(function(t){for(c=0;c<v;c++)f=i.slice(s,m+s),l=f.join(","),s+=m,t.remoteBatchUpdate(l,o).then(function(t){y--,S=S.concat(l);if(t&&t.length>0)for(h=0;h<t.length;h++)S.slice(S.indexOf(t[h].photoId),1),t[h].code===106&&a.datesRetry>0?(b.push(t[h].photoId),b=b.filter(function(e,t){return b.indexOf(e)===t})):(p.push({id:t[h].photoId,code:t[h].code,api:"dates"}),p=p.filter(function(e,t){return p.indexOf(e)===t}));w=!0,e.fire("cameraRollEditDialog:datesChanged",{newDates:o,photoIdsUpdated:S[0].split(",")});if(!y){if(b.length!==0&&a.datesRetry>0)return u.datesUpdate=!1,a.datesRetry--,r.saveDates(null,b);o={},u.datesUpdate=!0,r.checkIfAPICallsAreDone()}},function(e){var t=!1,n=!1;y--,e&&e.photoIds&&e.photoIds.length&&(E=e.photoIds.split(","));if(a.datesRetry>0&&(e.clientTimeout||e.message==="XHR error"))b=b.concat(E),b=b.filter(function(e,t){return b.indexOf(e)===t});else if(e.message==="Invalid date_posted")t=!0;else if(e.message==="Invalid Date Taken")n=!0;else for(d=0;d<E.length;d++)p.push({id:E[d],code:"noRetry",api:"dates"});if(!y){if(b.length!==0&&a.datesRetry>0)return u.datesUpdate=!1,a.datesRetry--,r.saveDates(null,b);t&&p.push({id:"",code:4,api:"datePostedGreaterThanFlickr"}),n&&p.push({id:"",code:6,api:"dateTakenInvalid"}),o={},u.datesUpdate=!0,r.checkIfAPICallsAreDone()}}).catch(function(e){p.push({id:"",code:e.code,api:"dates"}),u.datesUpdate=!0,r.checkIfAPICallsAreDone()})},function(e){p.push({id:"",code:e.code,api:"dates"}),u.datesUpdate=!0,r.checkIfAPICallsAreDone()})},checkIfAPICallsAreDone:function(){var t=this,n=this.get("container"),r=this.get("selectedPhotosIDs").length,i=0;p.forEach(function(e){i+=e.photosFailed}),u.peopleAddition&&u.peopleRemoval&&u.permissionsUpdate&&u.photoUpdate&&u.tagAddition&&u.tagRemoval&&u.datesUpdate&&(n.ancestor(".cameraroll-edit-dialog").one(".foot").removeClass("balls"),u={tagAddition:!1,tagRemoval:!1,peopleAddition:!1,peopleRemoval:!1,photoUpdate:!1,permissionsUpdate:!1,datesUpdate:!0},a={tagsRetry:10,peopleRetry:10,photoRetry:10,permissionsRetry:10,datesRetry:10},b.close(),p.length>0&&t.consolidateErrors(),e.fire("cameraRollEditDialog:apiCallsDone",{datesChanged:w,numberOfPhotosUpdated:this.noChanges?0:r-i}),w=!1)},consolidateErrors:function(){var e=this,t,n,r=[],i=[],s=[],o=[],u=[],a=[],f=[],l=[],c,h,d,v,m,g,y,b;b=e.intlMessage({intlName:"cameraroll.CONSOLIDATED_ERROR_MESSAGE"})+"<ul class='consolidated-error-list'>";for(t=0;t<p.length;t++)p[t].api==="setMeta"?r.push(p[t]):p[t].api==="setSafety"?i.push(p[t]):p[t].api==="setLicense"?s.push(p[t]):p[t].api==="photoPermissionsUpdate"?o.push(p[t]):p[t].api==="invalidDates"?l.push(p[t]):p[t].api==="dates"?f.push(p[t]):p[t].api==="datePostedGreaterThanFlickr"?b=b+"<li class='error-list-item'>"+e.intlMessage({intlName:"cameraroll.DATE_UPLOADED_GREATER_THAN_FLICKR_JOIN"})+"</li>":p[t].api==="dateTakenInvalid"?b=b+"<li class='error-list-item'>"+e.intlMessage({intlName:"common.INVALID_DATE_TAKEN"})+"</li>":p[t].api==="peopleTagsAdd"?a.push(p[t]):p[t].api==="peopleUserError"?b=b+"<li class='error-list-item'>"+e.intlMessage({intlName:"cameraroll.UNABLE_TO_ADD_USERS_TO_ALL_PHOTOS",count:p[t].usersFailed})+"</li>":p[t].api==="peoplePhotoError"?b=b+"<li class='error-list-item'>"+e.intlMessage({intlName:"cameraroll.UNABLE_TO_ADD_PHOTOS_TO_ALL_USERS",count:p[t].photosFailed})+"</li>":p[t].api==="unableToAddPersonToPhoto"?b=b+"<li class='error-list-item'>"+e.intlMessage({intlName:"cameraroll.UNABLE_TO_ADD_USERS_TO_PHOTO",count:p[t].usersFailed})+"</li>":p[t].api==="maxTagsInPhoto"?b=b+"<li class='error-list-item'>"+e.intlMessage({intlName:"cameraroll.UNABLE_TO_ADD_TAGS_TO_PHOTOS",count:p[t].photosFailed})+"</li>":p[t].api==="tagsAdd"?u.push(p[t]):p[t].api==="photoUpdate"&&a.push(p[t]);r.length>0&&(c="<li class='error-list-item'>"+e.intlMessage({intlName:"cameraroll.ERROR_TITLE_PHOTOS",count:r.length})+"</li>",b+=c),i.length>0&&(h="<li class='error-list-item'>"+e.intlMessage({intlName:"cameraroll.ERROR_SAFETY_PHOTOS",count:i.length})+"</li>",b+=h),s.length>0&&(d="<li class='error-list-item'>"+e.intlMessage({intlName:"cameraroll.ERROR_LICENSE_PHOTOS",count:s.length})+"</li>",b+=d),o.length>0&&(v="<li class='error-list-item'>"+e.intlMessage({intlName:"cameraroll.ERROR_PERMISSIONS_PHOTOS",count:o.length})+"</li>",b+=v),u.length>0&&(m="<li class='error-list-item'>"+e.intlMessage({intlName:"cameraroll.ERROR_TAGS_PHOTOS",count:u.length})+"</li>",b+=m),a.length>0&&(g="<li class='error-list-item'>"+e.intlMessage({intlName:"cameraroll.ERROR_PEOPLE_PHOTOS",count
:a.length})+"</li>",b+=g),f.length>0&&(y="<li class='error-list-item'>"+e.intlMessage({intlName:"cameraroll.ERROR_DATES_PHOTOS",count:f.length})+"</li>",b+=y);if(l.length>0)for(n=0;n<l.length;n++)l[n].code===e.intlMessage({intlName:"common.INVALID_DATE_TAKEN"})&&(b=b+"<li class='error-list-item'>"+e.intlMessage({intlName:"common.INVALID_DATE_TAKEN"})+"</li>"),l[n].code===e.intlMessage({intlName:"common.INVALID_DATE_UPLOADED"})&&(b=b+"<li class='error-list-item'>"+e.intlMessage({intlName:"common.INVALID_DATE_UPLOADED"})+"</li>"),l[n].code===e.intlMessage({intlName:"common.FUTURE_DATE_UPLOADED"})&&(b=b+"<li class='error-list-item'>"+e.intlMessage({intlName:"common.FUTURE_DATE_UPLOADED"})+"</li>"),l[n].code===e.intlMessage({intlName:"common.INVALID_DATE"})&&(b=b+"<li class='error-list-item'>"+e.intlMessage({intlName:"common.INVALID_DATE"})+"</li>");b+="</ul>",p=[],e.onError(b)},saveClicked:function(t){var n,r,o=this.get("container"),a=this.get("originalFieldValues"),p=!0;n=o.one(".edit-photos-title").get("value"),r=o.one(".edit-photos-description").get("value");if(a.title&&n!==a.title||!a.title&&n)i.title=n,e.rapidTracker.beacon(this.name,"camerarollTrayEdit:TitleChange"),p=!1;if(a.description&&r!==a.description||!a.description&&r)i.description=r,e.rapidTracker.beacon(this.name,"camerarollTrayEdit:DescriptionChange"),p=!1;f.length||l.length||o.one(".edit-photos-tags").get("value")!==""?(this.saveTags(),p=!1):(u.tagAddition=!0,u.tagRemoval=!0),c.length||h.length?(this.savePeople(),p=!1):(u.peopleAddition=!0,u.peopleRemoval=!0),Object.getOwnPropertyNames(i).length?(this.savePhotosUpdates(),p=!1):u.photoUpdate=!0,Object.getOwnPropertyNames(s).length?(this.savePhotosPermissions(),p=!1):u.permissionsUpdate=!0,o.ancestor(".cameraroll-edit-dialog").one(".foot").addClass("balls"),b=t,this.noChanges=p},cancelClicked:function(){i={},s={},o={},f=[],l=[],c=[],h=[],p=[],u={tagAddition:!1,tagRemoval:!1,peopleAddition:!1,peopleRemoval:!1,photoUpdate:!1,permissionsUpdate:!1,datesUpdate:!0},a={tagsRetry:10,peopleRetry:10,photoRetry:10,permissionsRetry:10,datesRetry:10}},onSubviewEvent:function(t,n){var r,i,s,o,a;return n&&(n[0]==="camerarollEditDialog:datesEmpty"?(this.saveClicked(this.parentModal),this.checkIfAPICallsAreDone()):n[0]==="camerarollEditDialog:datesToBeUpdated"?(this.saveClicked(this.parentModal),this.saveDates(n),this.checkIfAPICallsAreDone()):n[0]==="camerarollEditDialog:datesInvalid"?(u.datesUpdate=!0,n[1]==="invalidDateTaken"?r=this.intlMessage({intlName:"common.INVALID_DATE_TAKEN_VALUE"}):n[1]==="invalidDatePosted"?r=this.intlMessage({intlName:"common.INVALID_DATE_UPLOADED_VALUE"}):n[1]==="datePostedFuture"?r=this.intlMessage({intlName:"common.FUTURE_DATE_UPLOADED"}):n[1]==="dateTakenFuture"?r=this.intlMessage({intlName:"common.FUTURE_DATE_TAKEN"}):n[1]==="invalidDatePostedBeforeAccount"?r=this.intlMessage({intlName:"common.DATE_UPLOADED_BEFORE_ACCOUNT",intlDate:n[2]}):r=this.intlMessage({intlName:"common.INVALID_DATE_VALUE"}),this.onValidationError(r)):n[0]==="camerarollEditDialogPeople:personAdded"?(o=n[1],i=this.get("originalFieldValues").people,e.Array.find(i,function(e){return e.nsid===o})?(e.Array.find(h,function(e,t){if(e===o)return a=t,!0}),h.splice(a,1)):c.push(o)):n[0]==="camerarollEditDialogPeople:personRemoved"&&(o=n[1],i=this.get("originalFieldValues").people,s=e.Array.find(i,function(e){return e.nsid===o}),s?h.push(o):c.splice(c.indexOf(o),1))),!1},onError:function(t){var n=this,r;r=new e.Views.FluidModal({appContext:this.appContext,title:n.intlMessage({intlName:"common.ERROR"}),message:t,actionButtonLabel:n.intlMessage({intlName:"common.OK"}),showCancelButton:!1}),r.show()},onValidationError:function(t){var n=e.Node.create(this.templates("validation-error")({message:t})),r=e.Node.create("<div></div>"),i=this.get("container"),s=20,o=i.get("clientWidth")+s,u=i.get("clientHeight")+s,a=500,f=100,l=o/2-(a+s)/2,c=u/2-(f+s)/2;n.setStyle("width",a),n.setStyle("height",f),n.setStyle("left",l),n.setStyle("top",c),r.setStyle("left",0),r.setStyle("top",0),r.setStyle("width","100%"),r.setStyle("height","100%"),r.addClass("validation-modal"),i.append(r),r.append(n),r.on("click",function(){r.remove(!0)})}},{ATTRS:{selectedPhotosIDs:{value:""}}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-css","fluid-balls-css","flutil","url-helper","hermes-template-cameraroll-edit-dialog-body","hermes-template-validation-error","validation-error-css"],optional:["cameraroll-edit-dialog-people-view","cameraroll-edit-dialog-dates-view"],langBundles:["common","settings","cameraroll","errors"]});
