YUI.add("notification-event-added-to-gallery-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,attributes:{type:{},owner:{isModel:!0},galleryId:{},timestamp:{}}})},"@VERSION@",{requires:["flickr-model-registry"]});
YUI.add("notification-event-people-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,attributes:{type:{},owner:{isModel:!0},personTagged:{isModel:!0},timestamp:{}}})},"@VERSION@",{requires:["flickr-model-registry"]});
YUI.add("notification-event-tag-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,attributes:{type:{},owner:{isModel:!0},timestamp:{}}})},"@VERSION@",{requires:["flickr-model-registry"]});
YUI.add("flickr-notifications-markread-updater",function(e,t){"use strict";function n(n,r){return r.callAPI("flickr.notifications.markread",n).then(null,e.FetcherErrorLogger(t))}e.namespace("ModelUpdaters")["flickr-notifications-markread"]={run:n}},"@VERSION@",{requires:["flickr-promise"]});
YUI.add("person-notifications-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-people-getInfo"].run(t,this.appContext)},updateUnreadNotificationCount:function(t,n){return e.ModelUpdaters["flickr-notifications-markread"].run(t,n)},readUnreadNotificationCount:function(t,n){return e.ModelFetchers["flickr-people-getInfo"].run(t,n)}},attributes:{id:{setter:function(e){return e||this.appContext.getViewer().nsid}},unreadNotificationCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},unreadFlickrMailCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},notifications:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-activity-recentByType"]}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-activity-recentByType-fetcher","flickr-notifications-markread-updater","flickr-people-getInfo-fetcher","attribute-helpers"]});
YUI.add("flickr-activity-recentByType-fetcher",function(e,t){"use strict";function n(t){var n={extras:["sizes","icon_urls","ignored","rev_ignored","tags","autotags","datecreate"].join(",")+","+e.APIHelper.request.getRebootPhotoExtras(),per_page:t.perPage||30,count:30,page:t.page||1},r;return r=e.merge(n,t.apiParams||{}),YUI.Env.isServer&&e.SearchHelper.unescapeParameters(r),r}function r(t,n,r){var i=t.apiResponse,s=t.notificationModelRegistry,o=t.notificationsModelRegistry,u=t.photoModelRegistry,a=t.personModelRegistry,f=t.contactModelRegistry,l=t.groupModelRegistry,c=t.personRelationshipModelRegistry,h=t.photoEngagementModelRegistry,p=t.photoStatsRegistry,d=t.photoCurationModelRegistry,v,m=[],g,y;return v={fave:t.faveEventModelRegistry,comment:t.commentEventModelRegistry,contacted:t.followerEventModelRegistry,added_to_gallery:t.addedToGalleryEventModelRegistry,tag:t.tagEventModelRegistry,people:t.peopleEventModelRegistry},i.items.item.forEach(function(t){var n=t.activity?t.activity.event:[],r,i;r={objectType:t.type,id:e.guid(),events:[]},t.type==="photo"?r.object=e.APIHelper.response.parsePhotos({photos:[t],photoModelRegistry:u,personModelRegistry:a,photoEngagementModelRegistry:h,photoStatsModelRegistry:p,photoCurationModelRegistry:d}).shift():t.type==="person"?(r.object=a.exists(t.id)?a.proxy(t.id):a.add(e.APIHelper.response.parsePerson({nsid:t.user,pathAlias:t.pathAlias,username:t.username,realname:t.realname,isAdFree:t.isAdFree,ispro:t.ispro,datecreate:t.datecreate,iconurls:t.iconurls})),c.exists(t.user)||c.add({id:t.user,pathAlias:t.pathAlias,isContact:t.contact,isFriend:t.friend,isFamily:t.family,isIgnored:t.ignored,isIgnoredBy:t.ignoredby})):t.type==="group"&&(r.object=l.exists(t.id)?l.proxy(t.id):l.add(l.parseGroupModel(t.id,t.pathAlias,t))),n.forEach(function(t){var n;t.type in v&&(t.type==="people"&&(y=e.APIHelper.response.parseContact({nsid:t.person,username:t.personname}),y=f.exists(y.id)?f.proxy(y.id):f.add(y)),n=e.APIHelper.response.parseNotificationsEvents[t.type](t,y),f.exists(n.owner.id)?n.owner=f.proxy(n.owner.id):n.owner=f.add(n.owner),i=v[t.type].add(n),r.events.push(i))}),s.exists(r.id)||m.push(s.add(r))}),g={id:n.id,notifications:m},o.exists(n.id)?o.getValue(n.id,"notifications").addPage({page:r.page,perPage:r.per_page,pageContent:m,totalItems:parseInt(i.items.total||0,10)}):o.add(g),o.proxy(n.id)}function i(n,r){var i=this,s="flickr.activity.recentByType",o=this._processParams(n);return(new e.FlickrPromise({apiResponse:r.callAPI(s,o),notificationModelRegistry:r.getModelRegistry("notification-models"),notificationsModelRegistry:r.getModelRegistry("person-notifications-models"),groupInfoModelRegistry:r.getModelRegistry("group-info-models"),groupModelRegistry:r.getModelRegistry("group-models"),personModelRegistry:r.getModelRegistry("person-models"),photoModelRegistry:r.getModelRegistry("photo-models"),contactModelRegistry:r.getModelRegistry("contact-models"),photoEngagementModelRegistry:r.getModelRegistry("photo-engagement-models"),personRelationshipModelRegistry:r.getModelRegistry("person-relationship-models"),photoStatsRegistry:r.getModelRegistry("photo-stats-models"),photoCurationModelRegistry:r.getModelRegistry("photo-curation-models"),faveEventModelRegistry:r.getModelRegistry("notification-event-fave-models"),commentEventModelRegistry:r.getModelRegistry("notification-event-comment-models"),followerEventModelRegistry:r.getModelRegistry("notification-event-follower-models"),addedToGalleryEventModelRegistry:r.getModelRegistry("notification-event-added-to-gallery-models"),tagEventModelRegistry:r.getModelRegistry("notification-event-tag-models"),peopleEventModelRegistry:r.getModelRegistry("notification-event-people-models")})).then(function(e){return i._processResponse(e,n,o)},e.FetcherErrorLogger(t))}e.namespace("ListFetchers")["flickr-activity-recentByType"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","search-helper","querystring-parse-simple"],optional:["notification-models","person-notifications-models","contact-models","photo-models","notification-event-fave-models","notification-event-comment-models","notification-event-follower-models","notification-event-added-to-gallery-models","notification-event-people-models","notification-event-tag-models","photo-curation-models"]});
YUI.add("notification-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-activity-recentByType"].run(t,this.appContext)}},attributes:{id:{},objectType:{},object:{isModel:!0},events:{isListProxy:!0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-activity-recentByType-fetcher"]});
YUI.add("cameraroll-dates-map-models",function(e,t){function n(e){n.superclass.constructor.call(this,e)}e.Models[this.name]=n,e.extend(n,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-cameraroll-getMap"].run(t,this.appContext)}},attributes:{sections:{},countsBySection:{},photoIdsBySection:{},sectionByPhotoIds:{},mapVersion:{},lastUpdate:{},lastCreate:{},lastDelete:{},mode:{defaultValue:"date_taken"},initialFetch:{readOnly:!0,derivedBy:["sections"],defaultFn:function(t){var n,r,i=this.appContext.flipper.isFlipped("enable-cr-preview")?"initial_photos_to_fetch":"initial_photos_to_fetch_with_sizes";return n=this.getValue(t,"sections"),r=n[0],{fromDate:r,pageSize:e.config.flickr.cameraroll[i],offset:0}}}},hasPhotosInRegistry:function(e,t,n,r){var i=this,s,o,u,a,f,l,c;s=i.getValue(e,"sections"),o=i.getBuriedValue(e,"photoIdsBySection"),u=i.getValue(e,"countsBySection"),l=t,a=s.indexOf(t),c=r;for(f=0;f<n;f++){if(!o[l])return!1;if(typeof o[l][c]=="undefined"||o[l][c]===null)return!1;if(i.appContext.flipper.isFlipped("enable-cr-preview")&&Object.keys(i.thumbnailModel.getValue(o[l][c],"rawSizes")).length<3)return!1;if(f<n-1){c++;if(c>u[l]-1){a++;if(a>=s.length)break;l=s[a],c=0}}}return!0},getPhotosFromRegistry:function(e,t,n,r,i){var s=this,o,u,a,f,l,c,h,p,d={};return o=s.getValue(e,"sections"),u=s.getBuriedValue(e,"photoIdsBySection"),a=s.getValue(e,"countsBySection"),c=t,f=o.indexOf(t),h=r,this.appContext.getModelRegistry("cameraroll-thumbnail-models").then(function(e){var t,s=[];for(l=0;l<n;l++){if(!u[c])return null;if(typeof u[c][h]=="undefined"||u[c][h]===null)return null;p=u[c][h],d[c]||(d[c]=[]),d[c].push(e.proxy(p));if(l<n-1){h++;if(h>a[c]-1){f++;if(f>=o.length)break;c=o[f],h=0}}}for(t in d)u[t].length>a[t]&&s.push({section:t,mapCount:a[t],photosCount:u[t].length});return{rangeSections:d,offset:r,thumbnailChunkKey:i,inconsistentSections:s}})},_getNormalizedDate:function(t,n){var r;if(n==="date_posted")t.dateCreateDay?r=t.dateCreateDay:r=e.moment(t.dateCreateTz).format("YYYY-MM-DD");else if(parseInt(t.dateTakenUnknown,10))r="unknown";else if(t.dateTakenDay)r=t.dateTakenDay;else switch(parseInt(t.dateTakenGranularity,10)){case 8:case 6:r=e.moment(t.dateTaken).format("YYYY")+"-inexact";break;case 4:r=e.moment(t.dateTaken).format("YYYY-MM")+"-inexact";break;case 0:default:r=e.moment(t.dateTaken).format("YYYY-MM-DD")}return r},getPhotos:function(n,r,i,s,o){var u=this,a={},f;return this.appContext.getModelRegistry("cameraroll-thumbnail-models").then(function(l){return u.thumbnailModel=l,u.hasPhotosInRegistry(n,r,i,s)?u.getPhotosFromRegistry(n,r,i,s,o):(f=u.getValue(n,"mode"),f==="date_taken"?a.mode="dt":f==="date_posted"&&(a.mode="dc"),a.from_date=r,a.page_size=i,a.offset=s,a.version=e.config.flickr.cameraroll.api_version,a.limit_date_create=u.getValue(n,"lastCreate"),u.appContext.flipper.isFlipped("enable-cr-preview")&&!YUI.Env.isServer&&(a.extras="sizes"),u.appContext.callAPI("flickr.cameraroll.getPhotosByOffset",a,null,{camelCase:!1}).then(function(e){var t=u.thumbnailModel,r,i,a,l,c,h=!0,p=0,d={},v={},m,g,y=!1;m=u.getValue(n,"mapVersion"),g=parseInt(e.version,10),g&&m&&g>m&&(y=!0),r=u.getValue(n,"sections"),i=u.getBuriedValue(n,"photoIdsBySection"),a=u.getBuriedValue(n,"sectionByPhotoIds"),l=u.getValue(n,"countsBySection"),e.photos.forEach(function(e){var n,o;n=u._getNormalizedDate(e,f),typeof d[n]=="undefined"?h?d[n]=0+s:d[n]=0:d[n]++,p=d[n],h=!1,i[n]||(i[n]=new Array(l[n])),a[e.id]=n,i[n][p]=e.id,r[n]||(r[n]=[]),o=t.normalize(e),t.exists(e.id)?t.setValues(e.id,o):(o.id=e.id,t.add(o,!0)),v[n]=1,r[n].push(t.proxy(e.id))});for(c in v)v[c]=r[c];return u.setBuriedValue(n,"photoIdsBySection",i),u.setBuriedValue(n,"sectionByPhotoIds",a),{rangeSections:v,offset:s,thumbnailChunkKey:o,newMapVersion:y,type:"dates"}},e.FetcherErrorLogger(t)))})},diff:function(t){var n=this,r=n.getValue(t,"mode"),i=n.getValue(t,"lastUpdate"),s=n.getValue(t,"lastCreate"),o=n.getValue(t,"lastDelete"),u=n.getBuriedValue(t,"sectionByPhotoIds"),a={min_date:parseInt(i,10)+1,extras:"date_upload, date_taken",response_type:"cr",per_page:500},f=e.clone(a,!0),l=e.clone(a,!0),c=e.clone(a,!0);return f.min_date=parseInt(i,10)+1,l.min_date=parseInt(s,10)+1,c.min_date=parseInt(o,10)+1,e.batch(n.appContext.callAPI("flickr.photos.recentlyUpdated",f),n.appContext.callAPI("flickr.photos.recentlyUploaded",l),n.appContext.callAPI("flickr.photos.recentlyDeleted",c)).then(function(t){var i=t[0],o=t[1],a=t[2],f=[],l=[],c={},h=[],p=[],d={};return o&&o.photos&&o.photos.photo&&o.photos.photo.length>0&&o.photos.photo.forEach(function(e){var t;e.dateTaken=e.datetaken,e.dateTakenGranularity=e.datetakengranularity,f.push(e.id),l.push(e.id),c[e.id]=!0,t=n._getNormalizedDate(e,r),d[t]=!0}),i&&i.photos&&i.photos.total&&parseInt(i.photos.total,10)>0&&i.photos.photo.forEach(function(e){var t;e.dateTaken=e.datetaken,e.dateTakenGranularity=e.datetakengranularity;if(typeof c[e.id]=="undefined"){if(e.dateCreate>=s)return;f.push(e.id),h.push(e.id),t=n._getNormalizedDate(e,r),d[t]=!0}}),a&&a.photos&&a.photos.photo&&a.photos.photo.length>0&&a.photos.photo.forEach(function(e){f.push(e.id),p.push(e.id)}),f.length===0?e.Promise.resolve({changed:!1}):(f.forEach(function(e){u[e]&&(d[u[e]]=!0)}),e.Promise.resolve({changed:!0,sectionsAffected:d,deletedPhotoIds:p,createdPhotoIds:l,updatedPhotoIds:h}))})},updateMapAndMarkDirtySections:function(t,n){var r=this,i=r.getValue(t,"mode"),s,o=n.sectionsAffected;return s=r.getBuriedValue(t,"photoIdsBySection"),e.Object.keys(o).forEach(function(e){delete s[e]}),r.setBuriedValue(t,"photoIdsBySection",s),r.remote.read.call(r,{id:t,mode:i}).then(function(t){return e.Promise.resolve(!0)})},checkForUpdates:function(t){var n=this,r=parseInt(n.getValue(t,"mapVersion"),10),i=n.getValue(t,"mode"),s={};return i==="date_taken"?s.mode="dt":i==="date_posted"&&(s.mode="dc"),this.appContext.callAPI("flickr.cameraroll.getMapVersion",s).then(function(t){var n;return n=parseInt(t.cameraRoll.version,10)
,e.Promise.resolve(r<n)})},rebuildMap:function(t){var n=this,r=n.getValue(t,"mode"),i={};return i.mode=r,i.rebuild=1,e.ModelFetchers["flickr-cameraroll-getMap"].run(i,this.appContext)},hasSections:function(e){var t=this.getSections(e);return t.length>0},getSections:function(e){return this.getValue(e,"sections")},getCountsBySection:function(e){return this.getValue(e,"countsBySection")},deletePhotos:function(e,t){var n=this.getValue(e,"sections"),r=this.getValue(e,"countsBySection"),i=this.getBuriedValue(e,"photoIdsBySection"),s=this.getBuriedValue(e,"sectionByPhotoIds");t.forEach(function(e){r[e.date]=r[e.date]-1,i[e.date]=i[e.date].splice(i[e.date].indexOf(e.id),1),delete s[e.id],r[e.date]===0&&(delete r[e.date],delete i[e.date],n.splice(n.indexOf(e.date),1))}),this.setValue(e,"countsBySection",r),this.setBuriedValue(e,"photoIdsBySection",i),this.setBuriedValue(e,"sectionByPhotoIds",s),this.setValue(e,"sections",n)}})},"@VERSION@",{requires:["oop","flickr-model-registry","flickr-promise","flickr-cameraroll-getMap-fetcher"]});
YUI.add("flickr-cameraroll-getMap-fetcher",function(e,t){"use strict";function r(e,t){var r=e[0],i=e[1],o,u=[],a={},f,l,c,h=s(r.mode),p,d={};o=r.counts;for(f in o){f==="unknown"&&o[f]!=="0"&&(u.push(f),a[f]=parseInt(o[f],10));if(isNaN(parseInt(f,10)))continue;for(l in o[f]){if(l==="inexact"){p=f+"-inexact",u.push(p),a[p]=o[f][l];continue}for(c in o[f][l]){if(c!=="inexact"&&isNaN(parseInt(c,10)))continue;c==="inexact"?p=f+"-"+l+"-inexact":p=f+"-"+l+"-"+c,u.push(p),a[p]=o[f][l][c]}}}return u.sort(n),i.exists(h)?i.setValues(h,{sections:u,countsBySection:a,mapVersion:parseInt(o.version,10),lastUpdate:parseInt(o.lastUpdate,10),lastCreate:parseInt(o.lastCreate,10),lastDelete:parseInt(o.lastDelete,10),mode:h}):(d={id:h,sections:u,countsBySection:a,mapVersion:parseInt(o.version,10),lastUpdate:parseInt(o.lastUpdate,10),lastCreate:parseInt(o.lastCreate,10),lastDelete:parseInt(o.lastDelete,10),photoIdsBySection:{},sectionByPhotoIds:{},mode:h},i.add(d)),h}function i(e){return e==="date_taken"?"dt":"dc"}function s(e){return e==="dt"?"date_taken":"date_posted"}function o(n,r){var s={version:e.config.flickr.cameraroll.api_version},o=this;return n&&(n.mode&&(s.mode=i(n.mode)),n.rebuild&&(s.rebuild=1)),e.Promise.all([r.callAPI("flickr.cameraroll.getMap",s),r.getModelRegistry("cameraroll-dates-map-models")]).then(function(e){return o._processResponse(e,n)},e.FetcherErrorLogger(t))}var n=function(e,t){var n=e.split("-",3),r=t.split("-",3);return e==="unknown"?1:t==="unknown"?-1:n[0]<r[0]?1:n[0]>r[0]?-1:n[1]==="inexact"?1:r[1]==="inexact"?-1:n[1]<r[1]?1:n[1]>r[1]?-1:n[2]==="inexact"?1:r[2]==="inexact"?-1:n[2]<r[2]?1:n[2]>r[2]?-1:0};e.namespace("ModelFetchers")["flickr-cameraroll-getMap"]={run:o,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["cameraroll-dates-map-models"]});
YUI.add("hermes-lang-client-app",function(e,t){e.Intl.add("hermes/client-app","en-US",{SAVING_LAST_ACTIONS:["Hey! We\u2019re still saving your last actions, you might lose them if you leave this page."],UPLOAD_IN_PROGRESS:["Wait! Your photos are still on the way to our servers. They might not get there if you leave this page before they arrive."]})},"@VERSION@",{requires:["intl"]});
YUI.add("hermes-lang-photo-page",function(e,t){e.Intl.add("hermes/photo-page","en-US",{WELCOME_MSG_1:["Welcome to the new Flickr photo page! We\u2019ve been working hard on updating the photo viewing experience, and wanted to give you a preview of what we will be launching later this year. You may notice that some features are missing; we haven\u2019t forgotten about them, and they will be appearing soon."],WELCOME_MSG_2:["We want your feedback. If you have any comments, find any bugs, or simply want to go back to the old photo page, please click on the \u201cHelp &amp; Feedback\u201d button on the bottom left of this page. Thanks for trying the new photo page and helping us improve Flickr!"],WELCOME_MSG_TITLE:["Welcome to the new photo page!"],WELCOME_MSG_CONFIRM_BUTTON:["Got it!"]})},"@VERSION@",{requires:["intl"]});
